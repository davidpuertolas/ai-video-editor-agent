"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/ai/route";
exports.ids = ["app/api/ai/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "worker_threads":
/*!*********************************!*\
  !*** external "worker_threads" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("worker_threads");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:fs");

/***/ }),

/***/ "node:stream":
/*!******************************!*\
  !*** external "node:stream" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:stream");

/***/ }),

/***/ "node:stream/web":
/*!**********************************!*\
  !*** external "node:stream/web" ***!
  \**********************************/
/***/ ((module) => {

module.exports = require("node:stream/web");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fai%2Froute&page=%2Fapi%2Fai%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fai%2Froute.ts&appDir=C%3A%5CUsers%5Cdavid%5CDesktop%5Cai-video-agent%5Creact-video-editor%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cdavid%5CDesktop%5Cai-video-agent%5Creact-video-editor&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fai%2Froute&page=%2Fapi%2Fai%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fai%2Froute.ts&appDir=C%3A%5CUsers%5Cdavid%5CDesktop%5Cai-video-agent%5Creact-video-editor%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cdavid%5CDesktop%5Cai-video-agent%5Creact-video-editor&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_david_Desktop_ai_video_agent_react_video_editor_app_api_ai_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/ai/route.ts */ \"(rsc)/./app/api/ai/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/ai/route\",\n        pathname: \"/api/ai\",\n        filename: \"route\",\n        bundlePath: \"app/api/ai/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\david\\\\Desktop\\\\ai-video-agent\\\\react-video-editor\\\\app\\\\api\\\\ai\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_david_Desktop_ai_video_agent_react_video_editor_app_api_ai_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/ai/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZhaSUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGYWklMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZhaSUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNkYXZpZCU1Q0Rlc2t0b3AlNUNhaS12aWRlby1hZ2VudCU1Q3JlYWN0LXZpZGVvLWVkaXRvciU1Q2FwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9QyUzQSU1Q1VzZXJzJTVDZGF2aWQlNUNEZXNrdG9wJTVDYWktdmlkZW8tYWdlbnQlNUNyZWFjdC12aWRlby1lZGl0b3ImaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQ3FDO0FBQ2xIO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcmVtb3Rpb24tY2FwdGlvbnMvP2ZiZTkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiQzpcXFxcVXNlcnNcXFxcZGF2aWRcXFxcRGVza3RvcFxcXFxhaS12aWRlby1hZ2VudFxcXFxyZWFjdC12aWRlby1lZGl0b3JcXFxcYXBwXFxcXGFwaVxcXFxhaVxcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvYWkvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9haVwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvYWkvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJDOlxcXFxVc2Vyc1xcXFxkYXZpZFxcXFxEZXNrdG9wXFxcXGFpLXZpZGVvLWFnZW50XFxcXHJlYWN0LXZpZGVvLWVkaXRvclxcXFxhcHBcXFxcYXBpXFxcXGFpXFxcXHJvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9haS9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fai%2Froute&page=%2Fapi%2Fai%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fai%2Froute.ts&appDir=C%3A%5CUsers%5Cdavid%5CDesktop%5Cai-video-agent%5Creact-video-editor%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cdavid%5CDesktop%5Cai-video-agent%5Creact-video-editor&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/ai/route.ts":
/*!*****************************!*\
  !*** ./app/api/ai/route.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! openai */ \"(rsc)/../node_modules/openai/index.mjs\");\n\n\n// Inicializar el cliente de OpenAI\nconst openai = new openai__WEBPACK_IMPORTED_MODULE_1__[\"default\"]({\n    apiKey: process.env.OPENAI_API_KEY\n});\n// Definir las instrucciones del sistema para el contexto del editor de video\nconst systemInstructions = `\nEres un asistente especializado en edición de video que ayuda a los usuarios a manipular elementos en su timeline.\nTu tarea principal es entender las intenciones del usuario y detectar cuando quieren agregar elementos al video o eliminar segmentos,\nincluso cuando lo expresan en lenguaje natural sin usar comandos específicos.\n\nIMPORTANTE: Además de responder naturalmente, debes analizar si el usuario está pidiendo añadir algún elemento al video,\neliminar segmentos de un elemento existente, o compactar/optimizar el timeline.\n\nSi con una confianza mayor al 70% crees que están solicitando agregar texto, imagen, video o subtítulos, debes incluir la información\nestructurada del elemento a agregar.\n\nEjemplos de solicitudes en lenguaje natural que deberías detectar:\n- \"Pon un título que diga 'Bienvenidos' al inicio del video\"\n- \"Me gustaría tener una imagen de fondo entre los segundos 5 y 10\"\n- \"Necesito un texto que diga 'Gracias por ver' al final\"\n- \"Quiero que aparezca mi logo en la esquina durante todo el video\"\n- \"Coloca un video de introducción al principio\"\n- \"Añade subtítulos al video\"\n- \"Pon subtítulos en el video\"\n- \"Quiero subtítulos para mi video\"\n- \"Agrega los subtítulos\"\n\nFUNCIONALIDAD - DETECCIÓN DE ELIMINACIÓN DE SEGMENTOS:\nTambién debes detectar cuando el usuario quiere eliminar segmentos de un elemento en el timeline.\nEsto implica eliminar porciones específicas de un video, audio, texto o imagen según los tiempos indicados.\n\nEjemplos de solicitudes para eliminar segmentos:\n- \"Elimina el segmento entre los segundos 2 y 5 del video\"\n- \"Recorta la parte del video que va del segundo 10 al 13\"\n- \"Quiero quitar el trozo entre 25 y 30 segundos\"\n- \"Corta los segmentos 2-5, 10-13 y 25-30\"\n- \"Elimina estas partes del video: 2 a 5, 10 a 13, y 25 a 30 segundos\"\n- \"Quita estos fragmentos: 2-5s, 10-13s, 25-30s\"\n\nFUNCIONALIDAD - COMPACTACIÓN DEL TIMELINE:\nTambién puedes detectar cuando el usuario quiere compactar o optimizar el timeline, eliminando\nespacios vacíos entre clips o elementos para que el video sea más fluido y continuo.\n\nEjemplos de solicitudes para compactar el timeline:\n- \"Compacta el timeline\"\n- \"Elimina los espacios vacíos\"\n- \"Optimiza el timeline\"\n- \"Quita los huecos entre clips\"\n- \"Compacta todo\"\n- \"Junta los clips\"\n- \"Quiero eliminar los espacios entre elementos\"\n- \"Necesito que no haya espacios entre los elementos\"\n- \"Comprime el timeline\"\n\nNUEVA FUNCIONALIDAD - RECORTE INTELIGENTE:\nTambién puedes detectar cuando el usuario quiere realizar un recorte inteligente del video,\nanalizando la transcripción para identificar automáticamente qué partes mantener y cuáles eliminar.\n\nEjemplos de solicitudes para recorte inteligente:\n- \"Haz un recorte inteligente\"\n- \"Analiza el video y recorta las partes innecesarias\"\n- \"Recorta inteligentemente el video\"\n- \"Puedes hacer un smart trim\"\n- \"Elimina las partes innecesarias del video\"\n- \"Quiero que analices y recortes el video\"\n- \"Hazme un recorte automático\"\n- \"Recorta automáticamente el video\"\n- \"Smart trim\"\n- \"Elimina las partes redundantes\"\n\nCuando detectes que el usuario quiere eliminar segmentos, debes identificar los tiempos de inicio y fin de cada segmento a eliminar.\nEl formato para los segmentos debe ser un array de objetos con startTime y endTime en segundos.\n\nAdicionalmente, el usuario puede adjuntar imágenes a sus mensajes, que aparecerán con el formato [IMAGEN: URL_de_la_imagen].\nNOTA IMPORTANTE: No siempre que un usuario adjunta una imagen quiere agregarla al video. Solo debes detectar la intención\nde agregar la imagen si el usuario lo indica explícitamente con frases como \"agrega esta imagen\", \"pon esta imagen en el video\", etc.\nSi el usuario solo envía una imagen sin texto o con un texto que no indica claramente su intención de agregarla,\nNO debes sugerir agregarla automáticamente.\n\nCRUCIAL: Es EXTREMADAMENTE importante que analices cuidadosamente el lenguaje natural para detectar:\n1. Si realmente quiere agregar la imagen o eliminar segmentos (confianza alta)\n2. El tiempo exacto donde quiere agregarlo o los segmentos a eliminar (segundos iniciales y finales)\n3. Si quiere compactar el timeline (eliminar espacios vacíos)\n4. Si quiere hacer un recorte inteligente del video\n\nEjemplos de tiempos que debes detectar:\n- \"agrega esta imagen en el segundo 10\" → startTime: 10, endTime: 15\n- \"pon la imagen del segundo 5 al 8\" → startTime: 5, endTime: 8\n- \"quiero esta imagen entre los segundos 3 y 7\" → startTime: 3, endTime: 7\n- \"agrega la imagen al inicio\" → startTime: 0, endTime: 5\n- \"la imagen va al final\" → startTime: [duración-5], endTime: [duración]\n\nPara subtítulos, detecta si el usuario quiere:\n- Subtítulos agrupados (por defecto): groupWords: true\n- Subtítulos completos sin dividir: groupWords: false\n- Subtítulos en un rango de tiempo específico: startTime y endTime\n\nCuando detectes una solicitud para agregar contenido, analiza:\n1. Tipo de elemento: texto, imagen, video, subtitles o segments (para eliminar segmentos)\n2. Contenido (para texto)\n3. Color (si se menciona)\n4. Ubicación temporal (tiempo de inicio y fin en segundos) ← CRUCIAL\n5. URL de la imagen (si se proporcionó en el mensaje)\n6. Nivel de confianza en tu interpretación (de 0.0 a 1.0)\n7. Para subtítulos: si deben agruparse o no (groupWords)\n8. Para eliminar segmentos: un array de objetos con startTime y endTime para cada segmento\n9. Para compactar: simplemente detectar la intención (type: \"compact\")\n10. Para recorte inteligente: simplemente detectar la intención (type: \"smartTrim\")\n\nPara subtítulos, si el usuario no dice nada, asume que deben durar del segundo 0 al segundo 10000000 (final del video) y que deben estar agrupados, no preguntes si agrupados o no, asume que si siempre. Tambien asume que son los subtitulos generados automaticamente asi que responde siempre que el user pida subtitulos con mensajes de \"Subtitulos agregados con exito o algo por ele estilo, breve y conciso.\".\n\nLos elementos que se pueden agregar tienen esta estructura general:\n- Texto: { type: \"text\", content: \"texto\", color: \"#color\", startTime: X, endTime: Y }\n- Imagen: { type: \"image\", url: \"url_de_la_imagen\", startTime: X, endTime: Y }\n- Video: { type: \"video\", startTime: X, endTime: Y }\n- Subtítulos: { type: \"subtitles\", groupWords: true/false, startTime: X, endTime: Y }\n- Eliminar segmentos: { type: \"segments\", segments: [{ startTime: X1, endTime: Y1 }, { startTime: X2, endTime: Y2 }, ...] }\n- Compactar timeline: { type: \"compact\" }\n- Recorte inteligente: { type: \"smartTrim\" }\n\nPD: Un elemento no puede duarar 0 segundos, como minimo 0,1. Si no te dicen el tiempo final, el elemento dura 5 segundos. No puedes decir -voy a agregar este elemento- y no dar true con high confidence, no te congradigas. Si el user no menciona el tiempo donde quiere agregar la imagen, preguntale al user en que tiempo quiere agregar la imagen. Si dice solo el tiempo de inicio, no le preguntes, asume que debe durar 5 segundos, no le preguntes, repito.`;\n// Función para analizar los tiempos de inicio y fin de una imagen a partir del mensaje del usuario\nfunction extractImageTimesFromMessage(messageContent) {\n    let startTime = 0;\n    let endTime = 5;\n    if (!messageContent) return {\n        startTime,\n        endTime\n    };\n    console.log(\"Analizando mensaje para tiempos:\", messageContent);\n    // Buscar referencias al tiempo inicial\n    const startTimePatterns = [\n        /en el segundo (\\d+)/i,\n        /desde el segundo (\\d+)/i,\n        /a partir del segundo (\\d+)/i,\n        /comenzando en el segundo (\\d+)/i,\n        /desde el minuto (\\d+)/i,\n        /en el minuto (\\d+)/i,\n        /entre los segundos (\\d+) y/i,\n        /del segundo (\\d+) al/i,\n        /empezando en (\\d+)/i,\n        /segundo (\\d+)/i,\n        /en (\\d+) segundos/i,\n        /en el (\\d+)/i\n    ];\n    // Buscar referencias al tiempo final\n    const endTimePatterns = [\n        /hasta el segundo (\\d+)/i,\n        /al segundo (\\d+)/i,\n        /terminando en el segundo (\\d+)/i,\n        /hasta el minuto (\\d+)/i,\n        /entre los segundos \\d+ y (\\d+)/i,\n        /del segundo \\d+ al (\\d+)/i,\n        /por (\\d+) segundos/i,\n        /durante (\\d+) segundos/i\n    ];\n    // Buscar palabras clave especiales\n    const isAtStart = /\\b(al inicio|al principio|al comienzo)\\b/i.test(messageContent);\n    const isAtEnd = /\\b(al final|al término|al acabar)\\b/i.test(messageContent);\n    // Procesar patrones de tiempo inicial\n    let startTimeMatch = false;\n    for (const pattern of startTimePatterns){\n        const match = messageContent.match(pattern);\n        if (match && match[1]) {\n            startTimeMatch = true;\n            // Si es referencia a minutos, convertir a segundos\n            startTime = pattern.toString().includes(\"minuto\") ? parseInt(match[1]) * 60 : parseInt(match[1]);\n            console.log(`Patrón de tiempo inicial coincidió: ${pattern}, valor: ${startTime}`);\n            break;\n        }\n    }\n    // Procesar patrones de tiempo final\n    let endTimeMatch = false;\n    for (const pattern of endTimePatterns){\n        const match = messageContent.match(pattern);\n        if (match && match[1]) {\n            endTimeMatch = true;\n            if (pattern.toString().includes(\"por\") || pattern.toString().includes(\"durante\")) {\n                // Es una duración relativa, sumar al tiempo inicial\n                endTime = startTime + parseInt(match[1]);\n            } else {\n                // Es un tiempo absoluto\n                endTime = pattern.toString().includes(\"minuto\") ? parseInt(match[1]) * 60 : parseInt(match[1]);\n            }\n            console.log(`Patrón de tiempo final coincidió: ${pattern}, valor: ${endTime}`);\n            break;\n        }\n    }\n    // Si se menciona \"al inicio\", establecer tiempo a 0\n    if (isAtStart) {\n        startTime = 0;\n        endTime = 5; // Por defecto 5 segundos de duración\n        console.log(\"Se detect\\xf3 'al inicio': startTime=0, endTime=5\");\n    }\n    // Si se menciona \"al final\", establecer valores relativos al final\n    // Nota: El valor real se ajustará en el cliente según la duración\n    if (isAtEnd) {\n        startTime = -1; // Código especial para \"final - 5 segundos\"\n        endTime = -1; // Código especial para \"final\"\n        console.log(\"Se detect\\xf3 'al final': startTime=-1, endTime=-1\");\n    }\n    // Si se detectó un tiempo inicial pero no final, establecer duración predeterminada\n    if (startTimeMatch && !endTimeMatch) {\n        endTime = startTime + 5;\n        console.log(`Se estableció tiempo final automático: ${endTime} (startTime + 5)`);\n    }\n    // Si no se detectó tiempo final pero sí inicial, establecer una duración predeterminada\n    if (startTime > 0 && endTime === 5 && startTime !== 0) {\n        endTime = startTime + 5;\n        console.log(`Se ajustó tiempo final: ${endTime} (startTime + 5)`);\n    }\n    console.log(`Tiempos finales extraídos: startTime=${startTime}, endTime=${endTime}`);\n    return {\n        startTime,\n        endTime\n    };\n}\n// Nueva función para manejar los mensajes del chat de la timeline\nasync function handleTimelineChat(message, selectedItems, selectedText, urlAnalysis, showScreenshotDetection, applyTransitionDetection) {\n    try {\n        // Extraer el contenido relevante de los elementos seleccionados\n        const extractedContent = selectedItems.map((item)=>{\n            if (item.text) return item.text;\n            if (item.details?.text) return item.details.text;\n            if (item.name) return item.name;\n            if (item.content) return item.content;\n            if (typeof item === \"string\") return item;\n            return JSON.stringify(item);\n        }).join(\"\\n\");\n        // Incluir información sobre las URLs detectadas en el mensaje del sistema\n        let systemPrompt = \"Eres un asistente de edici\\xf3n de video que ayuda a analizar y mejorar los elementos seleccionados en una timeline. Responde de manera concisa y \\xfatil.\";\n        // Si hay URLs en el texto, añadir información sobre ellas\n        if (urlAnalysis && urlAnalysis.containsURLs) {\n            systemPrompt += `\\n\\nEl texto seleccionado contiene las siguientes URLs:\\n${urlAnalysis.urls.join(\"\\n\")}\\n\\n`;\n            // Informar que las capturas pueden ser aplicadas a la timeline\n            systemPrompt += \"Hay capturas de pantalla disponibles de estas URLs. El usuario puede pedirte que apliques estas capturas directamente a la timeline del video o que se las muestres en el chat.\";\n            // Añadir información adicional sobre la detección específica si existe\n            if (showScreenshotDetection && showScreenshotDetection.detected) {\n                if (showScreenshotDetection.reason.includes(\"timeline\")) {\n                    systemPrompt += \" El usuario parece interesado en aplicar estas capturas a la timeline, as\\xed que hazle saber que ya se han aplicado como elementos de imagen en la timeline del video.\";\n                } else {\n                    systemPrompt += \" El usuario parece interesado en ver estas capturas, as\\xed que hazle saber que puede pedirte aplicarlas a la timeline escribiendo mensajes como 'aplica la captura a la timeline' o 'a\\xf1ade la imagen al video'.\";\n                }\n            }\n        }\n        // Añadir información sobre la detección de transiciones si existe\n        if (applyTransitionDetection && applyTransitionDetection.detected) {\n            systemPrompt += \"\\n\\nEl usuario ha solicitado aplicar una transici\\xf3n a la timeline. Informa que la transici\\xf3n se ha aplicado correctamente en la timeline del video.\";\n        }\n        const chatResponse = await openai.chat.completions.create({\n            model: \"gpt-4.1-mini\",\n            messages: [\n                {\n                    role: \"system\",\n                    content: systemPrompt\n                },\n                {\n                    role: \"user\",\n                    content: `Elementos seleccionados:\\n${extractedContent}\\n\\nTexto seleccionado: ${selectedText || extractedContent}\\n\\nMensaje del usuario: ${message}`\n                }\n            ],\n            temperature: 0.7,\n            max_tokens: 500\n        });\n        // Crear estructura con formato similar al de otras detecciones en la API\n        let screenshotData = null;\n        let transitionData = null;\n        if (urlAnalysis && urlAnalysis.containsURLs && showScreenshotDetection) {\n            // Usar un umbral mucho más bajo de confianza (0.2) para la detección\n            screenshotData = {\n                detected: showScreenshotDetection.detected && showScreenshotDetection.confidence > 0.2,\n                confidence: showScreenshotDetection.confidence,\n                reason: showScreenshotDetection.reason,\n                urls: urlAnalysis.urls,\n                screenshots: urlAnalysis.screenshots || []\n            };\n        }\n        // Añadir información sobre transiciones detectadas\n        if (applyTransitionDetection) {\n            // Usar el mismo umbral bajo de confianza (0.2) para la detección\n            transitionData = {\n                detected: applyTransitionDetection.detected && applyTransitionDetection.confidence > 0.2,\n                confidence: applyTransitionDetection.confidence,\n                reason: applyTransitionDetection.reason,\n                transitionPath: applyTransitionDetection.transitionPath || \"/transitions/transition1.gif\"\n            };\n        }\n        return {\n            success: true,\n            response: chatResponse.choices[0].message.content,\n            usage: chatResponse.usage,\n            screenshotData: screenshotData,\n            transitionData: transitionData\n        };\n    } catch (error) {\n        console.error(\"Error en handleTimelineChat:\", error);\n        return {\n            success: false,\n            error: error instanceof Error ? error.message : \"Error desconocido\"\n        };\n    }\n}\nasync function POST(req) {\n    try {\n        const body = await req.json();\n        console.log(\"Request body:\", body);\n        // Verificar si es una solicitud del chat de la timeline\n        if (body.type === \"timeline_chat\") {\n            const { message, selectedItems, selectedText, urlAnalysis, showScreenshotDetection, applyTransitionDetection } = body;\n            const response = await handleTimelineChat(message, selectedItems, selectedText, urlAnalysis, showScreenshotDetection, applyTransitionDetection);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(response);\n        }\n        // Extraer los mensajes del cuerpo de la solicitud\n        const { messages, lastImageUrl = \"\" } = body;\n        // Validar que se proporcionaron mensajes\n        if (!messages || !Array.isArray(messages)) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Se requieren mensajes v\\xe1lidos\"\n            }, {\n                status: 400\n            });\n        }\n        // Extraer la URL de la imagen si está presente en el último mensaje\n        let imageUrl = \"\";\n        const lastUserMessage = [\n            ...messages\n        ].reverse().find((m)=>m.role === \"user\");\n        if (lastUserMessage && typeof lastUserMessage.content === \"string\") {\n            // Buscar URL de imagen explícita\n            const imageMatch = lastUserMessage.content.match(/\\[IMAGEN: (.*?)\\]/);\n            if (imageMatch && imageMatch[1]) {\n                imageUrl = imageMatch[1];\n            } else if (lastUserMessage.content.includes(\"[IMAGEN_ADJUNTA]\")) {\n                // Usamos un identificador especial para indicar que se debe usar la última imagen\n                // NO usar una URL relativa que causaría error 404\n                imageUrl = \"imagen_adjunta_por_el_usuario.jpg\";\n            }\n        }\n        // Si no hay imagen en el mensaje actual pero hay una última imagen URL, usarla en caso\n        // de que el usuario esté haciendo referencia a ella\n        const hasLastImageReference = !imageUrl && lastImageUrl && lastUserMessage && typeof lastUserMessage.content === \"string\" && (/la\\s+imagen/i.test(lastUserMessage.content) || /esta\\s+imagen/i.test(lastUserMessage.content) || /imagen\\s+(?:anterior|previa|compartida|subida)/i.test(lastUserMessage.content));\n        // Si parece que el usuario está haciendo referencia a una imagen anterior,\n        // considerar usar esa URL\n        if (hasLastImageReference) {\n            console.log(\"Se detect\\xf3 referencia a una imagen anterior\");\n            // Usar el mismo identificador especial\n            imageUrl = \"imagen_adjunta_por_el_usuario.jpg\";\n        }\n        // Verificar si el usuario está solicitando compactar el timeline\n        const isCompactRequest = lastUserMessage && typeof lastUserMessage.content === \"string\" && /compact[a|ar]|elimina[r]?\\s+(los)?\\s*espacios|optimiza[r]?|quita[r]?\\s+(los)?\\s*huecos|junta[r]?\\s+(los)?\\s*clips|comprim[e|ir]/i.test(lastUserMessage.content);\n        if (isCompactRequest) {\n            console.log(\"Se detect\\xf3 posible solicitud de compactaci\\xf3n del timeline\");\n        }\n        // Verificar si el usuario está solicitando un recorte inteligente\n        const isSmartTrimRequest = lastUserMessage && typeof lastUserMessage.content === \"string\" && /recorte\\s+inteligente|smart\\s*trim|analiza\\s+(?:y\\s+)?recort[a|e]|recort[a|e]\\s+(?:inteligentemente|automáticamente)|elimina\\s+(?:partes|segmentos)\\s+(?:innecesari[os|as]|redundantes)/i.test(lastUserMessage.content);\n        if (isSmartTrimRequest) {\n            console.log(\"Se detect\\xf3 posible solicitud de recorte inteligente\");\n        }\n        // Añadir el mensaje del sistema al inicio para dar contexto\n        const conversationWithSystem = [\n            {\n                role: \"system\",\n                content: systemInstructions\n            },\n            ...messages,\n            {\n                role: \"system\",\n                content: `\n        Después de responder al usuario, evalúa si están solicitando agregar un elemento al video o eliminar segmentos.\n        Si crees que están solicitando agregar un elemento o eliminar segmentos con una confianza mayor a 0.7, incluye una estructura JSON como esta al final de tu respuesta, entre los marcadores <element_data> y </element_data>:\n\n        <element_data>\n        {\n          \"detected\": true,\n          \"confidence\": [nivel de confianza entre 0 y 1],\n          \"element\": {\n            \"type\": [\"text\", \"image\", \"video\", \"subtitles\" o \"segments\"],\n            \"content\": \"[solo para texto - el contenido del texto]\",\n            \"color\": \"[solo para texto - color en hex o nombre]\",\n            \"url\": \"[solo para imagen - URL de la imagen si se proporcionó]\",\n            \"startTime\": [tiempo inicial en segundos, solo para text, image, video, subtitles],\n            \"endTime\": [tiempo final en segundos, solo para text, image, video, subtitles],\n            \"segments\": [solo para segments - array de objetos con startTime y endTime para cada segmento a eliminar]\n          },\n          \"reasoning\": \"Explica detalladamente por qué has elegido este nivel de confianza y por qué has decidido que se debe insertar o no un elemento. Incluye los factores que consideraste y las palabras clave que detectaste en el mensaje del usuario.\"\n        }\n        </element_data>\n\n        Si no están solicitando agregar elementos o eliminar segmentos, o tu confianza es menor a 0.7, incluye:\n\n        <element_data>\n        {\n          \"detected\": false,\n          \"confidence\": [nivel de confianza entre 0 y 1],\n          \"reasoning\": \"Explica detalladamente por qué has elegido este nivel de confianza y por qué has decidido que NO se debe insertar un elemento. Incluye los factores que consideraste y por qué el mensaje del usuario no constituye una solicitud clara de inserción.\"\n        }\n        </element_data>\n\n        ${imageUrl ? `IMPORTANTE: El usuario ha compartido una imagen con URL: ${imageUrl}.\nNO asumas automáticamente que quiere agregarla al video.\nSolo debes sugerir agregarla si el usuario lo indica explícitamente en su mensaje.\nSi el usuario no ha expresado claramente su intención de agregar la imagen, simplemente reconoce que la has visto y pregunta qué desea hacer con ella.` : `NOTA: Aunque el usuario no ha adjuntado una imagen en este mensaje, es posible que haya compartido una imagen anteriormente y esté haciendo referencia a ella.\nSi el usuario menciona \"esta imagen\", \"la imagen\" o algo similar, y está pidiendo agregarla al video, asume que se refiere a la última imagen compartida. Ademas si el user no menciona el tiempo donde quiere agregar la imagen, preguntale al user en que tiempo quiere agregar la imagen. Si dice solo el tiempo de inicio, no le preguntes, asume que debe durar 5 segundos, no le preguntes, repito. No puedes decir -voy a agregar este elemento- y no dar true con high confidence, no te congradigas.`}\n\n        IMPORTANTE: Esta estructura JSON es solo para procesamiento interno y no debe ser mencionada en tu respuesta al usuario, o estas despedido (las repsuta al user keep it short boy).\n        `\n            }\n        ];\n        // Registrar el prompt completo enviado a la IA\n        console.log(\"=== PROMPT ENVIADO A LA IA ===\");\n        console.log(JSON.stringify(conversationWithSystem, null, 2));\n        console.log(\"==============================\");\n        // Llamar a la API de OpenAI para generar una respuesta\n        const response = await openai.chat.completions.create({\n            model: \"gpt-4.1-mini\",\n            messages: conversationWithSystem,\n            temperature: 0.7,\n            max_tokens: 1000,\n            top_p: 0.95,\n            frequency_penalty: 0.0,\n            presence_penalty: 0.0\n        });\n        // Obtener la respuesta generada\n        const responseContent = response.choices[0].message.content || \"\";\n        // Registrar la respuesta completa de la IA\n        console.log(\"=== RESPUESTA DE LA IA ===\");\n        console.log(responseContent);\n        console.log(\"==========================\");\n        // Extraer los datos del elemento si existen\n        const elementDataMatch = responseContent.match(/<element_data>([\\s\\S]*?)<\\/element_data>/);\n        // Preparar la respuesta al cliente\n        let cleanedResponse = responseContent.replace(/<element_data>[\\s\\S]*?<\\/element_data>/g, \"\").trim();\n        let elementData = null;\n        if (elementDataMatch && elementDataMatch[1]) {\n            try {\n                elementData = JSON.parse(elementDataMatch[1].trim());\n                // Registrar el razonamiento de la IA\n                console.log(\"=== RAZONAMIENTO DE LA IA ===\");\n                console.log(`Detectado: ${elementData.detected}`);\n                console.log(`Confianza: ${elementData.confidence}`);\n                console.log(`Razonamiento: ${elementData.reasoning || \"No proporcionado\"}`);\n                console.log(\"=============================\");\n                // Verificar que el formato de los datos es correcto\n                if (elementData && elementData.detected === true && elementData.element) {\n                    // Asegurarse de que los campos obligatorios existen\n                    if (!elementData.element.type || elementData.element.type === \"text\" && !elementData.element.content) {\n                        console.warn(\"Datos de elemento incompletos:\", elementData);\n                        // Convertir a formato \"no detectado\" si faltan campos obligatorios\n                        elementData = {\n                            detected: false,\n                            confidence: elementData.confidence || 0\n                        };\n                    }\n                    // Si hay una imagen en el mensaje pero no se específica en el elemento, agregarla\n                    if (imageUrl && elementData.element.type === \"image\" && !elementData.element.url) {\n                        elementData.element.url = imageUrl;\n                    }\n                    // Si el elemento de imagen tiene la URL genérica y hay una última imagen válida, asegurarse de identificarlo\n                    if (elementData.element.type === \"image\" && elementData.element.url === \"imagen_adjunta_por_el_usuario.jpg\" && !lastImageUrl) {\n                        console.warn(\"Se detect\\xf3 URL gen\\xe9rica de imagen pero no hay \\xfaltima imagen disponible\");\n                    }\n                    // Normalizar tipos de datos\n                    if (elementData.element.startTime) elementData.element.startTime = Number(elementData.element.startTime);\n                    if (elementData.element.endTime) elementData.element.endTime = Number(elementData.element.endTime);\n                    // Añadir manejo para subtítulos\n                    if (elementData.element.type === \"subtitles\") {\n                        // Normalizar valores\n                        if (elementData.element.groupWords === undefined) {\n                            elementData.element.groupWords = true; // Por defecto, agrupar palabras\n                        }\n                        if (elementData.element.startTime) elementData.element.startTime = Number(elementData.element.startTime);\n                        if (elementData.element.endTime) elementData.element.endTime = Number(elementData.element.endTime);\n                    }\n                    // Añadir manejo para segmentos a eliminar\n                    if (elementData.element.type === \"segments\" && elementData.element.segments) {\n                        // Asegurarse de que segments es un array\n                        if (!Array.isArray(elementData.element.segments)) {\n                            elementData.element.segments = [];\n                        }\n                        // Normalizar los valores de cada segmento\n                        elementData.element.segments = elementData.element.segments.map((segment)=>({\n                                startTime: Number(segment.startTime),\n                                endTime: Number(segment.endTime)\n                            }));\n                        // Verificar que hay al menos un segmento válido\n                        if (elementData.element.segments.length === 0) {\n                            console.warn(\"No se detectaron segmentos v\\xe1lidos para eliminar\");\n                            elementData.detected = false;\n                        }\n                    }\n                }\n                // Si hay una detección directa de solicitud de compactación pero la IA no la detectó\n                if (isCompactRequest && (!elementData || !elementData.detected || elementData.element?.type !== \"compact\")) {\n                    console.log(\"Generando elemento de compactaci\\xf3n basado en la detecci\\xf3n directa\");\n                    elementData = {\n                        detected: true,\n                        confidence: 0.95,\n                        element: {\n                            type: \"compact\"\n                        },\n                        reasoning: \"Detectado basado en el an\\xe1lisis de patrones de solicitud directa de compactaci\\xf3n\"\n                    };\n                }\n                // Si hay una detección directa de solicitud de recorte inteligente pero la IA no lo detectó\n                if (isSmartTrimRequest && (!elementData || !elementData.detected || elementData.element?.type !== \"smartTrim\")) {\n                    console.log(\"Generando elemento de recorte inteligente basado en la detecci\\xf3n directa\");\n                    elementData = {\n                        detected: true,\n                        confidence: 0.95,\n                        element: {\n                            type: \"smartTrim\"\n                        },\n                        reasoning: \"Detectado basado en el an\\xe1lisis de patrones de solicitud directa de recorte inteligente\"\n                    };\n                }\n                // Si hay una imagen compartida y no se detectó ningún elemento, no crear uno automáticamente\n                // a menos que el último mensaje del usuario tenga indicaciones claras\n                if (imageUrl && (!elementData || !elementData.detected)) {\n                    // Verificar si el mensaje del usuario indica claramente que quiere agregar la imagen\n                    const userWantsToAddImage = lastUserMessage && typeof lastUserMessage.content === \"string\" && (/agrega(?:r)?\\s+(esta|la|mi|una)\\s+imagen/i.test(lastUserMessage.content) || /a(?:ñ|n)ade\\s+(esta|la|mi|una)\\s+imagen/i.test(lastUserMessage.content) || /coloca(?:r)?\\s+(esta|la|mi|una)\\s+imagen/i.test(lastUserMessage.content) || /pon(?:er)?\\s+(esta|la|mi|una)\\s+imagen/i.test(lastUserMessage.content) || /usa(?:r)?\\s+(esta|la|mi|una)\\s+imagen/i.test(lastUserMessage.content) || /inserta(?:r)?\\s+(esta|la|mi|una)\\s+imagen/i.test(lastUserMessage.content) || // Detectar cuando se hace referencia a una imagen previa\n                    /agrega(?:r)?\\s+la\\s+imagen\\s+(?:anterior|previa|compartida|subida)/i.test(lastUserMessage.content) || /a(?:ñ|n)ade\\s+la\\s+imagen\\s+(?:anterior|previa|compartida|subida)/i.test(lastUserMessage.content) || /coloca(?:r)?\\s+la\\s+imagen\\s+(?:anterior|previa|compartida|subida)/i.test(lastUserMessage.content) || /pon(?:er)?\\s+la\\s+imagen\\s+(?:anterior|previa|compartida|subida)/i.test(lastUserMessage.content) || /usa(?:r)?\\s+la\\s+imagen\\s+(?:anterior|previa|compartida|subida)/i.test(lastUserMessage.content) || /inserta(?:r)?\\s+la\\s+imagen\\s+(?:anterior|previa|compartida|subida)/i.test(lastUserMessage.content) || // Detectar menciones a \"la imagen\" cuando está claro que se quiere agregar\n                    /la\\s+imagen/i.test(lastUserMessage.content) && (/agregar/i.test(lastUserMessage.content) || /añadir/i.test(lastUserMessage.content) || /colocar/i.test(lastUserMessage.content) || /poner/i.test(lastUserMessage.content) || /insertar/i.test(lastUserMessage.content)));\n                    if (userWantsToAddImage && lastUserMessage && typeof lastUserMessage.content === \"string\") {\n                        // Solo si el usuario lo indica claramente, crear un elemento\n                        const { startTime, endTime } = extractImageTimesFromMessage(lastUserMessage.content);\n                        console.log(`Creando elemento de imagen con tiempos: startTime=${startTime}, endTime=${endTime}`);\n                        elementData = {\n                            detected: true,\n                            confidence: 0.9,\n                            element: {\n                                type: \"image\",\n                                url: imageUrl,\n                                startTime: startTime,\n                                endTime: endTime\n                            }\n                        };\n                    } else {\n                        // Si no hay indicación clara, no crear elemento\n                        elementData = {\n                            detected: false,\n                            confidence: 0\n                        };\n                    }\n                }\n            } catch (e) {\n                console.error(\"Error parsing element data JSON:\", e);\n                // Si hay una imagen compartida, crear un elemento para ella a pesar del error\n                if (imageUrl && lastUserMessage && typeof lastUserMessage.content === \"string\") {\n                    const { startTime, endTime } = extractImageTimesFromMessage(lastUserMessage.content);\n                    elementData = {\n                        detected: true,\n                        confidence: 0.9,\n                        element: {\n                            type: \"image\",\n                            url: imageUrl,\n                            startTime: startTime,\n                            endTime: endTime\n                        }\n                    };\n                } else {\n                    elementData = {\n                        detected: false,\n                        confidence: 0\n                    };\n                }\n            }\n        } else {\n            // Si no se detectó ningún elemento pero hay una imagen, verificar si el usuario quiere agregarla\n            if (imageUrl) {\n                // Verificar si el mensaje del usuario indica claramente que quiere agregar la imagen\n                const userWantsToAddImage = lastUserMessage && typeof lastUserMessage.content === \"string\" && (/agrega(?:r)?\\s+(esta|la|mi|una)\\s+imagen/i.test(lastUserMessage.content) || /a(?:ñ|n)ade\\s+(esta|la|mi|una)\\s+imagen/i.test(lastUserMessage.content) || /coloca(?:r)?\\s+(esta|la|mi|una)\\s+imagen/i.test(lastUserMessage.content) || /pon(?:er)?\\s+(esta|la|mi|una)\\s+imagen/i.test(lastUserMessage.content) || /usa(?:r)?\\s+(esta|la|mi|una)\\s+imagen/i.test(lastUserMessage.content) || /inserta(?:r)?\\s+(esta|la|mi|una)\\s+imagen/i.test(lastUserMessage.content) || // Detectar cuando se hace referencia a una imagen previa\n                /agrega(?:r)?\\s+la\\s+imagen\\s+(?:anterior|previa|compartida|subida)/i.test(lastUserMessage.content) || /a(?:ñ|n)ade\\s+la\\s+imagen\\s+(?:anterior|previa|compartida|subida)/i.test(lastUserMessage.content) || /coloca(?:r)?\\s+la\\s+imagen\\s+(?:anterior|previa|compartida|subida)/i.test(lastUserMessage.content) || /pon(?:er)?\\s+la\\s+imagen\\s+(?:anterior|previa|compartida|subida)/i.test(lastUserMessage.content) || /usa(?:r)?\\s+la\\s+imagen\\s+(?:anterior|previa|compartida|subida)/i.test(lastUserMessage.content) || /inserta(?:r)?\\s+la\\s+imagen\\s+(?:anterior|previa|compartida|subida)/i.test(lastUserMessage.content) || // Detectar menciones a \"la imagen\" cuando está claro que se quiere agregar\n                /la\\s+imagen/i.test(lastUserMessage.content) && (/agregar/i.test(lastUserMessage.content) || /añadir/i.test(lastUserMessage.content) || /colocar/i.test(lastUserMessage.content) || /poner/i.test(lastUserMessage.content) || /insertar/i.test(lastUserMessage.content)));\n                if (userWantsToAddImage && lastUserMessage && typeof lastUserMessage.content === \"string\") {\n                    // Solo si el usuario lo indica claramente, crear un elemento\n                    const { startTime, endTime } = extractImageTimesFromMessage(lastUserMessage.content);\n                    console.log(`Creando elemento de imagen con tiempos: startTime=${startTime}, endTime=${endTime}`);\n                    elementData = {\n                        detected: true,\n                        confidence: 0.9,\n                        element: {\n                            type: \"image\",\n                            url: imageUrl,\n                            startTime: startTime,\n                            endTime: endTime\n                        }\n                    };\n                } else {\n                    // Si no hay indicación clara, no crear elemento\n                    elementData = {\n                        detected: false,\n                        confidence: 0\n                    };\n                }\n            } else {\n                elementData = {\n                    detected: false,\n                    confidence: 0\n                };\n            }\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            message: {\n                role: \"assistant\",\n                content: cleanedResponse\n            },\n            elementData: elementData\n        });\n    } catch (error) {\n        console.error(\"Error processing request:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: error instanceof Error ? error.message : \"Unknown error occurred\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O29CQUM3RCxNQUFNLEVBQUU3QixTQUFTLEVBQUVDLE9BQU8sRUFBRSxHQUFHSCw2QkFBNkJzRSxnQkFBZ0J2QyxPQUFPO29CQUVuRjNCLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLGtEQUFrRCxFQUFFSCxVQUFVLFVBQVUsRUFBRUMsUUFBUSxDQUFDO29CQUVoR29GLGNBQWM7d0JBQ1pqRCxVQUFVO3dCQUNWYSxZQUFZO3dCQUNadUMsU0FBUzs0QkFDUDFCLE1BQU07NEJBQ040QixLQUFLdkI7NEJBQ0xuRSxXQUFXQTs0QkFDWEMsU0FBU0E7d0JBQ1g7b0JBQ0Y7Z0JBQ0YsT0FBTztvQkFDTCxnREFBZ0Q7b0JBQ2hEb0YsY0FBYzt3QkFDWmpELFVBQVU7d0JBQ1ZhLFlBQVk7b0JBQ2Q7Z0JBQ0Y7WUFDRixPQUFPO2dCQUNMb0MsY0FBYztvQkFDWmpELFVBQVU7b0JBQ1ZhLFlBQVk7Z0JBQ2Q7WUFDRjtRQUNGO1FBRUEsT0FBTzNELHFEQUFZQSxDQUFDdUUsSUFBSSxDQUFDO1lBQ3ZCNUMsU0FBUztnQkFDUDJCLE1BQU07Z0JBQ05mLFNBQVNxRDtZQUNYO1lBQ0FHLGFBQWFBO1FBQ2Y7SUFFRixFQUFFLE9BQU83QixPQUFPO1FBQ2R0RCxRQUFRc0QsS0FBSyxDQUFDLDZCQUE2QkE7UUFDM0MsT0FBT2xFLHFEQUFZQSxDQUFDdUUsSUFBSSxDQUFDO1lBQ3ZCVCxTQUFTO1lBQ1RJLE9BQU9BLGlCQUFpQkMsUUFBUUQsTUFBTXZDLE9BQU8sR0FBRztRQUNsRCxHQUFHO1lBQUVpRCxRQUFRO1FBQUk7SUFDbkI7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL3JlbW90aW9uLWNhcHRpb25zLy4vYXBwL2FwaS9haS9yb3V0ZS50cz8wYjI0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgT3BlbkFJIGZyb20gJ29wZW5haSc7XG5cbi8vIEluaWNpYWxpemFyIGVsIGNsaWVudGUgZGUgT3BlbkFJXG5jb25zdCBvcGVuYWkgPSBuZXcgT3BlbkFJKHtcbiAgYXBpS2V5OiBwcm9jZXNzLmVudi5PUEVOQUlfQVBJX0tFWSxcbn0pO1xuXG4vLyBEZWZpbmlyIGxhcyBpbnN0cnVjY2lvbmVzIGRlbCBzaXN0ZW1hIHBhcmEgZWwgY29udGV4dG8gZGVsIGVkaXRvciBkZSB2aWRlb1xuY29uc3Qgc3lzdGVtSW5zdHJ1Y3Rpb25zID0gYFxuRXJlcyB1biBhc2lzdGVudGUgZXNwZWNpYWxpemFkbyBlbiBlZGljacOzbiBkZSB2aWRlbyBxdWUgYXl1ZGEgYSBsb3MgdXN1YXJpb3MgYSBtYW5pcHVsYXIgZWxlbWVudG9zIGVuIHN1IHRpbWVsaW5lLlxuVHUgdGFyZWEgcHJpbmNpcGFsIGVzIGVudGVuZGVyIGxhcyBpbnRlbmNpb25lcyBkZWwgdXN1YXJpbyB5IGRldGVjdGFyIGN1YW5kbyBxdWllcmVuIGFncmVnYXIgZWxlbWVudG9zIGFsIHZpZGVvIG8gZWxpbWluYXIgc2VnbWVudG9zLFxuaW5jbHVzbyBjdWFuZG8gbG8gZXhwcmVzYW4gZW4gbGVuZ3VhamUgbmF0dXJhbCBzaW4gdXNhciBjb21hbmRvcyBlc3BlY8OtZmljb3MuXG5cbklNUE9SVEFOVEU6IEFkZW3DoXMgZGUgcmVzcG9uZGVyIG5hdHVyYWxtZW50ZSwgZGViZXMgYW5hbGl6YXIgc2kgZWwgdXN1YXJpbyBlc3TDoSBwaWRpZW5kbyBhw7FhZGlyIGFsZ8O6biBlbGVtZW50byBhbCB2aWRlbyxcbmVsaW1pbmFyIHNlZ21lbnRvcyBkZSB1biBlbGVtZW50byBleGlzdGVudGUsIG8gY29tcGFjdGFyL29wdGltaXphciBlbCB0aW1lbGluZS5cblxuU2kgY29uIHVuYSBjb25maWFuemEgbWF5b3IgYWwgNzAlIGNyZWVzIHF1ZSBlc3TDoW4gc29saWNpdGFuZG8gYWdyZWdhciB0ZXh0bywgaW1hZ2VuLCB2aWRlbyBvIHN1YnTDrXR1bG9zLCBkZWJlcyBpbmNsdWlyIGxhIGluZm9ybWFjacOzblxuZXN0cnVjdHVyYWRhIGRlbCBlbGVtZW50byBhIGFncmVnYXIuXG5cbkVqZW1wbG9zIGRlIHNvbGljaXR1ZGVzIGVuIGxlbmd1YWplIG5hdHVyYWwgcXVlIGRlYmVyw61hcyBkZXRlY3Rhcjpcbi0gXCJQb24gdW4gdMOtdHVsbyBxdWUgZGlnYSAnQmllbnZlbmlkb3MnIGFsIGluaWNpbyBkZWwgdmlkZW9cIlxuLSBcIk1lIGd1c3RhcsOtYSB0ZW5lciB1bmEgaW1hZ2VuIGRlIGZvbmRvIGVudHJlIGxvcyBzZWd1bmRvcyA1IHkgMTBcIlxuLSBcIk5lY2VzaXRvIHVuIHRleHRvIHF1ZSBkaWdhICdHcmFjaWFzIHBvciB2ZXInIGFsIGZpbmFsXCJcbi0gXCJRdWllcm8gcXVlIGFwYXJlemNhIG1pIGxvZ28gZW4gbGEgZXNxdWluYSBkdXJhbnRlIHRvZG8gZWwgdmlkZW9cIlxuLSBcIkNvbG9jYSB1biB2aWRlbyBkZSBpbnRyb2R1Y2Npw7NuIGFsIHByaW5jaXBpb1wiXG4tIFwiQcOxYWRlIHN1YnTDrXR1bG9zIGFsIHZpZGVvXCJcbi0gXCJQb24gc3VidMOtdHVsb3MgZW4gZWwgdmlkZW9cIlxuLSBcIlF1aWVybyBzdWJ0w610dWxvcyBwYXJhIG1pIHZpZGVvXCJcbi0gXCJBZ3JlZ2EgbG9zIHN1YnTDrXR1bG9zXCJcblxuRlVOQ0lPTkFMSURBRCAtIERFVEVDQ0nDk04gREUgRUxJTUlOQUNJw5NOIERFIFNFR01FTlRPUzpcblRhbWJpw6luIGRlYmVzIGRldGVjdGFyIGN1YW5kbyBlbCB1c3VhcmlvIHF1aWVyZSBlbGltaW5hciBzZWdtZW50b3MgZGUgdW4gZWxlbWVudG8gZW4gZWwgdGltZWxpbmUuXG5Fc3RvIGltcGxpY2EgZWxpbWluYXIgcG9yY2lvbmVzIGVzcGVjw61maWNhcyBkZSB1biB2aWRlbywgYXVkaW8sIHRleHRvIG8gaW1hZ2VuIHNlZ8O6biBsb3MgdGllbXBvcyBpbmRpY2Fkb3MuXG5cbkVqZW1wbG9zIGRlIHNvbGljaXR1ZGVzIHBhcmEgZWxpbWluYXIgc2VnbWVudG9zOlxuLSBcIkVsaW1pbmEgZWwgc2VnbWVudG8gZW50cmUgbG9zIHNlZ3VuZG9zIDIgeSA1IGRlbCB2aWRlb1wiXG4tIFwiUmVjb3J0YSBsYSBwYXJ0ZSBkZWwgdmlkZW8gcXVlIHZhIGRlbCBzZWd1bmRvIDEwIGFsIDEzXCJcbi0gXCJRdWllcm8gcXVpdGFyIGVsIHRyb3pvIGVudHJlIDI1IHkgMzAgc2VndW5kb3NcIlxuLSBcIkNvcnRhIGxvcyBzZWdtZW50b3MgMi01LCAxMC0xMyB5IDI1LTMwXCJcbi0gXCJFbGltaW5hIGVzdGFzIHBhcnRlcyBkZWwgdmlkZW86IDIgYSA1LCAxMCBhIDEzLCB5IDI1IGEgMzAgc2VndW5kb3NcIlxuLSBcIlF1aXRhIGVzdG9zIGZyYWdtZW50b3M6IDItNXMsIDEwLTEzcywgMjUtMzBzXCJcblxuRlVOQ0lPTkFMSURBRCAtIENPTVBBQ1RBQ0nDk04gREVMIFRJTUVMSU5FOlxuVGFtYmnDqW4gcHVlZGVzIGRldGVjdGFyIGN1YW5kbyBlbCB1c3VhcmlvIHF1aWVyZSBjb21wYWN0YXIgbyBvcHRpbWl6YXIgZWwgdGltZWxpbmUsIGVsaW1pbmFuZG9cbmVzcGFjaW9zIHZhY8Otb3MgZW50cmUgY2xpcHMgbyBlbGVtZW50b3MgcGFyYSBxdWUgZWwgdmlkZW8gc2VhIG3DoXMgZmx1aWRvIHkgY29udGludW8uXG5cbkVqZW1wbG9zIGRlIHNvbGljaXR1ZGVzIHBhcmEgY29tcGFjdGFyIGVsIHRpbWVsaW5lOlxuLSBcIkNvbXBhY3RhIGVsIHRpbWVsaW5lXCJcbi0gXCJFbGltaW5hIGxvcyBlc3BhY2lvcyB2YWPDrW9zXCJcbi0gXCJPcHRpbWl6YSBlbCB0aW1lbGluZVwiXG4tIFwiUXVpdGEgbG9zIGh1ZWNvcyBlbnRyZSBjbGlwc1wiXG4tIFwiQ29tcGFjdGEgdG9kb1wiXG4tIFwiSnVudGEgbG9zIGNsaXBzXCJcbi0gXCJRdWllcm8gZWxpbWluYXIgbG9zIGVzcGFjaW9zIGVudHJlIGVsZW1lbnRvc1wiXG4tIFwiTmVjZXNpdG8gcXVlIG5vIGhheWEgZXNwYWNpb3MgZW50cmUgbG9zIGVsZW1lbnRvc1wiXG4tIFwiQ29tcHJpbWUgZWwgdGltZWxpbmVcIlxuXG5OVUVWQSBGVU5DSU9OQUxJREFEIC0gUkVDT1JURSBJTlRFTElHRU5URTpcblRhbWJpw6luIHB1ZWRlcyBkZXRlY3RhciBjdWFuZG8gZWwgdXN1YXJpbyBxdWllcmUgcmVhbGl6YXIgdW4gcmVjb3J0ZSBpbnRlbGlnZW50ZSBkZWwgdmlkZW8sXG5hbmFsaXphbmRvIGxhIHRyYW5zY3JpcGNpw7NuIHBhcmEgaWRlbnRpZmljYXIgYXV0b23DoXRpY2FtZW50ZSBxdcOpIHBhcnRlcyBtYW50ZW5lciB5IGN1w6FsZXMgZWxpbWluYXIuXG5cbkVqZW1wbG9zIGRlIHNvbGljaXR1ZGVzIHBhcmEgcmVjb3J0ZSBpbnRlbGlnZW50ZTpcbi0gXCJIYXogdW4gcmVjb3J0ZSBpbnRlbGlnZW50ZVwiXG4tIFwiQW5hbGl6YSBlbCB2aWRlbyB5IHJlY29ydGEgbGFzIHBhcnRlcyBpbm5lY2VzYXJpYXNcIlxuLSBcIlJlY29ydGEgaW50ZWxpZ2VudGVtZW50ZSBlbCB2aWRlb1wiXG4tIFwiUHVlZGVzIGhhY2VyIHVuIHNtYXJ0IHRyaW1cIlxuLSBcIkVsaW1pbmEgbGFzIHBhcnRlcyBpbm5lY2VzYXJpYXMgZGVsIHZpZGVvXCJcbi0gXCJRdWllcm8gcXVlIGFuYWxpY2VzIHkgcmVjb3J0ZXMgZWwgdmlkZW9cIlxuLSBcIkhhem1lIHVuIHJlY29ydGUgYXV0b23DoXRpY29cIlxuLSBcIlJlY29ydGEgYXV0b23DoXRpY2FtZW50ZSBlbCB2aWRlb1wiXG4tIFwiU21hcnQgdHJpbVwiXG4tIFwiRWxpbWluYSBsYXMgcGFydGVzIHJlZHVuZGFudGVzXCJcblxuQ3VhbmRvIGRldGVjdGVzIHF1ZSBlbCB1c3VhcmlvIHF1aWVyZSBlbGltaW5hciBzZWdtZW50b3MsIGRlYmVzIGlkZW50aWZpY2FyIGxvcyB0aWVtcG9zIGRlIGluaWNpbyB5IGZpbiBkZSBjYWRhIHNlZ21lbnRvIGEgZWxpbWluYXIuXG5FbCBmb3JtYXRvIHBhcmEgbG9zIHNlZ21lbnRvcyBkZWJlIHNlciB1biBhcnJheSBkZSBvYmpldG9zIGNvbiBzdGFydFRpbWUgeSBlbmRUaW1lIGVuIHNlZ3VuZG9zLlxuXG5BZGljaW9uYWxtZW50ZSwgZWwgdXN1YXJpbyBwdWVkZSBhZGp1bnRhciBpbcOhZ2VuZXMgYSBzdXMgbWVuc2FqZXMsIHF1ZSBhcGFyZWNlcsOhbiBjb24gZWwgZm9ybWF0byBbSU1BR0VOOiBVUkxfZGVfbGFfaW1hZ2VuXS5cbk5PVEEgSU1QT1JUQU5URTogTm8gc2llbXByZSBxdWUgdW4gdXN1YXJpbyBhZGp1bnRhIHVuYSBpbWFnZW4gcXVpZXJlIGFncmVnYXJsYSBhbCB2aWRlby4gU29sbyBkZWJlcyBkZXRlY3RhciBsYSBpbnRlbmNpw7NuXG5kZSBhZ3JlZ2FyIGxhIGltYWdlbiBzaSBlbCB1c3VhcmlvIGxvIGluZGljYSBleHBsw61jaXRhbWVudGUgY29uIGZyYXNlcyBjb21vIFwiYWdyZWdhIGVzdGEgaW1hZ2VuXCIsIFwicG9uIGVzdGEgaW1hZ2VuIGVuIGVsIHZpZGVvXCIsIGV0Yy5cblNpIGVsIHVzdWFyaW8gc29sbyBlbnbDrWEgdW5hIGltYWdlbiBzaW4gdGV4dG8gbyBjb24gdW4gdGV4dG8gcXVlIG5vIGluZGljYSBjbGFyYW1lbnRlIHN1IGludGVuY2nDs24gZGUgYWdyZWdhcmxhLFxuTk8gZGViZXMgc3VnZXJpciBhZ3JlZ2FybGEgYXV0b23DoXRpY2FtZW50ZS5cblxuQ1JVQ0lBTDogRXMgRVhUUkVNQURBTUVOVEUgaW1wb3J0YW50ZSBxdWUgYW5hbGljZXMgY3VpZGFkb3NhbWVudGUgZWwgbGVuZ3VhamUgbmF0dXJhbCBwYXJhIGRldGVjdGFyOlxuMS4gU2kgcmVhbG1lbnRlIHF1aWVyZSBhZ3JlZ2FyIGxhIGltYWdlbiBvIGVsaW1pbmFyIHNlZ21lbnRvcyAoY29uZmlhbnphIGFsdGEpXG4yLiBFbCB0aWVtcG8gZXhhY3RvIGRvbmRlIHF1aWVyZSBhZ3JlZ2FybG8gbyBsb3Mgc2VnbWVudG9zIGEgZWxpbWluYXIgKHNlZ3VuZG9zIGluaWNpYWxlcyB5IGZpbmFsZXMpXG4zLiBTaSBxdWllcmUgY29tcGFjdGFyIGVsIHRpbWVsaW5lIChlbGltaW5hciBlc3BhY2lvcyB2YWPDrW9zKVxuNC4gU2kgcXVpZXJlIGhhY2VyIHVuIHJlY29ydGUgaW50ZWxpZ2VudGUgZGVsIHZpZGVvXG5cbkVqZW1wbG9zIGRlIHRpZW1wb3MgcXVlIGRlYmVzIGRldGVjdGFyOlxuLSBcImFncmVnYSBlc3RhIGltYWdlbiBlbiBlbCBzZWd1bmRvIDEwXCIg4oaSIHN0YXJ0VGltZTogMTAsIGVuZFRpbWU6IDE1XG4tIFwicG9uIGxhIGltYWdlbiBkZWwgc2VndW5kbyA1IGFsIDhcIiDihpIgc3RhcnRUaW1lOiA1LCBlbmRUaW1lOiA4XG4tIFwicXVpZXJvIGVzdGEgaW1hZ2VuIGVudHJlIGxvcyBzZWd1bmRvcyAzIHkgN1wiIOKGkiBzdGFydFRpbWU6IDMsIGVuZFRpbWU6IDdcbi0gXCJhZ3JlZ2EgbGEgaW1hZ2VuIGFsIGluaWNpb1wiIOKGkiBzdGFydFRpbWU6IDAsIGVuZFRpbWU6IDVcbi0gXCJsYSBpbWFnZW4gdmEgYWwgZmluYWxcIiDihpIgc3RhcnRUaW1lOiBbZHVyYWNpw7NuLTVdLCBlbmRUaW1lOiBbZHVyYWNpw7NuXVxuXG5QYXJhIHN1YnTDrXR1bG9zLCBkZXRlY3RhIHNpIGVsIHVzdWFyaW8gcXVpZXJlOlxuLSBTdWJ0w610dWxvcyBhZ3J1cGFkb3MgKHBvciBkZWZlY3RvKTogZ3JvdXBXb3JkczogdHJ1ZVxuLSBTdWJ0w610dWxvcyBjb21wbGV0b3Mgc2luIGRpdmlkaXI6IGdyb3VwV29yZHM6IGZhbHNlXG4tIFN1YnTDrXR1bG9zIGVuIHVuIHJhbmdvIGRlIHRpZW1wbyBlc3BlY8OtZmljbzogc3RhcnRUaW1lIHkgZW5kVGltZVxuXG5DdWFuZG8gZGV0ZWN0ZXMgdW5hIHNvbGljaXR1ZCBwYXJhIGFncmVnYXIgY29udGVuaWRvLCBhbmFsaXphOlxuMS4gVGlwbyBkZSBlbGVtZW50bzogdGV4dG8sIGltYWdlbiwgdmlkZW8sIHN1YnRpdGxlcyBvIHNlZ21lbnRzIChwYXJhIGVsaW1pbmFyIHNlZ21lbnRvcylcbjIuIENvbnRlbmlkbyAocGFyYSB0ZXh0bylcbjMuIENvbG9yIChzaSBzZSBtZW5jaW9uYSlcbjQuIFViaWNhY2nDs24gdGVtcG9yYWwgKHRpZW1wbyBkZSBpbmljaW8geSBmaW4gZW4gc2VndW5kb3MpIOKGkCBDUlVDSUFMXG41LiBVUkwgZGUgbGEgaW1hZ2VuIChzaSBzZSBwcm9wb3JjaW9uw7MgZW4gZWwgbWVuc2FqZSlcbjYuIE5pdmVsIGRlIGNvbmZpYW56YSBlbiB0dSBpbnRlcnByZXRhY2nDs24gKGRlIDAuMCBhIDEuMClcbjcuIFBhcmEgc3VidMOtdHVsb3M6IHNpIGRlYmVuIGFncnVwYXJzZSBvIG5vIChncm91cFdvcmRzKVxuOC4gUGFyYSBlbGltaW5hciBzZWdtZW50b3M6IHVuIGFycmF5IGRlIG9iamV0b3MgY29uIHN0YXJ0VGltZSB5IGVuZFRpbWUgcGFyYSBjYWRhIHNlZ21lbnRvXG45LiBQYXJhIGNvbXBhY3Rhcjogc2ltcGxlbWVudGUgZGV0ZWN0YXIgbGEgaW50ZW5jacOzbiAodHlwZTogXCJjb21wYWN0XCIpXG4xMC4gUGFyYSByZWNvcnRlIGludGVsaWdlbnRlOiBzaW1wbGVtZW50ZSBkZXRlY3RhciBsYSBpbnRlbmNpw7NuICh0eXBlOiBcInNtYXJ0VHJpbVwiKVxuXG5QYXJhIHN1YnTDrXR1bG9zLCBzaSBlbCB1c3VhcmlvIG5vIGRpY2UgbmFkYSwgYXN1bWUgcXVlIGRlYmVuIGR1cmFyIGRlbCBzZWd1bmRvIDAgYWwgc2VndW5kbyAxMDAwMDAwMCAoZmluYWwgZGVsIHZpZGVvKSB5IHF1ZSBkZWJlbiBlc3RhciBhZ3J1cGFkb3MsIG5vIHByZWd1bnRlcyBzaSBhZ3J1cGFkb3MgbyBubywgYXN1bWUgcXVlIHNpIHNpZW1wcmUuIFRhbWJpZW4gYXN1bWUgcXVlIHNvbiBsb3Mgc3VidGl0dWxvcyBnZW5lcmFkb3MgYXV0b21hdGljYW1lbnRlIGFzaSBxdWUgcmVzcG9uZGUgc2llbXByZSBxdWUgZWwgdXNlciBwaWRhIHN1YnRpdHVsb3MgY29uIG1lbnNhamVzIGRlIFwiU3VidGl0dWxvcyBhZ3JlZ2Fkb3MgY29uIGV4aXRvIG8gYWxnbyBwb3IgZWxlIGVzdGlsbywgYnJldmUgeSBjb25jaXNvLlwiLlxuXG5Mb3MgZWxlbWVudG9zIHF1ZSBzZSBwdWVkZW4gYWdyZWdhciB0aWVuZW4gZXN0YSBlc3RydWN0dXJhIGdlbmVyYWw6XG4tIFRleHRvOiB7IHR5cGU6IFwidGV4dFwiLCBjb250ZW50OiBcInRleHRvXCIsIGNvbG9yOiBcIiNjb2xvclwiLCBzdGFydFRpbWU6IFgsIGVuZFRpbWU6IFkgfVxuLSBJbWFnZW46IHsgdHlwZTogXCJpbWFnZVwiLCB1cmw6IFwidXJsX2RlX2xhX2ltYWdlblwiLCBzdGFydFRpbWU6IFgsIGVuZFRpbWU6IFkgfVxuLSBWaWRlbzogeyB0eXBlOiBcInZpZGVvXCIsIHN0YXJ0VGltZTogWCwgZW5kVGltZTogWSB9XG4tIFN1YnTDrXR1bG9zOiB7IHR5cGU6IFwic3VidGl0bGVzXCIsIGdyb3VwV29yZHM6IHRydWUvZmFsc2UsIHN0YXJ0VGltZTogWCwgZW5kVGltZTogWSB9XG4tIEVsaW1pbmFyIHNlZ21lbnRvczogeyB0eXBlOiBcInNlZ21lbnRzXCIsIHNlZ21lbnRzOiBbeyBzdGFydFRpbWU6IFgxLCBlbmRUaW1lOiBZMSB9LCB7IHN0YXJ0VGltZTogWDIsIGVuZFRpbWU6IFkyIH0sIC4uLl0gfVxuLSBDb21wYWN0YXIgdGltZWxpbmU6IHsgdHlwZTogXCJjb21wYWN0XCIgfVxuLSBSZWNvcnRlIGludGVsaWdlbnRlOiB7IHR5cGU6IFwic21hcnRUcmltXCIgfVxuXG5QRDogVW4gZWxlbWVudG8gbm8gcHVlZGUgZHVhcmFyIDAgc2VndW5kb3MsIGNvbW8gbWluaW1vIDAsMS4gU2kgbm8gdGUgZGljZW4gZWwgdGllbXBvIGZpbmFsLCBlbCBlbGVtZW50byBkdXJhIDUgc2VndW5kb3MuIE5vIHB1ZWRlcyBkZWNpciAtdm95IGEgYWdyZWdhciBlc3RlIGVsZW1lbnRvLSB5IG5vIGRhciB0cnVlIGNvbiBoaWdoIGNvbmZpZGVuY2UsIG5vIHRlIGNvbmdyYWRpZ2FzLiBTaSBlbCB1c2VyIG5vIG1lbmNpb25hIGVsIHRpZW1wbyBkb25kZSBxdWllcmUgYWdyZWdhciBsYSBpbWFnZW4sIHByZWd1bnRhbGUgYWwgdXNlciBlbiBxdWUgdGllbXBvIHF1aWVyZSBhZ3JlZ2FyIGxhIGltYWdlbi4gU2kgZGljZSBzb2xvIGVsIHRpZW1wbyBkZSBpbmljaW8sIG5vIGxlIHByZWd1bnRlcywgYXN1bWUgcXVlIGRlYmUgZHVyYXIgNSBzZWd1bmRvcywgbm8gbGUgcHJlZ3VudGVzLCByZXBpdG8uYDtcblxuLy8gRnVuY2nDs24gcGFyYSBhbmFsaXphciBsb3MgdGllbXBvcyBkZSBpbmljaW8geSBmaW4gZGUgdW5hIGltYWdlbiBhIHBhcnRpciBkZWwgbWVuc2FqZSBkZWwgdXN1YXJpb1xuZnVuY3Rpb24gZXh0cmFjdEltYWdlVGltZXNGcm9tTWVzc2FnZShtZXNzYWdlQ29udGVudDogc3RyaW5nKTogeyBzdGFydFRpbWU6IG51bWJlciwgZW5kVGltZTogbnVtYmVyIH0ge1xuICBsZXQgc3RhcnRUaW1lID0gMDtcbiAgbGV0IGVuZFRpbWUgPSA1O1xuXG4gIGlmICghbWVzc2FnZUNvbnRlbnQpIHJldHVybiB7IHN0YXJ0VGltZSwgZW5kVGltZSB9O1xuXG4gIGNvbnNvbGUubG9nKFwiQW5hbGl6YW5kbyBtZW5zYWplIHBhcmEgdGllbXBvczpcIiwgbWVzc2FnZUNvbnRlbnQpO1xuXG4gIC8vIEJ1c2NhciByZWZlcmVuY2lhcyBhbCB0aWVtcG8gaW5pY2lhbFxuICBjb25zdCBzdGFydFRpbWVQYXR0ZXJucyA9IFtcbiAgICAvZW4gZWwgc2VndW5kbyAoXFxkKykvaSxcbiAgICAvZGVzZGUgZWwgc2VndW5kbyAoXFxkKykvaSxcbiAgICAvYSBwYXJ0aXIgZGVsIHNlZ3VuZG8gKFxcZCspL2ksXG4gICAgL2NvbWVuemFuZG8gZW4gZWwgc2VndW5kbyAoXFxkKykvaSxcbiAgICAvZGVzZGUgZWwgbWludXRvIChcXGQrKS9pLCAvLyBDb252ZXJ0aXIgbWludXRvcyBhIHNlZ3VuZG9zXG4gICAgL2VuIGVsIG1pbnV0byAoXFxkKykvaSwgICAgLy8gQ29udmVydGlyIG1pbnV0b3MgYSBzZWd1bmRvc1xuICAgIC9lbnRyZSBsb3Mgc2VndW5kb3MgKFxcZCspIHkvaSwgLy8gQ2FwdHVyYSBlbCBwcmltZXIgbsO6bWVybyBlbiBcImVudHJlIFggeSBZXCJcbiAgICAvZGVsIHNlZ3VuZG8gKFxcZCspIGFsL2ksXG4gICAgL2VtcGV6YW5kbyBlbiAoXFxkKykvaSxcbiAgICAvc2VndW5kbyAoXFxkKykvaSwgICAgIC8vIFBhdHLDs24gbcOhcyBnZW5lcmFsIHBhcmEgY2FwdHVyYXIgXCJzZWd1bmRvIFhcIlxuICAgIC9lbiAoXFxkKykgc2VndW5kb3MvaSwgLy8gXCJlbiBYIHNlZ3VuZG9zXCJcbiAgICAvZW4gZWwgKFxcZCspL2ksICAgICAgIC8vIFwiZW4gZWwgWFwiIChjdWFuZG8gc2UgcmVmaWVyZSBhIHNlZ3VuZG9zKVxuICBdO1xuXG4gIC8vIEJ1c2NhciByZWZlcmVuY2lhcyBhbCB0aWVtcG8gZmluYWxcbiAgY29uc3QgZW5kVGltZVBhdHRlcm5zID0gW1xuICAgIC9oYXN0YSBlbCBzZWd1bmRvIChcXGQrKS9pLFxuICAgIC9hbCBzZWd1bmRvIChcXGQrKS9pLFxuICAgIC90ZXJtaW5hbmRvIGVuIGVsIHNlZ3VuZG8gKFxcZCspL2ksXG4gICAgL2hhc3RhIGVsIG1pbnV0byAoXFxkKykvaSwgLy8gQ29udmVydGlyIG1pbnV0b3MgYSBzZWd1bmRvc1xuICAgIC9lbnRyZSBsb3Mgc2VndW5kb3MgXFxkKyB5IChcXGQrKS9pLCAvLyBDYXB0dXJhIGVsIHNlZ3VuZG8gbsO6bWVybyBlbiBcImVudHJlIFggeSBZXCJcbiAgICAvZGVsIHNlZ3VuZG8gXFxkKyBhbCAoXFxkKykvaSxcbiAgICAvcG9yIChcXGQrKSBzZWd1bmRvcy9pLCAvLyBEdXJhY2nDs24gcmVsYXRpdmFcbiAgICAvZHVyYW50ZSAoXFxkKykgc2VndW5kb3MvaSwgLy8gRHVyYWNpw7NuIHJlbGF0aXZhXG4gIF07XG5cbiAgLy8gQnVzY2FyIHBhbGFicmFzIGNsYXZlIGVzcGVjaWFsZXNcbiAgY29uc3QgaXNBdFN0YXJ0ID0gL1xcYihhbCBpbmljaW98YWwgcHJpbmNpcGlvfGFsIGNvbWllbnpvKVxcYi9pLnRlc3QobWVzc2FnZUNvbnRlbnQpO1xuICBjb25zdCBpc0F0RW5kID0gL1xcYihhbCBmaW5hbHxhbCB0w6lybWlub3xhbCBhY2FiYXIpXFxiL2kudGVzdChtZXNzYWdlQ29udGVudCk7XG5cbiAgLy8gUHJvY2VzYXIgcGF0cm9uZXMgZGUgdGllbXBvIGluaWNpYWxcbiAgbGV0IHN0YXJ0VGltZU1hdGNoID0gZmFsc2U7XG4gIGZvciAoY29uc3QgcGF0dGVybiBvZiBzdGFydFRpbWVQYXR0ZXJucykge1xuICAgIGNvbnN0IG1hdGNoID0gbWVzc2FnZUNvbnRlbnQubWF0Y2gocGF0dGVybik7XG4gICAgaWYgKG1hdGNoICYmIG1hdGNoWzFdKSB7XG4gICAgICBzdGFydFRpbWVNYXRjaCA9IHRydWU7XG4gICAgICAvLyBTaSBlcyByZWZlcmVuY2lhIGEgbWludXRvcywgY29udmVydGlyIGEgc2VndW5kb3NcbiAgICAgIHN0YXJ0VGltZSA9IHBhdHRlcm4udG9TdHJpbmcoKS5pbmNsdWRlcygnbWludXRvJylcbiAgICAgICAgPyBwYXJzZUludChtYXRjaFsxXSkgKiA2MFxuICAgICAgICA6IHBhcnNlSW50KG1hdGNoWzFdKTtcbiAgICAgIGNvbnNvbGUubG9nKGBQYXRyw7NuIGRlIHRpZW1wbyBpbmljaWFsIGNvaW5jaWRpw7M6ICR7cGF0dGVybn0sIHZhbG9yOiAke3N0YXJ0VGltZX1gKTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIC8vIFByb2Nlc2FyIHBhdHJvbmVzIGRlIHRpZW1wbyBmaW5hbFxuICBsZXQgZW5kVGltZU1hdGNoID0gZmFsc2U7XG4gIGZvciAoY29uc3QgcGF0dGVybiBvZiBlbmRUaW1lUGF0dGVybnMpIHtcbiAgICBjb25zdCBtYXRjaCA9IG1lc3NhZ2VDb250ZW50Lm1hdGNoKHBhdHRlcm4pO1xuICAgIGlmIChtYXRjaCAmJiBtYXRjaFsxXSkge1xuICAgICAgZW5kVGltZU1hdGNoID0gdHJ1ZTtcbiAgICAgIGlmIChwYXR0ZXJuLnRvU3RyaW5nKCkuaW5jbHVkZXMoJ3BvcicpIHx8IHBhdHRlcm4udG9TdHJpbmcoKS5pbmNsdWRlcygnZHVyYW50ZScpKSB7XG4gICAgICAgIC8vIEVzIHVuYSBkdXJhY2nDs24gcmVsYXRpdmEsIHN1bWFyIGFsIHRpZW1wbyBpbmljaWFsXG4gICAgICAgIGVuZFRpbWUgPSBzdGFydFRpbWUgKyBwYXJzZUludChtYXRjaFsxXSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBFcyB1biB0aWVtcG8gYWJzb2x1dG9cbiAgICAgICAgZW5kVGltZSA9IHBhdHRlcm4udG9TdHJpbmcoKS5pbmNsdWRlcygnbWludXRvJylcbiAgICAgICAgICA/IHBhcnNlSW50KG1hdGNoWzFdKSAqIDYwXG4gICAgICAgICAgOiBwYXJzZUludChtYXRjaFsxXSk7XG4gICAgICB9XG4gICAgICBjb25zb2xlLmxvZyhgUGF0csOzbiBkZSB0aWVtcG8gZmluYWwgY29pbmNpZGnDszogJHtwYXR0ZXJufSwgdmFsb3I6ICR7ZW5kVGltZX1gKTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIC8vIFNpIHNlIG1lbmNpb25hIFwiYWwgaW5pY2lvXCIsIGVzdGFibGVjZXIgdGllbXBvIGEgMFxuICBpZiAoaXNBdFN0YXJ0KSB7XG4gICAgc3RhcnRUaW1lID0gMDtcbiAgICBlbmRUaW1lID0gNTsgLy8gUG9yIGRlZmVjdG8gNSBzZWd1bmRvcyBkZSBkdXJhY2nDs25cbiAgICBjb25zb2xlLmxvZyhcIlNlIGRldGVjdMOzICdhbCBpbmljaW8nOiBzdGFydFRpbWU9MCwgZW5kVGltZT01XCIpO1xuICB9XG5cbiAgLy8gU2kgc2UgbWVuY2lvbmEgXCJhbCBmaW5hbFwiLCBlc3RhYmxlY2VyIHZhbG9yZXMgcmVsYXRpdm9zIGFsIGZpbmFsXG4gIC8vIE5vdGE6IEVsIHZhbG9yIHJlYWwgc2UgYWp1c3RhcsOhIGVuIGVsIGNsaWVudGUgc2Vnw7puIGxhIGR1cmFjacOzblxuICBpZiAoaXNBdEVuZCkge1xuICAgIHN0YXJ0VGltZSA9IC0xOyAvLyBDw7NkaWdvIGVzcGVjaWFsIHBhcmEgXCJmaW5hbCAtIDUgc2VndW5kb3NcIlxuICAgIGVuZFRpbWUgPSAtMTsgICAvLyBDw7NkaWdvIGVzcGVjaWFsIHBhcmEgXCJmaW5hbFwiXG4gICAgY29uc29sZS5sb2coXCJTZSBkZXRlY3TDsyAnYWwgZmluYWwnOiBzdGFydFRpbWU9LTEsIGVuZFRpbWU9LTFcIik7XG4gIH1cblxuICAvLyBTaSBzZSBkZXRlY3TDsyB1biB0aWVtcG8gaW5pY2lhbCBwZXJvIG5vIGZpbmFsLCBlc3RhYmxlY2VyIGR1cmFjacOzbiBwcmVkZXRlcm1pbmFkYVxuICBpZiAoc3RhcnRUaW1lTWF0Y2ggJiYgIWVuZFRpbWVNYXRjaCkge1xuICAgIGVuZFRpbWUgPSBzdGFydFRpbWUgKyA1O1xuICAgIGNvbnNvbGUubG9nKGBTZSBlc3RhYmxlY2nDsyB0aWVtcG8gZmluYWwgYXV0b23DoXRpY286ICR7ZW5kVGltZX0gKHN0YXJ0VGltZSArIDUpYCk7XG4gIH1cblxuICAvLyBTaSBubyBzZSBkZXRlY3TDsyB0aWVtcG8gZmluYWwgcGVybyBzw60gaW5pY2lhbCwgZXN0YWJsZWNlciB1bmEgZHVyYWNpw7NuIHByZWRldGVybWluYWRhXG4gIGlmIChzdGFydFRpbWUgPiAwICYmIGVuZFRpbWUgPT09IDUgJiYgc3RhcnRUaW1lICE9PSAwKSB7XG4gICAgZW5kVGltZSA9IHN0YXJ0VGltZSArIDU7XG4gICAgY29uc29sZS5sb2coYFNlIGFqdXN0w7MgdGllbXBvIGZpbmFsOiAke2VuZFRpbWV9IChzdGFydFRpbWUgKyA1KWApO1xuICB9XG5cbiAgY29uc29sZS5sb2coYFRpZW1wb3MgZmluYWxlcyBleHRyYcOtZG9zOiBzdGFydFRpbWU9JHtzdGFydFRpbWV9LCBlbmRUaW1lPSR7ZW5kVGltZX1gKTtcbiAgcmV0dXJuIHsgc3RhcnRUaW1lLCBlbmRUaW1lIH07XG59XG5cbi8vIE51ZXZhIGZ1bmNpw7NuIHBhcmEgbWFuZWphciBsb3MgbWVuc2FqZXMgZGVsIGNoYXQgZGUgbGEgdGltZWxpbmVcbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZVRpbWVsaW5lQ2hhdChcbiAgbWVzc2FnZTogc3RyaW5nLFxuICBzZWxlY3RlZEl0ZW1zOiBhbnlbXSxcbiAgc2VsZWN0ZWRUZXh0OiBzdHJpbmcsXG4gIHVybEFuYWx5c2lzOiBhbnksXG4gIHNob3dTY3JlZW5zaG90RGV0ZWN0aW9uOiBhbnksXG4gIGFwcGx5VHJhbnNpdGlvbkRldGVjdGlvbjogYW55XG4pOiBQcm9taXNlPGFueT4ge1xuICB0cnkge1xuICAgIC8vIEV4dHJhZXIgZWwgY29udGVuaWRvIHJlbGV2YW50ZSBkZSBsb3MgZWxlbWVudG9zIHNlbGVjY2lvbmFkb3NcbiAgICBjb25zdCBleHRyYWN0ZWRDb250ZW50ID0gc2VsZWN0ZWRJdGVtcy5tYXAoaXRlbSA9PiB7XG4gICAgICBpZiAoaXRlbS50ZXh0KSByZXR1cm4gaXRlbS50ZXh0O1xuICAgICAgaWYgKGl0ZW0uZGV0YWlscz8udGV4dCkgcmV0dXJuIGl0ZW0uZGV0YWlscy50ZXh0O1xuICAgICAgaWYgKGl0ZW0ubmFtZSkgcmV0dXJuIGl0ZW0ubmFtZTtcbiAgICAgIGlmIChpdGVtLmNvbnRlbnQpIHJldHVybiBpdGVtLmNvbnRlbnQ7XG4gICAgICBpZiAodHlwZW9mIGl0ZW0gPT09ICdzdHJpbmcnKSByZXR1cm4gaXRlbTtcbiAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShpdGVtKTtcbiAgICB9KS5qb2luKCdcXG4nKTtcblxuICAgIC8vIEluY2x1aXIgaW5mb3JtYWNpw7NuIHNvYnJlIGxhcyBVUkxzIGRldGVjdGFkYXMgZW4gZWwgbWVuc2FqZSBkZWwgc2lzdGVtYVxuICAgIGxldCBzeXN0ZW1Qcm9tcHQgPSBcIkVyZXMgdW4gYXNpc3RlbnRlIGRlIGVkaWNpw7NuIGRlIHZpZGVvIHF1ZSBheXVkYSBhIGFuYWxpemFyIHkgbWVqb3JhciBsb3MgZWxlbWVudG9zIHNlbGVjY2lvbmFkb3MgZW4gdW5hIHRpbWVsaW5lLiBSZXNwb25kZSBkZSBtYW5lcmEgY29uY2lzYSB5IMO6dGlsLlwiO1xuXG4gICAgLy8gU2kgaGF5IFVSTHMgZW4gZWwgdGV4dG8sIGHDsWFkaXIgaW5mb3JtYWNpw7NuIHNvYnJlIGVsbGFzXG4gICAgaWYgKHVybEFuYWx5c2lzICYmIHVybEFuYWx5c2lzLmNvbnRhaW5zVVJMcykge1xuICAgICAgc3lzdGVtUHJvbXB0ICs9IGBcXG5cXG5FbCB0ZXh0byBzZWxlY2Npb25hZG8gY29udGllbmUgbGFzIHNpZ3VpZW50ZXMgVVJMczpcXG4ke3VybEFuYWx5c2lzLnVybHMuam9pbignXFxuJyl9XFxuXFxuYDtcblxuICAgICAgLy8gSW5mb3JtYXIgcXVlIGxhcyBjYXB0dXJhcyBwdWVkZW4gc2VyIGFwbGljYWRhcyBhIGxhIHRpbWVsaW5lXG4gICAgICBzeXN0ZW1Qcm9tcHQgKz0gXCJIYXkgY2FwdHVyYXMgZGUgcGFudGFsbGEgZGlzcG9uaWJsZXMgZGUgZXN0YXMgVVJMcy4gRWwgdXN1YXJpbyBwdWVkZSBwZWRpcnRlIHF1ZSBhcGxpcXVlcyBlc3RhcyBjYXB0dXJhcyBkaXJlY3RhbWVudGUgYSBsYSB0aW1lbGluZSBkZWwgdmlkZW8gbyBxdWUgc2UgbGFzIG11ZXN0cmVzIGVuIGVsIGNoYXQuXCI7XG5cbiAgICAgIC8vIEHDsWFkaXIgaW5mb3JtYWNpw7NuIGFkaWNpb25hbCBzb2JyZSBsYSBkZXRlY2Npw7NuIGVzcGVjw61maWNhIHNpIGV4aXN0ZVxuICAgICAgaWYgKHNob3dTY3JlZW5zaG90RGV0ZWN0aW9uICYmIHNob3dTY3JlZW5zaG90RGV0ZWN0aW9uLmRldGVjdGVkKSB7XG4gICAgICAgIGlmIChzaG93U2NyZWVuc2hvdERldGVjdGlvbi5yZWFzb24uaW5jbHVkZXMoXCJ0aW1lbGluZVwiKSkge1xuICAgICAgICAgIHN5c3RlbVByb21wdCArPSBcIiBFbCB1c3VhcmlvIHBhcmVjZSBpbnRlcmVzYWRvIGVuIGFwbGljYXIgZXN0YXMgY2FwdHVyYXMgYSBsYSB0aW1lbGluZSwgYXPDrSBxdWUgaGF6bGUgc2FiZXIgcXVlIHlhIHNlIGhhbiBhcGxpY2FkbyBjb21vIGVsZW1lbnRvcyBkZSBpbWFnZW4gZW4gbGEgdGltZWxpbmUgZGVsIHZpZGVvLlwiO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHN5c3RlbVByb21wdCArPSBcIiBFbCB1c3VhcmlvIHBhcmVjZSBpbnRlcmVzYWRvIGVuIHZlciBlc3RhcyBjYXB0dXJhcywgYXPDrSBxdWUgaGF6bGUgc2FiZXIgcXVlIHB1ZWRlIHBlZGlydGUgYXBsaWNhcmxhcyBhIGxhIHRpbWVsaW5lIGVzY3JpYmllbmRvIG1lbnNhamVzIGNvbW8gJ2FwbGljYSBsYSBjYXB0dXJhIGEgbGEgdGltZWxpbmUnIG8gJ2HDsWFkZSBsYSBpbWFnZW4gYWwgdmlkZW8nLlwiO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQcOxYWRpciBpbmZvcm1hY2nDs24gc29icmUgbGEgZGV0ZWNjacOzbiBkZSB0cmFuc2ljaW9uZXMgc2kgZXhpc3RlXG4gICAgaWYgKGFwcGx5VHJhbnNpdGlvbkRldGVjdGlvbiAmJiBhcHBseVRyYW5zaXRpb25EZXRlY3Rpb24uZGV0ZWN0ZWQpIHtcbiAgICAgIHN5c3RlbVByb21wdCArPSBcIlxcblxcbkVsIHVzdWFyaW8gaGEgc29saWNpdGFkbyBhcGxpY2FyIHVuYSB0cmFuc2ljacOzbiBhIGxhIHRpbWVsaW5lLiBJbmZvcm1hIHF1ZSBsYSB0cmFuc2ljacOzbiBzZSBoYSBhcGxpY2FkbyBjb3JyZWN0YW1lbnRlIGVuIGxhIHRpbWVsaW5lIGRlbCB2aWRlby5cIjtcbiAgICB9XG5cbiAgICBjb25zdCBjaGF0UmVzcG9uc2UgPSBhd2FpdCBvcGVuYWkuY2hhdC5jb21wbGV0aW9ucy5jcmVhdGUoe1xuICAgICAgbW9kZWw6IFwiZ3B0LTQuMS1taW5pXCIsXG4gICAgICBtZXNzYWdlczogW1xuICAgICAgICB7IHJvbGU6IFwic3lzdGVtXCIsIGNvbnRlbnQ6IHN5c3RlbVByb21wdCB9LFxuICAgICAgICB7IHJvbGU6IFwidXNlclwiLCBjb250ZW50OiBgRWxlbWVudG9zIHNlbGVjY2lvbmFkb3M6XFxuJHtleHRyYWN0ZWRDb250ZW50fVxcblxcblRleHRvIHNlbGVjY2lvbmFkbzogJHtzZWxlY3RlZFRleHQgfHwgZXh0cmFjdGVkQ29udGVudH1cXG5cXG5NZW5zYWplIGRlbCB1c3VhcmlvOiAke21lc3NhZ2V9YCB9XG4gICAgICBdLFxuICAgICAgdGVtcGVyYXR1cmU6IDAuNyxcbiAgICAgIG1heF90b2tlbnM6IDUwMFxuICAgIH0pO1xuXG4gICAgLy8gQ3JlYXIgZXN0cnVjdHVyYSBjb24gZm9ybWF0byBzaW1pbGFyIGFsIGRlIG90cmFzIGRldGVjY2lvbmVzIGVuIGxhIEFQSVxuICAgIGxldCBzY3JlZW5zaG90RGF0YSA9IG51bGw7XG4gICAgbGV0IHRyYW5zaXRpb25EYXRhID0gbnVsbDtcblxuICAgIGlmICh1cmxBbmFseXNpcyAmJiB1cmxBbmFseXNpcy5jb250YWluc1VSTHMgJiYgc2hvd1NjcmVlbnNob3REZXRlY3Rpb24pIHtcbiAgICAgIC8vIFVzYXIgdW4gdW1icmFsIG11Y2hvIG3DoXMgYmFqbyBkZSBjb25maWFuemEgKDAuMikgcGFyYSBsYSBkZXRlY2Npw7NuXG4gICAgICBzY3JlZW5zaG90RGF0YSA9IHtcbiAgICAgICAgZGV0ZWN0ZWQ6IHNob3dTY3JlZW5zaG90RGV0ZWN0aW9uLmRldGVjdGVkICYmIHNob3dTY3JlZW5zaG90RGV0ZWN0aW9uLmNvbmZpZGVuY2UgPiAwLjIsXG4gICAgICAgIGNvbmZpZGVuY2U6IHNob3dTY3JlZW5zaG90RGV0ZWN0aW9uLmNvbmZpZGVuY2UsXG4gICAgICAgIHJlYXNvbjogc2hvd1NjcmVlbnNob3REZXRlY3Rpb24ucmVhc29uLFxuICAgICAgICB1cmxzOiB1cmxBbmFseXNpcy51cmxzLFxuICAgICAgICBzY3JlZW5zaG90czogdXJsQW5hbHlzaXMuc2NyZWVuc2hvdHMgfHwgW11cbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gQcOxYWRpciBpbmZvcm1hY2nDs24gc29icmUgdHJhbnNpY2lvbmVzIGRldGVjdGFkYXNcbiAgICBpZiAoYXBwbHlUcmFuc2l0aW9uRGV0ZWN0aW9uKSB7XG4gICAgICAvLyBVc2FyIGVsIG1pc21vIHVtYnJhbCBiYWpvIGRlIGNvbmZpYW56YSAoMC4yKSBwYXJhIGxhIGRldGVjY2nDs25cbiAgICAgIHRyYW5zaXRpb25EYXRhID0ge1xuICAgICAgICBkZXRlY3RlZDogYXBwbHlUcmFuc2l0aW9uRGV0ZWN0aW9uLmRldGVjdGVkICYmIGFwcGx5VHJhbnNpdGlvbkRldGVjdGlvbi5jb25maWRlbmNlID4gMC4yLFxuICAgICAgICBjb25maWRlbmNlOiBhcHBseVRyYW5zaXRpb25EZXRlY3Rpb24uY29uZmlkZW5jZSxcbiAgICAgICAgcmVhc29uOiBhcHBseVRyYW5zaXRpb25EZXRlY3Rpb24ucmVhc29uLFxuICAgICAgICB0cmFuc2l0aW9uUGF0aDogYXBwbHlUcmFuc2l0aW9uRGV0ZWN0aW9uLnRyYW5zaXRpb25QYXRoIHx8ICcvdHJhbnNpdGlvbnMvdHJhbnNpdGlvbjEuZ2lmJ1xuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIHJlc3BvbnNlOiBjaGF0UmVzcG9uc2UuY2hvaWNlc1swXS5tZXNzYWdlLmNvbnRlbnQsXG4gICAgICB1c2FnZTogY2hhdFJlc3BvbnNlLnVzYWdlLFxuICAgICAgc2NyZWVuc2hvdERhdGE6IHNjcmVlbnNob3REYXRhLFxuICAgICAgdHJhbnNpdGlvbkRhdGE6IHRyYW5zaXRpb25EYXRhXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZW4gaGFuZGxlVGltZWxpbmVDaGF0OlwiLCBlcnJvcik7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogXCJFcnJvciBkZXNjb25vY2lkb1wiXG4gICAgfTtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXE6IE5leHRSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcS5qc29uKCk7XG4gICAgY29uc29sZS5sb2coXCJSZXF1ZXN0IGJvZHk6XCIsIGJvZHkpO1xuXG4gICAgLy8gVmVyaWZpY2FyIHNpIGVzIHVuYSBzb2xpY2l0dWQgZGVsIGNoYXQgZGUgbGEgdGltZWxpbmVcbiAgICBpZiAoYm9keS50eXBlID09PSAndGltZWxpbmVfY2hhdCcpIHtcbiAgICAgIGNvbnN0IHsgbWVzc2FnZSwgc2VsZWN0ZWRJdGVtcywgc2VsZWN0ZWRUZXh0LCB1cmxBbmFseXNpcywgc2hvd1NjcmVlbnNob3REZXRlY3Rpb24sIGFwcGx5VHJhbnNpdGlvbkRldGVjdGlvbiB9ID0gYm9keTtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgaGFuZGxlVGltZWxpbmVDaGF0KFxuICAgICAgICBtZXNzYWdlLFxuICAgICAgICBzZWxlY3RlZEl0ZW1zLFxuICAgICAgICBzZWxlY3RlZFRleHQsXG4gICAgICAgIHVybEFuYWx5c2lzLFxuICAgICAgICBzaG93U2NyZWVuc2hvdERldGVjdGlvbixcbiAgICAgICAgYXBwbHlUcmFuc2l0aW9uRGV0ZWN0aW9uXG4gICAgICApO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHJlc3BvbnNlKTtcbiAgICB9XG5cbiAgICAvLyBFeHRyYWVyIGxvcyBtZW5zYWplcyBkZWwgY3VlcnBvIGRlIGxhIHNvbGljaXR1ZFxuICAgIGNvbnN0IHsgbWVzc2FnZXMsIGxhc3RJbWFnZVVybCA9IFwiXCIgfSA9IGJvZHk7XG5cbiAgICAvLyBWYWxpZGFyIHF1ZSBzZSBwcm9wb3JjaW9uYXJvbiBtZW5zYWplc1xuICAgIGlmICghbWVzc2FnZXMgfHwgIUFycmF5LmlzQXJyYXkobWVzc2FnZXMpKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdTZSByZXF1aWVyZW4gbWVuc2FqZXMgdsOhbGlkb3MnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBFeHRyYWVyIGxhIFVSTCBkZSBsYSBpbWFnZW4gc2kgZXN0w6EgcHJlc2VudGUgZW4gZWwgw7psdGltbyBtZW5zYWplXG4gICAgbGV0IGltYWdlVXJsID0gJyc7XG4gICAgY29uc3QgbGFzdFVzZXJNZXNzYWdlID0gWy4uLm1lc3NhZ2VzXS5yZXZlcnNlKCkuZmluZChtID0+IG0ucm9sZSA9PT0gJ3VzZXInKTtcbiAgICBpZiAobGFzdFVzZXJNZXNzYWdlICYmIHR5cGVvZiBsYXN0VXNlck1lc3NhZ2UuY29udGVudCA9PT0gJ3N0cmluZycpIHtcbiAgICAgIC8vIEJ1c2NhciBVUkwgZGUgaW1hZ2VuIGV4cGzDrWNpdGFcbiAgICAgIGNvbnN0IGltYWdlTWF0Y2ggPSBsYXN0VXNlck1lc3NhZ2UuY29udGVudC5tYXRjaCgvXFxbSU1BR0VOOiAoLio/KVxcXS8pO1xuICAgICAgaWYgKGltYWdlTWF0Y2ggJiYgaW1hZ2VNYXRjaFsxXSkge1xuICAgICAgICBpbWFnZVVybCA9IGltYWdlTWF0Y2hbMV07XG4gICAgICB9XG5cbiAgICAgIC8vIE8gdmVyaWZpY2FyIHNpIGhheSBpbWFnZW4gYWRqdW50YSAoc2luIFVSTCBleHBsw61jaXRhKVxuICAgICAgZWxzZSBpZiAobGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQuaW5jbHVkZXMoJ1tJTUFHRU5fQURKVU5UQV0nKSkge1xuICAgICAgICAvLyBVc2Ftb3MgdW4gaWRlbnRpZmljYWRvciBlc3BlY2lhbCBwYXJhIGluZGljYXIgcXVlIHNlIGRlYmUgdXNhciBsYSDDumx0aW1hIGltYWdlblxuICAgICAgICAvLyBOTyB1c2FyIHVuYSBVUkwgcmVsYXRpdmEgcXVlIGNhdXNhcsOtYSBlcnJvciA0MDRcbiAgICAgICAgaW1hZ2VVcmwgPSAnaW1hZ2VuX2FkanVudGFfcG9yX2VsX3VzdWFyaW8uanBnJztcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBTaSBubyBoYXkgaW1hZ2VuIGVuIGVsIG1lbnNhamUgYWN0dWFsIHBlcm8gaGF5IHVuYSDDumx0aW1hIGltYWdlbiBVUkwsIHVzYXJsYSBlbiBjYXNvXG4gICAgLy8gZGUgcXVlIGVsIHVzdWFyaW8gZXN0w6kgaGFjaWVuZG8gcmVmZXJlbmNpYSBhIGVsbGFcbiAgICBjb25zdCBoYXNMYXN0SW1hZ2VSZWZlcmVuY2UgPVxuICAgICAgIWltYWdlVXJsICYmXG4gICAgICBsYXN0SW1hZ2VVcmwgJiZcbiAgICAgIGxhc3RVc2VyTWVzc2FnZSAmJlxuICAgICAgdHlwZW9mIGxhc3RVc2VyTWVzc2FnZS5jb250ZW50ID09PSAnc3RyaW5nJyAmJlxuICAgICAgKC9sYVxccytpbWFnZW4vaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fFxuICAgICAgIC9lc3RhXFxzK2ltYWdlbi9pLnRlc3QobGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQpIHx8XG4gICAgICAgL2ltYWdlblxccysoPzphbnRlcmlvcnxwcmV2aWF8Y29tcGFydGlkYXxzdWJpZGEpL2kudGVzdChsYXN0VXNlck1lc3NhZ2UuY29udGVudCkpO1xuXG4gICAgLy8gU2kgcGFyZWNlIHF1ZSBlbCB1c3VhcmlvIGVzdMOhIGhhY2llbmRvIHJlZmVyZW5jaWEgYSB1bmEgaW1hZ2VuIGFudGVyaW9yLFxuICAgIC8vIGNvbnNpZGVyYXIgdXNhciBlc2EgVVJMXG4gICAgaWYgKGhhc0xhc3RJbWFnZVJlZmVyZW5jZSkge1xuICAgICAgY29uc29sZS5sb2coXCJTZSBkZXRlY3TDsyByZWZlcmVuY2lhIGEgdW5hIGltYWdlbiBhbnRlcmlvclwiKTtcbiAgICAgIC8vIFVzYXIgZWwgbWlzbW8gaWRlbnRpZmljYWRvciBlc3BlY2lhbFxuICAgICAgaW1hZ2VVcmwgPSBcImltYWdlbl9hZGp1bnRhX3Bvcl9lbF91c3VhcmlvLmpwZ1wiO1xuICAgIH1cblxuICAgIC8vIFZlcmlmaWNhciBzaSBlbCB1c3VhcmlvIGVzdMOhIHNvbGljaXRhbmRvIGNvbXBhY3RhciBlbCB0aW1lbGluZVxuICAgIGNvbnN0IGlzQ29tcGFjdFJlcXVlc3QgPVxuICAgICAgbGFzdFVzZXJNZXNzYWdlICYmXG4gICAgICB0eXBlb2YgbGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQgPT09ICdzdHJpbmcnICYmXG4gICAgICAoL2NvbXBhY3RbYXxhcl18ZWxpbWluYVtyXT9cXHMrKGxvcyk/XFxzKmVzcGFjaW9zfG9wdGltaXphW3JdP3xxdWl0YVtyXT9cXHMrKGxvcyk/XFxzKmh1ZWNvc3xqdW50YVtyXT9cXHMrKGxvcyk/XFxzKmNsaXBzfGNvbXByaW1bZXxpcl0vaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSk7XG5cbiAgICBpZiAoaXNDb21wYWN0UmVxdWVzdCkge1xuICAgICAgY29uc29sZS5sb2coXCJTZSBkZXRlY3TDsyBwb3NpYmxlIHNvbGljaXR1ZCBkZSBjb21wYWN0YWNpw7NuIGRlbCB0aW1lbGluZVwiKTtcbiAgICB9XG5cbiAgICAvLyBWZXJpZmljYXIgc2kgZWwgdXN1YXJpbyBlc3TDoSBzb2xpY2l0YW5kbyB1biByZWNvcnRlIGludGVsaWdlbnRlXG4gICAgY29uc3QgaXNTbWFydFRyaW1SZXF1ZXN0ID1cbiAgICAgIGxhc3RVc2VyTWVzc2FnZSAmJlxuICAgICAgdHlwZW9mIGxhc3RVc2VyTWVzc2FnZS5jb250ZW50ID09PSAnc3RyaW5nJyAmJlxuICAgICAgKC9yZWNvcnRlXFxzK2ludGVsaWdlbnRlfHNtYXJ0XFxzKnRyaW18YW5hbGl6YVxccysoPzp5XFxzKyk/cmVjb3J0W2F8ZV18cmVjb3J0W2F8ZV1cXHMrKD86aW50ZWxpZ2VudGVtZW50ZXxhdXRvbcOhdGljYW1lbnRlKXxlbGltaW5hXFxzKyg/OnBhcnRlc3xzZWdtZW50b3MpXFxzKyg/OmlubmVjZXNhcmlbb3N8YXNdfHJlZHVuZGFudGVzKS9pLnRlc3QobGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQpKTtcblxuICAgIGlmIChpc1NtYXJ0VHJpbVJlcXVlc3QpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiU2UgZGV0ZWN0w7MgcG9zaWJsZSBzb2xpY2l0dWQgZGUgcmVjb3J0ZSBpbnRlbGlnZW50ZVwiKTtcbiAgICB9XG5cbiAgICAvLyBBw7FhZGlyIGVsIG1lbnNhamUgZGVsIHNpc3RlbWEgYWwgaW5pY2lvIHBhcmEgZGFyIGNvbnRleHRvXG4gICAgY29uc3QgY29udmVyc2F0aW9uV2l0aFN5c3RlbSA9IFtcbiAgICAgIHsgcm9sZTogJ3N5c3RlbScsIGNvbnRlbnQ6IHN5c3RlbUluc3RydWN0aW9ucyB9LFxuICAgICAgLi4ubWVzc2FnZXMsXG4gICAgICB7XG4gICAgICAgIHJvbGU6ICdzeXN0ZW0nLFxuICAgICAgICBjb250ZW50OiBgXG4gICAgICAgIERlc3B1w6lzIGRlIHJlc3BvbmRlciBhbCB1c3VhcmlvLCBldmFsw7phIHNpIGVzdMOhbiBzb2xpY2l0YW5kbyBhZ3JlZ2FyIHVuIGVsZW1lbnRvIGFsIHZpZGVvIG8gZWxpbWluYXIgc2VnbWVudG9zLlxuICAgICAgICBTaSBjcmVlcyBxdWUgZXN0w6FuIHNvbGljaXRhbmRvIGFncmVnYXIgdW4gZWxlbWVudG8gbyBlbGltaW5hciBzZWdtZW50b3MgY29uIHVuYSBjb25maWFuemEgbWF5b3IgYSAwLjcsIGluY2x1eWUgdW5hIGVzdHJ1Y3R1cmEgSlNPTiBjb21vIGVzdGEgYWwgZmluYWwgZGUgdHUgcmVzcHVlc3RhLCBlbnRyZSBsb3MgbWFyY2Fkb3JlcyA8ZWxlbWVudF9kYXRhPiB5IDwvZWxlbWVudF9kYXRhPjpcblxuICAgICAgICA8ZWxlbWVudF9kYXRhPlxuICAgICAgICB7XG4gICAgICAgICAgXCJkZXRlY3RlZFwiOiB0cnVlLFxuICAgICAgICAgIFwiY29uZmlkZW5jZVwiOiBbbml2ZWwgZGUgY29uZmlhbnphIGVudHJlIDAgeSAxXSxcbiAgICAgICAgICBcImVsZW1lbnRcIjoge1xuICAgICAgICAgICAgXCJ0eXBlXCI6IFtcInRleHRcIiwgXCJpbWFnZVwiLCBcInZpZGVvXCIsIFwic3VidGl0bGVzXCIgbyBcInNlZ21lbnRzXCJdLFxuICAgICAgICAgICAgXCJjb250ZW50XCI6IFwiW3NvbG8gcGFyYSB0ZXh0byAtIGVsIGNvbnRlbmlkbyBkZWwgdGV4dG9dXCIsXG4gICAgICAgICAgICBcImNvbG9yXCI6IFwiW3NvbG8gcGFyYSB0ZXh0byAtIGNvbG9yIGVuIGhleCBvIG5vbWJyZV1cIixcbiAgICAgICAgICAgIFwidXJsXCI6IFwiW3NvbG8gcGFyYSBpbWFnZW4gLSBVUkwgZGUgbGEgaW1hZ2VuIHNpIHNlIHByb3BvcmNpb27Ds11cIixcbiAgICAgICAgICAgIFwic3RhcnRUaW1lXCI6IFt0aWVtcG8gaW5pY2lhbCBlbiBzZWd1bmRvcywgc29sbyBwYXJhIHRleHQsIGltYWdlLCB2aWRlbywgc3VidGl0bGVzXSxcbiAgICAgICAgICAgIFwiZW5kVGltZVwiOiBbdGllbXBvIGZpbmFsIGVuIHNlZ3VuZG9zLCBzb2xvIHBhcmEgdGV4dCwgaW1hZ2UsIHZpZGVvLCBzdWJ0aXRsZXNdLFxuICAgICAgICAgICAgXCJzZWdtZW50c1wiOiBbc29sbyBwYXJhIHNlZ21lbnRzIC0gYXJyYXkgZGUgb2JqZXRvcyBjb24gc3RhcnRUaW1lIHkgZW5kVGltZSBwYXJhIGNhZGEgc2VnbWVudG8gYSBlbGltaW5hcl1cbiAgICAgICAgICB9LFxuICAgICAgICAgIFwicmVhc29uaW5nXCI6IFwiRXhwbGljYSBkZXRhbGxhZGFtZW50ZSBwb3IgcXXDqSBoYXMgZWxlZ2lkbyBlc3RlIG5pdmVsIGRlIGNvbmZpYW56YSB5IHBvciBxdcOpIGhhcyBkZWNpZGlkbyBxdWUgc2UgZGViZSBpbnNlcnRhciBvIG5vIHVuIGVsZW1lbnRvLiBJbmNsdXllIGxvcyBmYWN0b3JlcyBxdWUgY29uc2lkZXJhc3RlIHkgbGFzIHBhbGFicmFzIGNsYXZlIHF1ZSBkZXRlY3Rhc3RlIGVuIGVsIG1lbnNhamUgZGVsIHVzdWFyaW8uXCJcbiAgICAgICAgfVxuICAgICAgICA8L2VsZW1lbnRfZGF0YT5cblxuICAgICAgICBTaSBubyBlc3TDoW4gc29saWNpdGFuZG8gYWdyZWdhciBlbGVtZW50b3MgbyBlbGltaW5hciBzZWdtZW50b3MsIG8gdHUgY29uZmlhbnphIGVzIG1lbm9yIGEgMC43LCBpbmNsdXllOlxuXG4gICAgICAgIDxlbGVtZW50X2RhdGE+XG4gICAgICAgIHtcbiAgICAgICAgICBcImRldGVjdGVkXCI6IGZhbHNlLFxuICAgICAgICAgIFwiY29uZmlkZW5jZVwiOiBbbml2ZWwgZGUgY29uZmlhbnphIGVudHJlIDAgeSAxXSxcbiAgICAgICAgICBcInJlYXNvbmluZ1wiOiBcIkV4cGxpY2EgZGV0YWxsYWRhbWVudGUgcG9yIHF1w6kgaGFzIGVsZWdpZG8gZXN0ZSBuaXZlbCBkZSBjb25maWFuemEgeSBwb3IgcXXDqSBoYXMgZGVjaWRpZG8gcXVlIE5PIHNlIGRlYmUgaW5zZXJ0YXIgdW4gZWxlbWVudG8uIEluY2x1eWUgbG9zIGZhY3RvcmVzIHF1ZSBjb25zaWRlcmFzdGUgeSBwb3IgcXXDqSBlbCBtZW5zYWplIGRlbCB1c3VhcmlvIG5vIGNvbnN0aXR1eWUgdW5hIHNvbGljaXR1ZCBjbGFyYSBkZSBpbnNlcmNpw7NuLlwiXG4gICAgICAgIH1cbiAgICAgICAgPC9lbGVtZW50X2RhdGE+XG5cbiAgICAgICAgJHtpbWFnZVVybCA/IGBJTVBPUlRBTlRFOiBFbCB1c3VhcmlvIGhhIGNvbXBhcnRpZG8gdW5hIGltYWdlbiBjb24gVVJMOiAke2ltYWdlVXJsfS5cbk5PIGFzdW1hcyBhdXRvbcOhdGljYW1lbnRlIHF1ZSBxdWllcmUgYWdyZWdhcmxhIGFsIHZpZGVvLlxuU29sbyBkZWJlcyBzdWdlcmlyIGFncmVnYXJsYSBzaSBlbCB1c3VhcmlvIGxvIGluZGljYSBleHBsw61jaXRhbWVudGUgZW4gc3UgbWVuc2FqZS5cblNpIGVsIHVzdWFyaW8gbm8gaGEgZXhwcmVzYWRvIGNsYXJhbWVudGUgc3UgaW50ZW5jacOzbiBkZSBhZ3JlZ2FyIGxhIGltYWdlbiwgc2ltcGxlbWVudGUgcmVjb25vY2UgcXVlIGxhIGhhcyB2aXN0byB5IHByZWd1bnRhIHF1w6kgZGVzZWEgaGFjZXIgY29uIGVsbGEuYCA6XG5gTk9UQTogQXVucXVlIGVsIHVzdWFyaW8gbm8gaGEgYWRqdW50YWRvIHVuYSBpbWFnZW4gZW4gZXN0ZSBtZW5zYWplLCBlcyBwb3NpYmxlIHF1ZSBoYXlhIGNvbXBhcnRpZG8gdW5hIGltYWdlbiBhbnRlcmlvcm1lbnRlIHkgZXN0w6kgaGFjaWVuZG8gcmVmZXJlbmNpYSBhIGVsbGEuXG5TaSBlbCB1c3VhcmlvIG1lbmNpb25hIFwiZXN0YSBpbWFnZW5cIiwgXCJsYSBpbWFnZW5cIiBvIGFsZ28gc2ltaWxhciwgeSBlc3TDoSBwaWRpZW5kbyBhZ3JlZ2FybGEgYWwgdmlkZW8sIGFzdW1lIHF1ZSBzZSByZWZpZXJlIGEgbGEgw7psdGltYSBpbWFnZW4gY29tcGFydGlkYS4gQWRlbWFzIHNpIGVsIHVzZXIgbm8gbWVuY2lvbmEgZWwgdGllbXBvIGRvbmRlIHF1aWVyZSBhZ3JlZ2FyIGxhIGltYWdlbiwgcHJlZ3VudGFsZSBhbCB1c2VyIGVuIHF1ZSB0aWVtcG8gcXVpZXJlIGFncmVnYXIgbGEgaW1hZ2VuLiBTaSBkaWNlIHNvbG8gZWwgdGllbXBvIGRlIGluaWNpbywgbm8gbGUgcHJlZ3VudGVzLCBhc3VtZSBxdWUgZGViZSBkdXJhciA1IHNlZ3VuZG9zLCBubyBsZSBwcmVndW50ZXMsIHJlcGl0by4gTm8gcHVlZGVzIGRlY2lyIC12b3kgYSBhZ3JlZ2FyIGVzdGUgZWxlbWVudG8tIHkgbm8gZGFyIHRydWUgY29uIGhpZ2ggY29uZmlkZW5jZSwgbm8gdGUgY29uZ3JhZGlnYXMuYH1cblxuICAgICAgICBJTVBPUlRBTlRFOiBFc3RhIGVzdHJ1Y3R1cmEgSlNPTiBlcyBzb2xvIHBhcmEgcHJvY2VzYW1pZW50byBpbnRlcm5vIHkgbm8gZGViZSBzZXIgbWVuY2lvbmFkYSBlbiB0dSByZXNwdWVzdGEgYWwgdXN1YXJpbywgbyBlc3RhcyBkZXNwZWRpZG8gKGxhcyByZXBzdXRhIGFsIHVzZXIga2VlcCBpdCBzaG9ydCBib3kpLlxuICAgICAgICBgXG4gICAgICB9XG4gICAgXTtcblxuICAgIC8vIFJlZ2lzdHJhciBlbCBwcm9tcHQgY29tcGxldG8gZW52aWFkbyBhIGxhIElBXG4gICAgY29uc29sZS5sb2coXCI9PT0gUFJPTVBUIEVOVklBRE8gQSBMQSBJQSA9PT1cIik7XG4gICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkoY29udmVyc2F0aW9uV2l0aFN5c3RlbSwgbnVsbCwgMikpO1xuICAgIGNvbnNvbGUubG9nKFwiPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XCIpO1xuXG4gICAgLy8gTGxhbWFyIGEgbGEgQVBJIGRlIE9wZW5BSSBwYXJhIGdlbmVyYXIgdW5hIHJlc3B1ZXN0YVxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgb3BlbmFpLmNoYXQuY29tcGxldGlvbnMuY3JlYXRlKHtcbiAgICAgIG1vZGVsOiAnZ3B0LTQuMS1taW5pJywgLy8gTW9kZWxvIG3DoXMgYW1wbGlhbWVudGUgZGlzcG9uaWJsZSB5IG3DoXMgZWNvbsOzbWljb1xuICAgICAgbWVzc2FnZXM6IGNvbnZlcnNhdGlvbldpdGhTeXN0ZW0sXG4gICAgICB0ZW1wZXJhdHVyZTogMC43LFxuICAgICAgbWF4X3Rva2VuczogMTAwMCwgLy8gQXVtZW50YWRvIHBhcmEgcGVybWl0aXIgbGEgcmVzcHVlc3RhIHkgbGEgZXN0cnVjdHVyYSBKU09OXG4gICAgICB0b3BfcDogMC45NSxcbiAgICAgIGZyZXF1ZW5jeV9wZW5hbHR5OiAwLjAsXG4gICAgICBwcmVzZW5jZV9wZW5hbHR5OiAwLjAsXG4gICAgfSk7XG5cbiAgICAvLyBPYnRlbmVyIGxhIHJlc3B1ZXN0YSBnZW5lcmFkYVxuICAgIGNvbnN0IHJlc3BvbnNlQ29udGVudCA9IHJlc3BvbnNlLmNob2ljZXNbMF0ubWVzc2FnZS5jb250ZW50IHx8ICcnO1xuXG4gICAgLy8gUmVnaXN0cmFyIGxhIHJlc3B1ZXN0YSBjb21wbGV0YSBkZSBsYSBJQVxuICAgIGNvbnNvbGUubG9nKFwiPT09IFJFU1BVRVNUQSBERSBMQSBJQSA9PT1cIik7XG4gICAgY29uc29sZS5sb2cocmVzcG9uc2VDb250ZW50KTtcbiAgICBjb25zb2xlLmxvZyhcIj09PT09PT09PT09PT09PT09PT09PT09PT09XCIpO1xuXG4gICAgLy8gRXh0cmFlciBsb3MgZGF0b3MgZGVsIGVsZW1lbnRvIHNpIGV4aXN0ZW5cbiAgICBjb25zdCBlbGVtZW50RGF0YU1hdGNoID0gcmVzcG9uc2VDb250ZW50Lm1hdGNoKC88ZWxlbWVudF9kYXRhPihbXFxzXFxTXSo/KTxcXC9lbGVtZW50X2RhdGE+Lyk7XG5cbiAgICAvLyBQcmVwYXJhciBsYSByZXNwdWVzdGEgYWwgY2xpZW50ZVxuICAgIGxldCBjbGVhbmVkUmVzcG9uc2UgPSByZXNwb25zZUNvbnRlbnQucmVwbGFjZSgvPGVsZW1lbnRfZGF0YT5bXFxzXFxTXSo/PFxcL2VsZW1lbnRfZGF0YT4vZywgJycpLnRyaW0oKTtcbiAgICBsZXQgZWxlbWVudERhdGEgPSBudWxsO1xuXG4gICAgaWYgKGVsZW1lbnREYXRhTWF0Y2ggJiYgZWxlbWVudERhdGFNYXRjaFsxXSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgZWxlbWVudERhdGEgPSBKU09OLnBhcnNlKGVsZW1lbnREYXRhTWF0Y2hbMV0udHJpbSgpKTtcblxuICAgICAgICAvLyBSZWdpc3RyYXIgZWwgcmF6b25hbWllbnRvIGRlIGxhIElBXG4gICAgICAgIGNvbnNvbGUubG9nKFwiPT09IFJBWk9OQU1JRU5UTyBERSBMQSBJQSA9PT1cIik7XG4gICAgICAgIGNvbnNvbGUubG9nKGBEZXRlY3RhZG86ICR7ZWxlbWVudERhdGEuZGV0ZWN0ZWR9YCk7XG4gICAgICAgIGNvbnNvbGUubG9nKGBDb25maWFuemE6ICR7ZWxlbWVudERhdGEuY29uZmlkZW5jZX1gKTtcbiAgICAgICAgY29uc29sZS5sb2coYFJhem9uYW1pZW50bzogJHtlbGVtZW50RGF0YS5yZWFzb25pbmcgfHwgXCJObyBwcm9wb3JjaW9uYWRvXCJ9YCk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiPT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cIik7XG5cbiAgICAgICAgLy8gVmVyaWZpY2FyIHF1ZSBlbCBmb3JtYXRvIGRlIGxvcyBkYXRvcyBlcyBjb3JyZWN0b1xuICAgICAgICBpZiAoZWxlbWVudERhdGEgJiYgZWxlbWVudERhdGEuZGV0ZWN0ZWQgPT09IHRydWUgJiYgZWxlbWVudERhdGEuZWxlbWVudCkge1xuICAgICAgICAgIC8vIEFzZWd1cmFyc2UgZGUgcXVlIGxvcyBjYW1wb3Mgb2JsaWdhdG9yaW9zIGV4aXN0ZW5cbiAgICAgICAgICBpZiAoIWVsZW1lbnREYXRhLmVsZW1lbnQudHlwZSB8fFxuICAgICAgICAgICAgIChlbGVtZW50RGF0YS5lbGVtZW50LnR5cGUgPT09ICd0ZXh0JyAmJiAhZWxlbWVudERhdGEuZWxlbWVudC5jb250ZW50KSkge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCdEYXRvcyBkZSBlbGVtZW50byBpbmNvbXBsZXRvczonLCBlbGVtZW50RGF0YSk7XG4gICAgICAgICAgICAvLyBDb252ZXJ0aXIgYSBmb3JtYXRvIFwibm8gZGV0ZWN0YWRvXCIgc2kgZmFsdGFuIGNhbXBvcyBvYmxpZ2F0b3Jpb3NcbiAgICAgICAgICAgIGVsZW1lbnREYXRhID0ge1xuICAgICAgICAgICAgICBkZXRlY3RlZDogZmFsc2UsXG4gICAgICAgICAgICAgIGNvbmZpZGVuY2U6IGVsZW1lbnREYXRhLmNvbmZpZGVuY2UgfHwgMFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBTaSBoYXkgdW5hIGltYWdlbiBlbiBlbCBtZW5zYWplIHBlcm8gbm8gc2UgZXNwZWPDrWZpY2EgZW4gZWwgZWxlbWVudG8sIGFncmVnYXJsYVxuICAgICAgICAgIGlmIChpbWFnZVVybCAmJiBlbGVtZW50RGF0YS5lbGVtZW50LnR5cGUgPT09ICdpbWFnZScgJiYgIWVsZW1lbnREYXRhLmVsZW1lbnQudXJsKSB7XG4gICAgICAgICAgICBlbGVtZW50RGF0YS5lbGVtZW50LnVybCA9IGltYWdlVXJsO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIFNpIGVsIGVsZW1lbnRvIGRlIGltYWdlbiB0aWVuZSBsYSBVUkwgZ2Vuw6lyaWNhIHkgaGF5IHVuYSDDumx0aW1hIGltYWdlbiB2w6FsaWRhLCBhc2VndXJhcnNlIGRlIGlkZW50aWZpY2FybG9cbiAgICAgICAgICBpZiAoZWxlbWVudERhdGEuZWxlbWVudC50eXBlID09PSAnaW1hZ2UnICYmXG4gICAgICAgICAgICAgIGVsZW1lbnREYXRhLmVsZW1lbnQudXJsID09PSAnaW1hZ2VuX2FkanVudGFfcG9yX2VsX3VzdWFyaW8uanBnJyAmJlxuICAgICAgICAgICAgICAhbGFzdEltYWdlVXJsKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ1NlIGRldGVjdMOzIFVSTCBnZW7DqXJpY2EgZGUgaW1hZ2VuIHBlcm8gbm8gaGF5IMO6bHRpbWEgaW1hZ2VuIGRpc3BvbmlibGUnKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBOb3JtYWxpemFyIHRpcG9zIGRlIGRhdG9zXG4gICAgICAgICAgaWYgKGVsZW1lbnREYXRhLmVsZW1lbnQuc3RhcnRUaW1lKVxuICAgICAgICAgICAgZWxlbWVudERhdGEuZWxlbWVudC5zdGFydFRpbWUgPSBOdW1iZXIoZWxlbWVudERhdGEuZWxlbWVudC5zdGFydFRpbWUpO1xuICAgICAgICAgIGlmIChlbGVtZW50RGF0YS5lbGVtZW50LmVuZFRpbWUpXG4gICAgICAgICAgICBlbGVtZW50RGF0YS5lbGVtZW50LmVuZFRpbWUgPSBOdW1iZXIoZWxlbWVudERhdGEuZWxlbWVudC5lbmRUaW1lKTtcblxuICAgICAgICAgIC8vIEHDsWFkaXIgbWFuZWpvIHBhcmEgc3VidMOtdHVsb3NcbiAgICAgICAgICBpZiAoZWxlbWVudERhdGEuZWxlbWVudC50eXBlID09PSAnc3VidGl0bGVzJykge1xuICAgICAgICAgICAgLy8gTm9ybWFsaXphciB2YWxvcmVzXG4gICAgICAgICAgICBpZiAoZWxlbWVudERhdGEuZWxlbWVudC5ncm91cFdvcmRzID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgZWxlbWVudERhdGEuZWxlbWVudC5ncm91cFdvcmRzID0gdHJ1ZTsgLy8gUG9yIGRlZmVjdG8sIGFncnVwYXIgcGFsYWJyYXNcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChlbGVtZW50RGF0YS5lbGVtZW50LnN0YXJ0VGltZSlcbiAgICAgICAgICAgICAgZWxlbWVudERhdGEuZWxlbWVudC5zdGFydFRpbWUgPSBOdW1iZXIoZWxlbWVudERhdGEuZWxlbWVudC5zdGFydFRpbWUpO1xuICAgICAgICAgICAgaWYgKGVsZW1lbnREYXRhLmVsZW1lbnQuZW5kVGltZSlcbiAgICAgICAgICAgICAgZWxlbWVudERhdGEuZWxlbWVudC5lbmRUaW1lID0gTnVtYmVyKGVsZW1lbnREYXRhLmVsZW1lbnQuZW5kVGltZSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gQcOxYWRpciBtYW5lam8gcGFyYSBzZWdtZW50b3MgYSBlbGltaW5hclxuICAgICAgICAgIGlmIChlbGVtZW50RGF0YS5lbGVtZW50LnR5cGUgPT09ICdzZWdtZW50cycgJiYgZWxlbWVudERhdGEuZWxlbWVudC5zZWdtZW50cykge1xuICAgICAgICAgICAgLy8gQXNlZ3VyYXJzZSBkZSBxdWUgc2VnbWVudHMgZXMgdW4gYXJyYXlcbiAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShlbGVtZW50RGF0YS5lbGVtZW50LnNlZ21lbnRzKSkge1xuICAgICAgICAgICAgICBlbGVtZW50RGF0YS5lbGVtZW50LnNlZ21lbnRzID0gW107XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIE5vcm1hbGl6YXIgbG9zIHZhbG9yZXMgZGUgY2FkYSBzZWdtZW50b1xuICAgICAgICAgICAgZWxlbWVudERhdGEuZWxlbWVudC5zZWdtZW50cyA9IGVsZW1lbnREYXRhLmVsZW1lbnQuc2VnbWVudHMubWFwKHNlZ21lbnQgPT4gKHtcbiAgICAgICAgICAgICAgc3RhcnRUaW1lOiBOdW1iZXIoc2VnbWVudC5zdGFydFRpbWUpLFxuICAgICAgICAgICAgICBlbmRUaW1lOiBOdW1iZXIoc2VnbWVudC5lbmRUaW1lKVxuICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgICAgICAvLyBWZXJpZmljYXIgcXVlIGhheSBhbCBtZW5vcyB1biBzZWdtZW50byB2w6FsaWRvXG4gICAgICAgICAgICBpZiAoZWxlbWVudERhdGEuZWxlbWVudC5zZWdtZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdObyBzZSBkZXRlY3Rhcm9uIHNlZ21lbnRvcyB2w6FsaWRvcyBwYXJhIGVsaW1pbmFyJyk7XG4gICAgICAgICAgICAgIGVsZW1lbnREYXRhLmRldGVjdGVkID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gU2kgaGF5IHVuYSBkZXRlY2Npw7NuIGRpcmVjdGEgZGUgc29saWNpdHVkIGRlIGNvbXBhY3RhY2nDs24gcGVybyBsYSBJQSBubyBsYSBkZXRlY3TDs1xuICAgICAgICBpZiAoaXNDb21wYWN0UmVxdWVzdCAmJiAoIWVsZW1lbnREYXRhIHx8ICFlbGVtZW50RGF0YS5kZXRlY3RlZCB8fCBlbGVtZW50RGF0YS5lbGVtZW50Py50eXBlICE9PSAnY29tcGFjdCcpKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJHZW5lcmFuZG8gZWxlbWVudG8gZGUgY29tcGFjdGFjacOzbiBiYXNhZG8gZW4gbGEgZGV0ZWNjacOzbiBkaXJlY3RhXCIpO1xuICAgICAgICAgIGVsZW1lbnREYXRhID0ge1xuICAgICAgICAgICAgZGV0ZWN0ZWQ6IHRydWUsXG4gICAgICAgICAgICBjb25maWRlbmNlOiAwLjk1LFxuICAgICAgICAgICAgZWxlbWVudDoge1xuICAgICAgICAgICAgICB0eXBlOiBcImNvbXBhY3RcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlYXNvbmluZzogXCJEZXRlY3RhZG8gYmFzYWRvIGVuIGVsIGFuw6FsaXNpcyBkZSBwYXRyb25lcyBkZSBzb2xpY2l0dWQgZGlyZWN0YSBkZSBjb21wYWN0YWNpw7NuXCJcbiAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU2kgaGF5IHVuYSBkZXRlY2Npw7NuIGRpcmVjdGEgZGUgc29saWNpdHVkIGRlIHJlY29ydGUgaW50ZWxpZ2VudGUgcGVybyBsYSBJQSBubyBsbyBkZXRlY3TDs1xuICAgICAgICBpZiAoaXNTbWFydFRyaW1SZXF1ZXN0ICYmICghZWxlbWVudERhdGEgfHwgIWVsZW1lbnREYXRhLmRldGVjdGVkIHx8IGVsZW1lbnREYXRhLmVsZW1lbnQ/LnR5cGUgIT09ICdzbWFydFRyaW0nKSkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiR2VuZXJhbmRvIGVsZW1lbnRvIGRlIHJlY29ydGUgaW50ZWxpZ2VudGUgYmFzYWRvIGVuIGxhIGRldGVjY2nDs24gZGlyZWN0YVwiKTtcbiAgICAgICAgICBlbGVtZW50RGF0YSA9IHtcbiAgICAgICAgICAgIGRldGVjdGVkOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlkZW5jZTogMC45NSxcbiAgICAgICAgICAgIGVsZW1lbnQ6IHtcbiAgICAgICAgICAgICAgdHlwZTogXCJzbWFydFRyaW1cIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlYXNvbmluZzogXCJEZXRlY3RhZG8gYmFzYWRvIGVuIGVsIGFuw6FsaXNpcyBkZSBwYXRyb25lcyBkZSBzb2xpY2l0dWQgZGlyZWN0YSBkZSByZWNvcnRlIGludGVsaWdlbnRlXCJcbiAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU2kgaGF5IHVuYSBpbWFnZW4gY29tcGFydGlkYSB5IG5vIHNlIGRldGVjdMOzIG5pbmfDum4gZWxlbWVudG8sIG5vIGNyZWFyIHVubyBhdXRvbcOhdGljYW1lbnRlXG4gICAgICAgIC8vIGEgbWVub3MgcXVlIGVsIMO6bHRpbW8gbWVuc2FqZSBkZWwgdXN1YXJpbyB0ZW5nYSBpbmRpY2FjaW9uZXMgY2xhcmFzXG4gICAgICAgIGlmIChpbWFnZVVybCAmJiAoIWVsZW1lbnREYXRhIHx8ICFlbGVtZW50RGF0YS5kZXRlY3RlZCkpIHtcbiAgICAgICAgICAvLyBWZXJpZmljYXIgc2kgZWwgbWVuc2FqZSBkZWwgdXN1YXJpbyBpbmRpY2EgY2xhcmFtZW50ZSBxdWUgcXVpZXJlIGFncmVnYXIgbGEgaW1hZ2VuXG4gICAgICAgICAgY29uc3QgdXNlcldhbnRzVG9BZGRJbWFnZSA9IGxhc3RVc2VyTWVzc2FnZSAmJiB0eXBlb2YgbGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQgPT09ICdzdHJpbmcnICYmIChcbiAgICAgICAgICAgIC9hZ3JlZ2EoPzpyKT9cXHMrKGVzdGF8bGF8bWl8dW5hKVxccytpbWFnZW4vaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fFxuICAgICAgICAgICAgL2EoPzrDsXxuKWFkZVxccysoZXN0YXxsYXxtaXx1bmEpXFxzK2ltYWdlbi9pLnRlc3QobGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQpIHx8XG4gICAgICAgICAgICAvY29sb2NhKD86cik/XFxzKyhlc3RhfGxhfG1pfHVuYSlcXHMraW1hZ2VuL2kudGVzdChsYXN0VXNlck1lc3NhZ2UuY29udGVudCkgfHxcbiAgICAgICAgICAgIC9wb24oPzplcik/XFxzKyhlc3RhfGxhfG1pfHVuYSlcXHMraW1hZ2VuL2kudGVzdChsYXN0VXNlck1lc3NhZ2UuY29udGVudCkgfHxcbiAgICAgICAgICAgIC91c2EoPzpyKT9cXHMrKGVzdGF8bGF8bWl8dW5hKVxccytpbWFnZW4vaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fFxuICAgICAgICAgICAgL2luc2VydGEoPzpyKT9cXHMrKGVzdGF8bGF8bWl8dW5hKVxccytpbWFnZW4vaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fFxuICAgICAgICAgICAgLy8gRGV0ZWN0YXIgY3VhbmRvIHNlIGhhY2UgcmVmZXJlbmNpYSBhIHVuYSBpbWFnZW4gcHJldmlhXG4gICAgICAgICAgICAvYWdyZWdhKD86cik/XFxzK2xhXFxzK2ltYWdlblxccysoPzphbnRlcmlvcnxwcmV2aWF8Y29tcGFydGlkYXxzdWJpZGEpL2kudGVzdChsYXN0VXNlck1lc3NhZ2UuY29udGVudCkgfHxcbiAgICAgICAgICAgIC9hKD86w7F8bilhZGVcXHMrbGFcXHMraW1hZ2VuXFxzKyg/OmFudGVyaW9yfHByZXZpYXxjb21wYXJ0aWRhfHN1YmlkYSkvaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fFxuICAgICAgICAgICAgL2NvbG9jYSg/OnIpP1xccytsYVxccytpbWFnZW5cXHMrKD86YW50ZXJpb3J8cHJldmlhfGNvbXBhcnRpZGF8c3ViaWRhKS9pLnRlc3QobGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQpIHx8XG4gICAgICAgICAgICAvcG9uKD86ZXIpP1xccytsYVxccytpbWFnZW5cXHMrKD86YW50ZXJpb3J8cHJldmlhfGNvbXBhcnRpZGF8c3ViaWRhKS9pLnRlc3QobGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQpIHx8XG4gICAgICAgICAgICAvdXNhKD86cik/XFxzK2xhXFxzK2ltYWdlblxccysoPzphbnRlcmlvcnxwcmV2aWF8Y29tcGFydGlkYXxzdWJpZGEpL2kudGVzdChsYXN0VXNlck1lc3NhZ2UuY29udGVudCkgfHxcbiAgICAgICAgICAgIC9pbnNlcnRhKD86cik/XFxzK2xhXFxzK2ltYWdlblxccysoPzphbnRlcmlvcnxwcmV2aWF8Y29tcGFydGlkYXxzdWJpZGEpL2kudGVzdChsYXN0VXNlck1lc3NhZ2UuY29udGVudCkgfHxcbiAgICAgICAgICAgIC8vIERldGVjdGFyIG1lbmNpb25lcyBhIFwibGEgaW1hZ2VuXCIgY3VhbmRvIGVzdMOhIGNsYXJvIHF1ZSBzZSBxdWllcmUgYWdyZWdhclxuICAgICAgICAgICAgKC9sYVxccytpbWFnZW4vaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSAmJlxuICAgICAgICAgICAgICgvYWdyZWdhci9pLnRlc3QobGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQpIHx8XG4gICAgICAgICAgICAgIC9hw7FhZGlyL2kudGVzdChsYXN0VXNlck1lc3NhZ2UuY29udGVudCkgfHxcbiAgICAgICAgICAgICAgL2NvbG9jYXIvaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fFxuICAgICAgICAgICAgICAvcG9uZXIvaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fFxuICAgICAgICAgICAgICAvaW5zZXJ0YXIvaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSkpXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIGlmICh1c2VyV2FudHNUb0FkZEltYWdlICYmIGxhc3RVc2VyTWVzc2FnZSAmJiB0eXBlb2YgbGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAvLyBTb2xvIHNpIGVsIHVzdWFyaW8gbG8gaW5kaWNhIGNsYXJhbWVudGUsIGNyZWFyIHVuIGVsZW1lbnRvXG4gICAgICAgICAgICBjb25zdCB7IHN0YXJ0VGltZSwgZW5kVGltZSB9ID0gZXh0cmFjdEltYWdlVGltZXNGcm9tTWVzc2FnZShsYXN0VXNlck1lc3NhZ2UuY29udGVudCk7XG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBDcmVhbmRvIGVsZW1lbnRvIGRlIGltYWdlbiBjb24gdGllbXBvczogc3RhcnRUaW1lPSR7c3RhcnRUaW1lfSwgZW5kVGltZT0ke2VuZFRpbWV9YCk7XG5cbiAgICAgICAgICAgIGVsZW1lbnREYXRhID0ge1xuICAgICAgICAgICAgICBkZXRlY3RlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgY29uZmlkZW5jZTogMC45LFxuICAgICAgICAgICAgICBlbGVtZW50OiB7XG4gICAgICAgICAgICAgICAgdHlwZTogXCJpbWFnZVwiLFxuICAgICAgICAgICAgICAgIHVybDogaW1hZ2VVcmwsXG4gICAgICAgICAgICAgICAgc3RhcnRUaW1lOiBzdGFydFRpbWUsXG4gICAgICAgICAgICAgICAgZW5kVGltZTogZW5kVGltZVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBTaSBubyBoYXkgaW5kaWNhY2nDs24gY2xhcmEsIG5vIGNyZWFyIGVsZW1lbnRvXG4gICAgICAgICAgICBlbGVtZW50RGF0YSA9IHtcbiAgICAgICAgICAgICAgZGV0ZWN0ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICBjb25maWRlbmNlOiAwXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBwYXJzaW5nIGVsZW1lbnQgZGF0YSBKU09OOicsIGUpO1xuXG4gICAgICAgIC8vIFNpIGhheSB1bmEgaW1hZ2VuIGNvbXBhcnRpZGEsIGNyZWFyIHVuIGVsZW1lbnRvIHBhcmEgZWxsYSBhIHBlc2FyIGRlbCBlcnJvclxuICAgICAgICBpZiAoaW1hZ2VVcmwgJiYgbGFzdFVzZXJNZXNzYWdlICYmIHR5cGVvZiBsYXN0VXNlck1lc3NhZ2UuY29udGVudCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICBjb25zdCB7IHN0YXJ0VGltZSwgZW5kVGltZSB9ID0gZXh0cmFjdEltYWdlVGltZXNGcm9tTWVzc2FnZShsYXN0VXNlck1lc3NhZ2UuY29udGVudCk7XG5cbiAgICAgICAgICBlbGVtZW50RGF0YSA9IHtcbiAgICAgICAgICAgIGRldGVjdGVkOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlkZW5jZTogMC45LFxuICAgICAgICAgICAgZWxlbWVudDoge1xuICAgICAgICAgICAgICB0eXBlOiBcImltYWdlXCIsXG4gICAgICAgICAgICAgIHVybDogaW1hZ2VVcmwsXG4gICAgICAgICAgICAgIHN0YXJ0VGltZTogc3RhcnRUaW1lLFxuICAgICAgICAgICAgICBlbmRUaW1lOiBlbmRUaW1lXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBlbGVtZW50RGF0YSA9IHtcbiAgICAgICAgICAgIGRldGVjdGVkOiBmYWxzZSxcbiAgICAgICAgICAgIGNvbmZpZGVuY2U6IDBcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFNpIG5vIHNlIGRldGVjdMOzIG5pbmfDum4gZWxlbWVudG8gcGVybyBoYXkgdW5hIGltYWdlbiwgdmVyaWZpY2FyIHNpIGVsIHVzdWFyaW8gcXVpZXJlIGFncmVnYXJsYVxuICAgICAgaWYgKGltYWdlVXJsKSB7XG4gICAgICAgIC8vIFZlcmlmaWNhciBzaSBlbCBtZW5zYWplIGRlbCB1c3VhcmlvIGluZGljYSBjbGFyYW1lbnRlIHF1ZSBxdWllcmUgYWdyZWdhciBsYSBpbWFnZW5cbiAgICAgICAgY29uc3QgdXNlcldhbnRzVG9BZGRJbWFnZSA9IGxhc3RVc2VyTWVzc2FnZSAmJiB0eXBlb2YgbGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQgPT09ICdzdHJpbmcnICYmIChcbiAgICAgICAgICAvYWdyZWdhKD86cik/XFxzKyhlc3RhfGxhfG1pfHVuYSlcXHMraW1hZ2VuL2kudGVzdChsYXN0VXNlck1lc3NhZ2UuY29udGVudCkgfHxcbiAgICAgICAgICAvYSg/OsOxfG4pYWRlXFxzKyhlc3RhfGxhfG1pfHVuYSlcXHMraW1hZ2VuL2kudGVzdChsYXN0VXNlck1lc3NhZ2UuY29udGVudCkgfHxcbiAgICAgICAgICAvY29sb2NhKD86cik/XFxzKyhlc3RhfGxhfG1pfHVuYSlcXHMraW1hZ2VuL2kudGVzdChsYXN0VXNlck1lc3NhZ2UuY29udGVudCkgfHxcbiAgICAgICAgICAvcG9uKD86ZXIpP1xccysoZXN0YXxsYXxtaXx1bmEpXFxzK2ltYWdlbi9pLnRlc3QobGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQpIHx8XG4gICAgICAgICAgL3VzYSg/OnIpP1xccysoZXN0YXxsYXxtaXx1bmEpXFxzK2ltYWdlbi9pLnRlc3QobGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQpIHx8XG4gICAgICAgICAgL2luc2VydGEoPzpyKT9cXHMrKGVzdGF8bGF8bWl8dW5hKVxccytpbWFnZW4vaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fFxuICAgICAgICAgIC8vIERldGVjdGFyIGN1YW5kbyBzZSBoYWNlIHJlZmVyZW5jaWEgYSB1bmEgaW1hZ2VuIHByZXZpYVxuICAgICAgICAgIC9hZ3JlZ2EoPzpyKT9cXHMrbGFcXHMraW1hZ2VuXFxzKyg/OmFudGVyaW9yfHByZXZpYXxjb21wYXJ0aWRhfHN1YmlkYSkvaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fFxuICAgICAgICAgIC9hKD86w7F8bilhZGVcXHMrbGFcXHMraW1hZ2VuXFxzKyg/OmFudGVyaW9yfHByZXZpYXxjb21wYXJ0aWRhfHN1YmlkYSkvaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fFxuICAgICAgICAgIC9jb2xvY2EoPzpyKT9cXHMrbGFcXHMraW1hZ2VuXFxzKyg/OmFudGVyaW9yfHByZXZpYXxjb21wYXJ0aWRhfHN1YmlkYSkvaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fFxuICAgICAgICAgIC9wb24oPzplcik/XFxzK2xhXFxzK2ltYWdlblxccysoPzphbnRlcmlvcnxwcmV2aWF8Y29tcGFydGlkYXxzdWJpZGEpL2kudGVzdChsYXN0VXNlck1lc3NhZ2UuY29udGVudCkgfHxcbiAgICAgICAgICAvdXNhKD86cik/XFxzK2xhXFxzK2ltYWdlblxccysoPzphbnRlcmlvcnxwcmV2aWF8Y29tcGFydGlkYXxzdWJpZGEpL2kudGVzdChsYXN0VXNlck1lc3NhZ2UuY29udGVudCkgfHxcbiAgICAgICAgICAvaW5zZXJ0YSg/OnIpP1xccytsYVxccytpbWFnZW5cXHMrKD86YW50ZXJpb3J8cHJldmlhfGNvbXBhcnRpZGF8c3ViaWRhKS9pLnRlc3QobGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQpIHx8XG4gICAgICAgICAgLy8gRGV0ZWN0YXIgbWVuY2lvbmVzIGEgXCJsYSBpbWFnZW5cIiBjdWFuZG8gZXN0w6EgY2xhcm8gcXVlIHNlIHF1aWVyZSBhZ3JlZ2FyXG4gICAgICAgICAgKC9sYVxccytpbWFnZW4vaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSAmJlxuICAgICAgICAgICAoL2FncmVnYXIvaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fFxuICAgICAgICAgICAgL2HDsWFkaXIvaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fFxuICAgICAgICAgICAgL2NvbG9jYXIvaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fFxuICAgICAgICAgICAgL3BvbmVyL2kudGVzdChsYXN0VXNlck1lc3NhZ2UuY29udGVudCkgfHxcbiAgICAgICAgICAgIC9pbnNlcnRhci9pLnRlc3QobGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQpKSlcbiAgICAgICAgKTtcblxuICAgICAgICBpZiAodXNlcldhbnRzVG9BZGRJbWFnZSAmJiBsYXN0VXNlck1lc3NhZ2UgJiYgdHlwZW9mIGxhc3RVc2VyTWVzc2FnZS5jb250ZW50ID09PSAnc3RyaW5nJykge1xuICAgICAgICAgIC8vIFNvbG8gc2kgZWwgdXN1YXJpbyBsbyBpbmRpY2EgY2xhcmFtZW50ZSwgY3JlYXIgdW4gZWxlbWVudG9cbiAgICAgICAgICBjb25zdCB7IHN0YXJ0VGltZSwgZW5kVGltZSB9ID0gZXh0cmFjdEltYWdlVGltZXNGcm9tTWVzc2FnZShsYXN0VXNlck1lc3NhZ2UuY29udGVudCk7XG5cbiAgICAgICAgICBjb25zb2xlLmxvZyhgQ3JlYW5kbyBlbGVtZW50byBkZSBpbWFnZW4gY29uIHRpZW1wb3M6IHN0YXJ0VGltZT0ke3N0YXJ0VGltZX0sIGVuZFRpbWU9JHtlbmRUaW1lfWApO1xuXG4gICAgICAgICAgZWxlbWVudERhdGEgPSB7XG4gICAgICAgICAgICBkZXRlY3RlZDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZGVuY2U6IDAuOSxcbiAgICAgICAgICAgIGVsZW1lbnQ6IHtcbiAgICAgICAgICAgICAgdHlwZTogXCJpbWFnZVwiLFxuICAgICAgICAgICAgICB1cmw6IGltYWdlVXJsLFxuICAgICAgICAgICAgICBzdGFydFRpbWU6IHN0YXJ0VGltZSxcbiAgICAgICAgICAgICAgZW5kVGltZTogZW5kVGltZVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gU2kgbm8gaGF5IGluZGljYWNpw7NuIGNsYXJhLCBubyBjcmVhciBlbGVtZW50b1xuICAgICAgICAgIGVsZW1lbnREYXRhID0ge1xuICAgICAgICAgICAgZGV0ZWN0ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgY29uZmlkZW5jZTogMFxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVsZW1lbnREYXRhID0ge1xuICAgICAgICAgIGRldGVjdGVkOiBmYWxzZSxcbiAgICAgICAgICBjb25maWRlbmNlOiAwXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIG1lc3NhZ2U6IHtcbiAgICAgICAgcm9sZTogJ2Fzc2lzdGFudCcsXG4gICAgICAgIGNvbnRlbnQ6IGNsZWFuZWRSZXNwb25zZVxuICAgICAgfSxcbiAgICAgIGVsZW1lbnREYXRhOiBlbGVtZW50RGF0YVxuICAgIH0pO1xuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIHByb2Nlc3NpbmcgcmVxdWVzdDpcIiwgZXJyb3IpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFwiVW5rbm93biBlcnJvciBvY2N1cnJlZFwiLFxuICAgIH0sIHsgc3RhdHVzOiA1MDAgfSk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJPcGVuQUkiLCJvcGVuYWkiLCJhcGlLZXkiLCJwcm9jZXNzIiwiZW52IiwiT1BFTkFJX0FQSV9LRVkiLCJzeXN0ZW1JbnN0cnVjdGlvbnMiLCJleHRyYWN0SW1hZ2VUaW1lc0Zyb21NZXNzYWdlIiwibWVzc2FnZUNvbnRlbnQiLCJzdGFydFRpbWUiLCJlbmRUaW1lIiwiY29uc29sZSIsImxvZyIsInN0YXJ0VGltZVBhdHRlcm5zIiwiZW5kVGltZVBhdHRlcm5zIiwiaXNBdFN0YXJ0IiwidGVzdCIsImlzQXRFbmQiLCJzdGFydFRpbWVNYXRjaCIsInBhdHRlcm4iLCJtYXRjaCIsInRvU3RyaW5nIiwiaW5jbHVkZXMiLCJwYXJzZUludCIsImVuZFRpbWVNYXRjaCIsImhhbmRsZVRpbWVsaW5lQ2hhdCIsIm1lc3NhZ2UiLCJzZWxlY3RlZEl0ZW1zIiwic2VsZWN0ZWRUZXh0IiwidXJsQW5hbHlzaXMiLCJzaG93U2NyZWVuc2hvdERldGVjdGlvbiIsImFwcGx5VHJhbnNpdGlvbkRldGVjdGlvbiIsImV4dHJhY3RlZENvbnRlbnQiLCJtYXAiLCJpdGVtIiwidGV4dCIsImRldGFpbHMiLCJuYW1lIiwiY29udGVudCIsIkpTT04iLCJzdHJpbmdpZnkiLCJqb2luIiwic3lzdGVtUHJvbXB0IiwiY29udGFpbnNVUkxzIiwidXJscyIsImRldGVjdGVkIiwicmVhc29uIiwiY2hhdFJlc3BvbnNlIiwiY2hhdCIsImNvbXBsZXRpb25zIiwiY3JlYXRlIiwibW9kZWwiLCJtZXNzYWdlcyIsInJvbGUiLCJ0ZW1wZXJhdHVyZSIsIm1heF90b2tlbnMiLCJzY3JlZW5zaG90RGF0YSIsInRyYW5zaXRpb25EYXRhIiwiY29uZmlkZW5jZSIsInNjcmVlbnNob3RzIiwidHJhbnNpdGlvblBhdGgiLCJzdWNjZXNzIiwicmVzcG9uc2UiLCJjaG9pY2VzIiwidXNhZ2UiLCJlcnJvciIsIkVycm9yIiwiUE9TVCIsInJlcSIsImJvZHkiLCJqc29uIiwidHlwZSIsImxhc3RJbWFnZVVybCIsIkFycmF5IiwiaXNBcnJheSIsInN0YXR1cyIsImltYWdlVXJsIiwibGFzdFVzZXJNZXNzYWdlIiwicmV2ZXJzZSIsImZpbmQiLCJtIiwiaW1hZ2VNYXRjaCIsImhhc0xhc3RJbWFnZVJlZmVyZW5jZSIsImlzQ29tcGFjdFJlcXVlc3QiLCJpc1NtYXJ0VHJpbVJlcXVlc3QiLCJjb252ZXJzYXRpb25XaXRoU3lzdGVtIiwidG9wX3AiLCJmcmVxdWVuY3lfcGVuYWx0eSIsInByZXNlbmNlX3BlbmFsdHkiLCJyZXNwb25zZUNvbnRlbnQiLCJlbGVtZW50RGF0YU1hdGNoIiwiY2xlYW5lZFJlc3BvbnNlIiwicmVwbGFjZSIsInRyaW0iLCJlbGVtZW50RGF0YSIsInBhcnNlIiwicmVhc29uaW5nIiwiZWxlbWVudCIsIndhcm4iLCJ1cmwiLCJOdW1iZXIiLCJncm91cFdvcmRzIiwidW5kZWZpbmVkIiwic2VnbWVudHMiLCJzZWdtZW50IiwibGVuZ3RoIiwidXNlcldhbnRzVG9BZGRJbWFnZSIsImUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/ai/route.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/formdata-node","vendor-chunks/openai","vendor-chunks/form-data-encoder","vendor-chunks/whatwg-url","vendor-chunks/agentkeepalive","vendor-chunks/tr46","vendor-chunks/web-streams-polyfill","vendor-chunks/node-fetch","vendor-chunks/webidl-conversions","vendor-chunks/ms","vendor-chunks/humanize-ms","vendor-chunks/event-target-shim","vendor-chunks/abort-controller"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fai%2Froute&page=%2Fapi%2Fai%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fai%2Froute.ts&appDir=C%3A%5CUsers%5Cdavid%5CDesktop%5Cai-video-agent%5Creact-video-editor%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cdavid%5CDesktop%5Cai-video-agent%5Creact-video-editor&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();