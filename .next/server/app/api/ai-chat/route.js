"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/ai-chat/route";
exports.ids = ["app/api/ai-chat/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "worker_threads":
/*!*********************************!*\
  !*** external "worker_threads" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("worker_threads");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:fs");

/***/ }),

/***/ "node:stream":
/*!******************************!*\
  !*** external "node:stream" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:stream");

/***/ }),

/***/ "node:stream/web":
/*!**********************************!*\
  !*** external "node:stream/web" ***!
  \**********************************/
/***/ ((module) => {

module.exports = require("node:stream/web");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fai-chat%2Froute&page=%2Fapi%2Fai-chat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fai-chat%2Froute.ts&appDir=C%3A%5CUsers%5Cdavid%5CDesktop%5Cai-video-agent%5Creact-video-editor%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cdavid%5CDesktop%5Cai-video-agent%5Creact-video-editor&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fai-chat%2Froute&page=%2Fapi%2Fai-chat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fai-chat%2Froute.ts&appDir=C%3A%5CUsers%5Cdavid%5CDesktop%5Cai-video-agent%5Creact-video-editor%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cdavid%5CDesktop%5Cai-video-agent%5Creact-video-editor&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_david_Desktop_ai_video_agent_react_video_editor_app_api_ai_chat_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/ai-chat/route.ts */ \"(rsc)/./app/api/ai-chat/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/ai-chat/route\",\n        pathname: \"/api/ai-chat\",\n        filename: \"route\",\n        bundlePath: \"app/api/ai-chat/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\david\\\\Desktop\\\\ai-video-agent\\\\react-video-editor\\\\app\\\\api\\\\ai-chat\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_david_Desktop_ai_video_agent_react_video_editor_app_api_ai_chat_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/ai-chat/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZhaS1jaGF0JTJGcm91dGUmcGFnZT0lMkZhcGklMkZhaS1jaGF0JTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGYWktY2hhdCUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNkYXZpZCU1Q0Rlc2t0b3AlNUNhaS12aWRlby1hZ2VudCU1Q3JlYWN0LXZpZGVvLWVkaXRvciU1Q2FwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9QyUzQSU1Q1VzZXJzJTVDZGF2aWQlNUNEZXNrdG9wJTVDYWktdmlkZW8tYWdlbnQlNUNyZWFjdC12aWRlby1lZGl0b3ImaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQzBDO0FBQ3ZIO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcmVtb3Rpb24tY2FwdGlvbnMvPzBjMWUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiQzpcXFxcVXNlcnNcXFxcZGF2aWRcXFxcRGVza3RvcFxcXFxhaS12aWRlby1hZ2VudFxcXFxyZWFjdC12aWRlby1lZGl0b3JcXFxcYXBwXFxcXGFwaVxcXFxhaS1jaGF0XFxcXHJvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9haS1jaGF0L3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvYWktY2hhdFwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvYWktY2hhdC9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIkM6XFxcXFVzZXJzXFxcXGRhdmlkXFxcXERlc2t0b3BcXFxcYWktdmlkZW8tYWdlbnRcXFxccmVhY3QtdmlkZW8tZWRpdG9yXFxcXGFwcFxcXFxhcGlcXFxcYWktY2hhdFxcXFxyb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvYWktY2hhdC9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fai-chat%2Froute&page=%2Fapi%2Fai-chat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fai-chat%2Froute.ts&appDir=C%3A%5CUsers%5Cdavid%5CDesktop%5Cai-video-agent%5Creact-video-editor%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cdavid%5CDesktop%5Cai-video-agent%5Creact-video-editor&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/ai-chat/route.ts":
/*!**********************************!*\
  !*** ./app/api/ai-chat/route.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! openai */ \"(rsc)/../node_modules/openai/index.mjs\");\n\n\n// Inicializar el cliente de OpenAI\nconst openai = new openai__WEBPACK_IMPORTED_MODULE_1__[\"default\"]({\n    apiKey: process.env.OPENAI_API_KEY\n});\n// Definir las instrucciones del sistema para el contexto del editor de video\nconst systemInstructions = `\nEres un asistente especializado en edición de video que ayuda a los usuarios a manipular elementos en su timeline.\nTu tarea principal es entender las intenciones del usuario y detectar cuando quieren agregar elementos al video o eliminar segmentos,\nincluso cuando lo expresan en lenguaje natural sin usar comandos específicos.\n\nIMPORTANTE: Además de responder naturalmente, debes analizar si el usuario está pidiendo añadir algún elemento al video,\neliminar segmentos de un elemento existente, o compactar/optimizar el timeline.\n\nSi con una confianza mayor al 70% crees que están solicitando agregar texto, imagen, video o subtítulos, debes incluir la información\nestructurada del elemento a agregar.\n\nEjemplos de solicitudes en lenguaje natural que deberías detectar:\n- \"Pon un título que diga 'Bienvenidos' al inicio del video\"\n- \"Me gustaría tener una imagen de fondo entre los segundos 5 y 10\"\n- \"Necesito un texto que diga 'Gracias por ver' al final\"\n- \"Quiero que aparezca mi logo en la esquina durante todo el video\"\n- \"Coloca un video de introducción al principio\"\n- \"Añade subtítulos al video\"\n- \"Pon subtítulos en el video\"\n- \"Quiero subtítulos para mi video\"\n- \"Agrega los subtítulos\"\n\nNUEVA FUNCIONALIDAD - MÚSICA:\nTambién debes detectar cuando el usuario quiere agregar música al video.\nCuando detectes una solicitud para agregar música, debes recomendar las dos opciones disponibles en una respuesta BREVE y CONCISA.\n\nEjemplos de solicitudes para agregar música:\n- \"Agrega música al video\"\n- \"Pon música de fondo\"\n- \"Necesito música para mi video\"\n- \"Quiero añadir una banda sonora\"\n- \"Ponle algo de música\"\n- \"Añade música\"\n- \"Me gustaría ponerle música\"\n- \"¿Puedes agregar música?\"\n- \"Quiero música en mi video\"\n\nAl detectar estas solicitudes, debes responder con una frase corta como:\n\"¿Cuál de estas opciones prefieres?\" o \"Aquí tienes dos opciones musicales:\"\n\nEn la estructura JSON, debes incluir las rutas de archivo correctas:\n\"options\": [\"/songs/song1.mp3\", \"/songs/song2.mp3\"]\n\nNO SUGIERAS OTRAS CANCIONES QUE NO SEAN ESTAS DOS, ya que no existen en el sistema.\n\nFUNCIONALIDAD - DETECCIÓN DE ELIMINACIÓN DE SEGMENTOS:\nTambién debes detectar cuando el usuario quiere eliminar segmentos de un elemento en el timeline.\nEsto implica eliminar porciones específicas de un video, audio, texto o imagen según los tiempos indicados.\n\nEjemplos de solicitudes para eliminar segmentos:\n- \"Elimina el segmento entre los segundos 2 y 5 del video\"\n- \"Recorta la parte del video que va del segundo 10 al 13\"\n- \"Quiero quitar el trozo entre 25 y 30 segundos\"\n- \"Corta los segmentos 2-5, 10-13 y 25-30\"\n- \"Elimina estas partes del video: 2 a 5, 10 a 13, y 25 a 30 segundos\"\n- \"Quita estos fragmentos: 2-5s, 10-13s, 25-30s\"\n\nFUNCIONALIDAD - COMPACTACIÓN DEL TIMELINE:\nTambién puedes detectar cuando el usuario quiere compactar o optimizar el timeline, eliminando\nespacios vacíos entre clips o elementos para que el video sea más fluido y continuo.\n\nEjemplos de solicitudes para compactar el timeline:\n- \"Compacta el timeline\"\n- \"Elimina los espacios vacíos\"\n- \"Optimiza el timeline\"\n- \"Quita los huecos entre clips\"\n- \"Compacta todo\"\n- \"Junta los clips\"\n- \"Quiero eliminar los espacios entre elementos\"\n- \"Necesito que no haya espacios entre los elementos\"\n- \"Comprime el timeline\"\n\nNUEVA FUNCIONALIDAD - RECORTE INTELIGENTE:\nTambién puedes detectar cuando el usuario quiere realizar un recorte inteligente del video,\nanalizando la transcripción para identificar automáticamente qué partes mantener y cuáles eliminar.\n\nEjemplos de solicitudes para recorte inteligente:\n- \"Haz un recorte inteligente\"\n- \"Analiza el video y recorta las partes innecesarias\"\n- \"Recorta inteligentemente el video\"\n- \"Puedes hacer un smart trim\"\n- \"Elimina las partes innecesarias del video\"\n- \"Quiero que analices y recortes el video\"\n- \"Hazme un recorte automático\"\n- \"Recorta automáticamente el video\"\n- \"Smart trim\"\n- \"Elimina las partes redundantes\"\n\nCuando detectes que el usuario quiere eliminar segmentos, debes identificar los tiempos de inicio y fin de cada segmento a eliminar.\nEl formato para los segmentos debe ser un array de objetos con startTime y endTime en segundos.\n\nAdicionalmente, el usuario puede adjuntar imágenes a sus mensajes, que aparecerán con el formato [IMAGEN: URL_de_la_imagen].\nNOTA IMPORTANTE: No siempre que un usuario adjunta una imagen quiere agregarla al video. Solo debes detectar la intención\nde agregar la imagen si el usuario lo indica explícitamente con frases como \"agrega esta imagen\", \"pon esta imagen en el video\", etc.\nSi el usuario solo envía una imagen sin texto o con un texto que no indica claramente su intención de agregarla,\nNO debes sugerir agregarla automáticamente.\n\nCRUCIAL: Es EXTREMADAMENTE importante que analices cuidadosamente el lenguaje natural para detectar:\n1. Si realmente quiere agregar la imagen o eliminar segmentos (confianza alta)\n2. El tiempo exacto donde quiere agregarlo o los segmentos a eliminar (segundos iniciales y finales)\n3. Si quiere compactar el timeline (eliminar espacios vacíos)\n4. Si quiere hacer un recorte inteligente del video\n5. Si quiere agregar música al video\n\nEjemplos de tiempos que debes detectar:\n- \"agrega esta imagen en el segundo 10\" → startTime: 10, endTime: 15\n- \"pon la imagen del segundo 5 al 8\" → startTime: 5, endTime: 8\n- \"quiero esta imagen entre los segundos 3 y 7\" → startTime: 3, endTime: 7\n- \"agrega la imagen al inicio\" → startTime: 0, endTime: 5\n- \"la imagen va al final\" → startTime: [duración-5], endTime: [duración]\n\nPara subtítulos, detecta si el usuario quiere:\n- Subtítulos agrupados (por defecto): groupWords: true\n- Subtítulos completos sin dividir: groupWords: false\n- Subtítulos en un rango de tiempo específico: startTime y endTime\n\nCuando detectes una solicitud para agregar contenido, analiza:\n1. Tipo de elemento: texto, imagen, video, subtitles, segments (para eliminar segmentos) o music (para agregar música)\n2. Contenido (para texto)\n3. Color (si se menciona)\n4. Ubicación temporal (tiempo de inicio y fin en segundos) ← CRUCIAL\n5. URL de la imagen (si se proporcionó en el mensaje)\n6. Nivel de confianza en tu interpretación (de 0.0 a 1.0)\n7. Para subtítulos: si deben agruparse o no (groupWords)\n8. Para eliminar segmentos: un array de objetos con startTime y endTime para cada segmento\n9. Para compactar: simplemente detectar la intención (type: \"compact\")\n10. Para recorte inteligente: simplemente detectar la intención (type: \"smartTrim\")\n11. Para música: incluir un array de opciones recomendadas\n\nPara subtítulos, si el usuario no dice nada, asume que deben durar del segundo 0 al segundo 10000000 (final del video) y que deben estar agrupados, no preguntes si agrupados o no, asume que si siempre. Tambien asume que son los subtitulos generados automaticamente asi que responde siempre que el user pida subtitulos con mensajes de \"Subtitulos agregados con exito o algo por ele estilo, breve y conciso.\".\n\nLos elementos que se pueden agregar tienen esta estructura general:\n- Texto: { type: \"text\", content: \"texto\", color: \"#color\", startTime: X, endTime: Y }\n- Imagen: { type: \"image\", url: \"url_de_la_imagen\", startTime: X, endTime: Y }\n- Video: { type: \"video\", startTime: X, endTime: Y }\n- Subtítulos: { type: \"subtitles\", groupWords: true/false, startTime: X, endTime: Y }\n- Eliminar segmentos: { type: \"segments\", segments: [{ startTime: X1, endTime: Y1 }, { startTime: X2, endTime: Y2 }, ...] }\n- Compactar timeline: { type: \"compact\" }\n- Recorte inteligente: { type: \"smartTrim\" }\n- Música: { type: \"music\", options: [\"/songs/song1.mp3\", \"/songs/song2.mp3\"] }\n\nPD: Un elemento no puede duarar 0 segundos, como minimo 0,1. Si no te dicen el tiempo final, el elemento dura 5 segundos. No puedes decir -voy a agregar este elemento- y no dar true con high confidence, no te congradigas. Si el user no menciona el tiempo donde quiere agregar la imagen, preguntale al user en que tiempo quiere agregar la imagen. Si dice solo el tiempo de inicio, no le preguntes, asume que debe durar 5 segundos, no le preguntes, repito.`;\n// Función para analizar los tiempos de inicio y fin de una imagen a partir del mensaje del usuario\nfunction extractImageTimesFromMessage(messageContent) {\n    let startTime = 0;\n    let endTime = 5;\n    if (!messageContent) return {\n        startTime,\n        endTime\n    };\n    console.log(\"Analizando mensaje para tiempos:\", messageContent);\n    // Buscar patrones de rango directo (formato X-Y o X a Y)\n    const rangePatterns = [\n        /(?:del|desde)?\\s*(?:seg(?:undo)?s?|s)\\s*(\\d+)(?:\\s*(?:al|hasta|a)\\s*|\\s*[-–—]\\s*)(\\d+)/i,\n        /(?:entre)?\\s*(?:el|los)?\\s*(?:seg(?:undo)?s?|s)\\s*(\\d+)\\s*(?:y|e)\\s*(?:el)?\\s*(\\d+)/i,\n        /(\\d+)\\s*(?:al|a|hasta)\\s*(\\d+)\\s*(?:seg(?:undo)?s?|s)/i,\n        /(?:en el rango|rango|de)\\s*(\\d+)\\s*(?:a|al|hasta|-|–|—)\\s*(\\d+)/i,\n        /(\\d+)\\s*(?:-|–|—)\\s*(\\d+)\\s*(?:seg(?:undo)?s?|s)/i,\n        /del\\s*(?:segundo|seg|s)?\\s*(\\d+)\\s*al\\s*(?:segundo|seg|s)?\\s*(\\d+)/i,\n        /desde\\s*(?:el)?\\s*(?:segundo|seg|s)?\\s*(\\d+)\\s*(?:al|hasta)\\s*(?:el)?\\s*(?:segundo|seg|s)?\\s*(\\d+)/i,\n        /(?:poner|agregar|añadir|colocar|insertar|meter|mostrar)\\s+(?:una|la|esta|mi)?\\s*imagen\\s+(?:del|desde)\\s*(?:segundo|seg|s)?\\s*(\\d+)\\s*(?:al|hasta)\\s*(?:el)?\\s*(?:segundo|seg|s)?\\s*(\\d+)/i // \"agregar imagen del segundo 5 al 10\"\n    ];\n    // Verificar primero los patrones de rango directo (tienen prioridad)\n    for (const pattern of rangePatterns){\n        const match = messageContent.match(pattern);\n        if (match && match[1] && match[2]) {\n            startTime = parseInt(match[1]);\n            endTime = parseInt(match[2]);\n            console.log(`Patrón de rango coincidió: ${pattern}, valores: ${startTime}-${endTime}`);\n            return {\n                startTime,\n                endTime\n            };\n        }\n    }\n    // Caso simple: buscar números directamente\n    // Por ejemplo: \"agrega esta imagen 5 10\" (asumiendo que 5 y 10 son tiempos)\n    const simpleTwoNumbers = messageContent.match(/imagen.*?\\b(\\d+)\\b.*?\\b(\\d+)\\b/i);\n    if (simpleTwoNumbers && simpleTwoNumbers[1] && simpleTwoNumbers[2]) {\n        startTime = parseInt(simpleTwoNumbers[1]);\n        endTime = parseInt(simpleTwoNumbers[2]);\n        // Verificar que los valores tengan sentido\n        if (startTime < endTime && endTime - startTime <= 60) {\n            console.log(`Patrón simple de dos números coincidió: ${startTime}-${endTime}`);\n            return {\n                startTime,\n                endTime\n            };\n        }\n    }\n    // Buscar referencias al tiempo inicial\n    const startTimePatterns = [\n        /en el segundo (\\d+)/i,\n        /desde el segundo (\\d+)/i,\n        /a partir del segundo (\\d+)/i,\n        /comenzando en el segundo (\\d+)/i,\n        /desde el minuto (\\d+)/i,\n        /en el minuto (\\d+)/i,\n        /entre los segundos (\\d+) y/i,\n        /del segundo (\\d+) al/i,\n        /empezando en (\\d+)/i,\n        /desde (?:el seg(?:undo)?)?\\s*(\\d+)/i,\n        /a partir de (?:el seg(?:undo)?)?\\s*(\\d+)/i,\n        /(?:en|al) (?:el seg(?:undo)?)?\\s*(\\d+)/i,\n        /(?:en|al) (?:el)?\\s*(\\d+)\\s*(?:seg(?:undo)?)?/i,\n        /seg(?:undo)?\\s*(\\d+)/i,\n        /a los (\\d+)\\s*(?:seg(?:undos)?|s)/i,\n        /segundo (\\d+)/i,\n        /en (\\d+) segundos/i,\n        /en el (\\d+)/i,\n        /(\\d+)\\s*(?:seg(?:undos)?|s)\\s*(?:de inicio|iniciales)/i,\n        /(\\d+)\\s*$/i\n    ];\n    // Buscar referencias al tiempo final\n    const endTimePatterns = [\n        /hasta el segundo (\\d+)/i,\n        /al segundo (\\d+)/i,\n        /terminando en el segundo (\\d+)/i,\n        /hasta el minuto (\\d+)/i,\n        /entre los segundos \\d+ y (\\d+)/i,\n        /del segundo \\d+ al (\\d+)/i,\n        /hasta (?:el seg(?:undo)?)?\\s*(\\d+)/i,\n        /(?:terminando|acabando) en (?:el seg(?:undo)?)?\\s*(\\d+)/i,\n        /(?:hasta|al) (?:el)?\\s*(\\d+)\\s*(?:seg(?:undo)?)?/i,\n        /(?:por|durante) (\\d+) segundos/i,\n        /(?:por|durante) (\\d+)s/i,\n        /(?:por|durante) (\\d+)/i,\n        /(\\d+)\\s*(?:seg(?:undos)?|s)\\s*(?:de duración|finales)/i\n    ];\n    // Buscar palabras clave especiales\n    const isAtStart = /\\b(al inicio|al principio|al comienzo|al empezar|inicio|principio|comienzo)\\b/i.test(messageContent);\n    const isAtEnd = /\\b(al final|al término|al acabar|finalizar|final|término)\\b/i.test(messageContent);\n    // Procesar patrones de tiempo inicial\n    let startTimeMatch = false;\n    for (const pattern of startTimePatterns){\n        const match = messageContent.match(pattern);\n        if (match && match[1]) {\n            startTimeMatch = true;\n            // Si es referencia a minutos, convertir a segundos\n            startTime = pattern.toString().includes(\"minuto\") ? parseInt(match[1]) * 60 : parseInt(match[1]);\n            console.log(`Patrón de tiempo inicial coincidió: ${pattern}, valor: ${startTime}`);\n            break;\n        }\n    }\n    // Procesar patrones de tiempo final\n    let endTimeMatch = false;\n    for (const pattern of endTimePatterns){\n        const match = messageContent.match(pattern);\n        if (match && match[1]) {\n            endTimeMatch = true;\n            if (pattern.toString().includes(\"por\") || pattern.toString().includes(\"durante\")) {\n                // Es una duración relativa, sumar al tiempo inicial\n                endTime = startTime + parseInt(match[1]);\n            } else {\n                // Es un tiempo absoluto\n                endTime = pattern.toString().includes(\"minuto\") ? parseInt(match[1]) * 60 : parseInt(match[1]);\n            }\n            console.log(`Patrón de tiempo final coincidió: ${pattern}, valor: ${endTime}`);\n            break;\n        }\n    }\n    // Si se menciona \"al inicio\", establecer tiempo a 0\n    if (isAtStart) {\n        startTime = 0;\n        endTime = 5; // Por defecto 5 segundos de duración\n        console.log(\"Se detect\\xf3 'al inicio': startTime=0, endTime=5\");\n    }\n    // Si se menciona \"al final\", establecer valores relativos al final\n    // Nota: El valor real se ajustará en el cliente según la duración\n    if (isAtEnd) {\n        startTime = -1; // Código especial para \"final - 5 segundos\"\n        endTime = -1; // Código especial para \"final\"\n        console.log(\"Se detect\\xf3 'al final': startTime=-1, endTime=-1\");\n    }\n    // Si se detectó un tiempo inicial pero no final, establecer duración predeterminada\n    if (startTimeMatch && !endTimeMatch) {\n        endTime = startTime + 5;\n        console.log(`Se estableció tiempo final automático: ${endTime} (startTime + 5)`);\n    }\n    // Si no se detectó tiempo final pero sí inicial, establecer una duración predeterminada\n    if (startTime > 0 && endTime === 5 && startTime !== 0) {\n        endTime = startTime + 5;\n        console.log(`Se ajustó tiempo final: ${endTime} (startTime + 5)`);\n    }\n    // Si el tiempo de inicio es mayor que el final (puede pasar con ciertos patrones),\n    // intercambiarlos para asegurar validez\n    if (startTime > endTime && startTime >= 0 && endTime >= 0) {\n        console.log(`Corrigiendo orden de tiempos: ${startTime}>${endTime}`);\n        const temp = startTime;\n        startTime = endTime;\n        endTime = temp;\n    }\n    // Asegurarse de que la duración sea de al menos 0.1 segundos\n    if (endTime - startTime < 0.1 && startTime >= 0 && endTime >= 0) {\n        endTime = startTime + 0.1;\n        console.log(`Ajustando duración mínima: startTime=${startTime}, endTime=${endTime}`);\n    }\n    console.log(`Tiempos finales extraídos: startTime=${startTime}, endTime=${endTime}`);\n    return {\n        startTime,\n        endTime\n    };\n}\nasync function POST(req) {\n    try {\n        // Extraer los mensajes del cuerpo de la solicitud\n        const { messages, lastImageUrl = \"\" } = await req.json();\n        // Validar que se proporcionaron mensajes\n        if (!messages || !Array.isArray(messages)) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Se requieren mensajes v\\xe1lidos\"\n            }, {\n                status: 400\n            });\n        }\n        // Extraer la URL de la imagen si está presente en el último mensaje\n        let imageUrl = \"\";\n        const lastUserMessage = [\n            ...messages\n        ].reverse().find((m)=>m.role === \"user\");\n        if (lastUserMessage && typeof lastUserMessage.content === \"string\") {\n            // Buscar URL de imagen explícita\n            const imageMatch = lastUserMessage.content.match(/\\[IMAGEN: (.*?)\\]/);\n            if (imageMatch && imageMatch[1]) {\n                imageUrl = imageMatch[1];\n            } else if (lastUserMessage.content.includes(\"[IMAGEN_ADJUNTA]\")) {\n                // Usamos un identificador especial para indicar que se debe usar la última imagen\n                // NO usar una URL relativa que causaría error 404\n                imageUrl = \"imagen_adjunta_por_el_usuario.jpg\";\n            }\n        }\n        // Si no hay imagen en el mensaje actual pero hay una última imagen URL, usarla en caso\n        // de que el usuario esté haciendo referencia a ella\n        const hasLastImageReference = !imageUrl && lastImageUrl && lastUserMessage && typeof lastUserMessage.content === \"string\" && (/la\\s+imagen/i.test(lastUserMessage.content) || /esta\\s+imagen/i.test(lastUserMessage.content) || /imagen\\s+(?:anterior|previa|compartida|subida)/i.test(lastUserMessage.content));\n        // Si parece que el usuario está haciendo referencia a una imagen anterior,\n        // considerar usar esa URL\n        if (hasLastImageReference) {\n            console.log(\"Se detect\\xf3 referencia a una imagen anterior\");\n            // Usar el mismo identificador especial\n            imageUrl = \"imagen_adjunta_por_el_usuario.jpg\";\n        }\n        // Verificar si el usuario está solicitando compactar el timeline\n        const isCompactRequest = lastUserMessage && typeof lastUserMessage.content === \"string\" && /compact[a|ar]|elimina[r]?\\s+(los)?\\s*espacios|optimiza[r]?|quita[r]?\\s+(los)?\\s*huecos|junta[r]?\\s+(los)?\\s*clips|comprim[e|ir]/i.test(lastUserMessage.content);\n        if (isCompactRequest) {\n            console.log(\"Se detect\\xf3 posible solicitud de compactaci\\xf3n del timeline\");\n        }\n        // Verificar si el usuario está solicitando un recorte inteligente\n        const isSmartTrimRequest = lastUserMessage && typeof lastUserMessage.content === \"string\" && /recorte\\s+inteligente|smart\\s*trim|analiza\\s+(?:y\\s+)?recort[a|e]|recort[a|e]\\s+(?:inteligentemente|automáticamente)|elimina\\s+(?:partes|segmentos)\\s+(?:innecesari[os|as]|redundantes)/i.test(lastUserMessage.content);\n        if (isSmartTrimRequest) {\n            console.log(\"Se detect\\xf3 posible solicitud de recorte inteligente\");\n        }\n        // Verificar si el usuario está solicitando agregar música\n        const isMusicRequest = lastUserMessage && typeof lastUserMessage.content === \"string\" && (/(?:agrega|añade|pon|coloca|quiero|necesito|añadir|agregar|poner|colocar)\\s+(?:algo\\s+de\\s+)?(música|musica|audio|sonido|banda\\s+sonora|soundtrack)/i.test(lastUserMessage.content) || /música\\s+(?:para|en|de)\\s+(?:el|mi)?\\s*video/i.test(lastUserMessage.content) || /poner\\s+música/i.test(lastUserMessage.content) || /música\\s+de\\s+fondo/i.test(lastUserMessage.content));\n        if (isMusicRequest) {\n            console.log(\"Se detect\\xf3 posible solicitud de agregar m\\xfasica\");\n        }\n        // Añadir el mensaje del sistema al inicio para dar contexto\n        const conversationWithSystem = [\n            {\n                role: \"system\",\n                content: systemInstructions\n            },\n            ...messages,\n            {\n                role: \"system\",\n                content: `\n        Después de responder al usuario, evalúa si están solicitando agregar un elemento al video o eliminar segmentos.\n        Si crees que están solicitando agregar un elemento o eliminar segmentos con una confianza mayor a 0.7, incluye una estructura JSON como esta al final de tu respuesta, entre los marcadores <element_data> y </element_data>:\n\n        <element_data>\n        {\n          \"detected\": true,\n          \"confidence\": [nivel de confianza entre 0 y 1],\n          \"element\": {\n            \"type\": [\"text\", \"image\", \"video\", \"subtitles\", \"segments\", \"compact\", \"smartTrim\" o \"music\"],\n            \"content\": \"[solo para texto - el contenido del texto]\",\n            \"color\": \"[solo para texto - color en hex o nombre]\",\n            \"url\": \"[solo para imagen - URL de la imagen si se proporcionó]\",\n            \"startTime\": [tiempo inicial en segundos, solo para text, image, video, subtitles],\n            \"endTime\": [tiempo final en segundos, solo para text, image, video, subtitles],\n            \"segments\": [solo para segments - array de objetos con startTime y endTime para cada segmento a eliminar],\n            \"options\": [solo para music - array de rutas a archivos de música recomendados]\n          },\n          \"reasoning\": \"Explica detalladamente por qué has elegido este nivel de confianza y por qué has decidido que se debe insertar o no un elemento. Incluye los factores que consideraste y las palabras clave que detectaste en el mensaje del usuario.\"\n        }\n        </element_data>\n\n        Si no están solicitando agregar elementos o eliminar segmentos, o tu confianza es menor a 0.7, incluye:\n\n        <element_data>\n        {\n          \"detected\": false,\n          \"confidence\": [nivel de confianza entre 0 y 1],\n          \"reasoning\": \"Explica detalladamente por qué has elegido este nivel de confianza y por qué has decidido que NO se debe insertar un elemento. Incluye los factores que consideraste y por qué el mensaje del usuario no constituye una solicitud clara de inserción.\"\n        }\n        </element_data>\n\n        IMPORTANTE PARA SOLICITUDES DE MÚSICA:\n        Si el usuario solicita añadir música al video, debes recomendar una lista de canciones que podrían ser adecuadas.\n        En tu respuesta natural, menciona que has analizado el video y sugieres varias opciones musicales.\n        Luego, en la estructura JSON, incluye estas opciones en el campo \"options\".\n\n        Por ejemplo, si el usuario dice \"añade música al video\", podrías responder:\n        \"He analizado tu video y te recomiendo estas canciones que podrían complementarlo bien. Puedes hacer clic en cualquiera para añadirla.\"\n\n        Y en el JSON:\n        \"element\": {\n          \"type\": \"music\",\n          \"options\": [\"/songs/song1.mp3\", \"/songs/song2.mp3\"]\n        }\n\n        ${imageUrl ? `IMPORTANTE: El usuario ha compartido una imagen con URL: ${imageUrl}.\nNO asumas automáticamente que quiere agregarla al video.\nSolo debes sugerir agregarla si el usuario lo indica explícitamente en su mensaje.\nSi el usuario no ha expresado claramente su intención de agregar la imagen, simplemente reconoce que la has visto y pregunta qué desea hacer con ella.` : `NOTA: Aunque el usuario no ha adjuntado una imagen en este mensaje, es posible que haya compartido una imagen anteriormente y esté haciendo referencia a ella.\nSi el usuario menciona \"esta imagen\", \"la imagen\" o algo similar, y está pidiendo agregarla al video, asume que se refiere a la última imagen compartida. Ademas si el user no menciona el tiempo donde quiere agregar la imagen, preguntale al user en que tiempo quiere agregar la imagen. Si dice solo el tiempo de inicio, no le preguntes, asume que debe durar 5 segundos, no le preguntes, repito. No puedes decir -voy a agregar este elemento- y no dar true con high confidence, no te congradigas.`}\n\n        IMPORTANTE: Esta estructura JSON es solo para procesamiento interno y no debe ser mencionada en tu respuesta al usuario, o estas despedido (las repsuta al user keep it short boy).\n        `\n            }\n        ];\n        // Registrar el prompt completo enviado a la IA\n        console.log(\"=== PROMPT ENVIADO A LA IA ===\");\n        console.log(JSON.stringify(conversationWithSystem, null, 2));\n        console.log(\"==============================\");\n        // Llamar a la API de OpenAI para generar una respuesta\n        const response = await openai.chat.completions.create({\n            model: \"gpt-4.1-mini\",\n            messages: conversationWithSystem,\n            temperature: 0.7,\n            max_tokens: 1000,\n            top_p: 0.95,\n            frequency_penalty: 0.0,\n            presence_penalty: 0.0\n        });\n        // Obtener la respuesta generada\n        const responseContent = response.choices[0].message.content || \"\";\n        // Registrar la respuesta completa de la IA\n        console.log(\"=== RESPUESTA DE LA IA ===\");\n        console.log(responseContent);\n        console.log(\"==========================\");\n        // Extraer los datos del elemento si existen\n        const elementDataMatch = responseContent.match(/<element_data>([\\s\\S]*?)<\\/element_data>/);\n        // Preparar la respuesta al cliente\n        let cleanedResponse = responseContent.replace(/<element_data>[\\s\\S]*?<\\/element_data>/g, \"\").trim();\n        let elementData = null;\n        if (elementDataMatch && elementDataMatch[1]) {\n            try {\n                elementData = JSON.parse(elementDataMatch[1].trim());\n                // Registrar el razonamiento de la IA\n                console.log(\"=== RAZONAMIENTO DE LA IA ===\");\n                console.log(`Detectado: ${elementData.detected}`);\n                console.log(`Confianza: ${elementData.confidence}`);\n                console.log(`Razonamiento: ${elementData.reasoning || \"No proporcionado\"}`);\n                console.log(\"=============================\");\n                // Verificar que el formato de los datos es correcto\n                if (elementData && elementData.detected === true && elementData.element) {\n                    // Asegurarse de que los campos obligatorios existen\n                    if (!elementData.element.type || elementData.element.type === \"text\" && !elementData.element.content) {\n                        console.warn(\"Datos de elemento incompletos:\", elementData);\n                        // Convertir a formato \"no detectado\" si faltan campos obligatorios\n                        elementData = {\n                            detected: false,\n                            confidence: elementData.confidence || 0\n                        };\n                    }\n                    // Si hay una imagen en el mensaje pero no se específica en el elemento, agregarla\n                    if (imageUrl && elementData.element.type === \"image\" && !elementData.element.url) {\n                        elementData.element.url = imageUrl;\n                    }\n                    // Si el elemento de imagen tiene la URL genérica y hay una última imagen válida, asegurarse de identificarlo\n                    if (elementData.element.type === \"image\" && elementData.element.url === \"imagen_adjunta_por_el_usuario.jpg\" && !lastImageUrl) {\n                        console.warn(\"Se detect\\xf3 URL gen\\xe9rica de imagen pero no hay \\xfaltima imagen disponible\");\n                    }\n                    // Normalizar tipos de datos\n                    if (elementData.element.startTime) elementData.element.startTime = Number(elementData.element.startTime);\n                    if (elementData.element.endTime) elementData.element.endTime = Number(elementData.element.endTime);\n                    // Si es una imagen pero no tiene tiempos definidos o son inválidos, extraerlos del mensaje\n                    if (elementData.element.type === \"image\" && lastUserMessage && typeof lastUserMessage.content === \"string\" && (elementData.element.startTime === undefined || elementData.element.endTime === undefined || isNaN(elementData.element.startTime) || isNaN(elementData.element.endTime) || elementData.element.startTime === elementData.element.endTime)) {\n                        console.log(\"Detectando tiempos para elemento de imagen...\");\n                        const extractedTimes = extractImageTimesFromMessage(lastUserMessage.content);\n                        elementData.element.startTime = extractedTimes.startTime;\n                        elementData.element.endTime = extractedTimes.endTime;\n                        console.log(`Tiempos extraídos para imagen: startTime=${elementData.element.startTime}, endTime=${elementData.element.endTime}`);\n                    }\n                    // Añadir manejo para subtítulos\n                    if (elementData.element.type === \"subtitles\") {\n                        // Normalizar valores\n                        if (elementData.element.groupWords === undefined) {\n                            elementData.element.groupWords = true; // Por defecto, agrupar palabras\n                        }\n                        if (elementData.element.startTime) elementData.element.startTime = Number(elementData.element.startTime);\n                        if (elementData.element.endTime) elementData.element.endTime = Number(elementData.element.endTime);\n                    }\n                    // Añadir manejo para segmentos a eliminar\n                    if (elementData.element.type === \"segments\" && elementData.element.segments) {\n                        // Asegurarse de que segments es un array\n                        if (!Array.isArray(elementData.element.segments)) {\n                            elementData.element.segments = [];\n                        }\n                        // Normalizar los valores de cada segmento\n                        elementData.element.segments = elementData.element.segments.map((segment)=>({\n                                startTime: Number(segment.startTime),\n                                endTime: Number(segment.endTime)\n                            }));\n                        // Verificar que hay al menos un segmento válido\n                        if (elementData.element.segments.length === 0) {\n                            console.warn(\"No se detectaron segmentos v\\xe1lidos para eliminar\");\n                            elementData.detected = false;\n                        }\n                    }\n                    // Añadir manejo para música\n                    if (elementData.element.type === \"music\") {\n                        // Asegurarse de que options es un array\n                        if (!elementData.element.options || !Array.isArray(elementData.element.options)) {\n                            console.log(\"Creando opciones de m\\xfasica por defecto\");\n                            // Opciones por defecto (solo las que existen realmente)\n                            elementData.element.options = [\n                                \"/songs/song1.mp3\",\n                                \"/songs/song2.mp3\"\n                            ];\n                        }\n                        // Asegurarse de que las opciones solo son las existentes\n                        if (elementData.element.options.length > 0) {\n                            console.log(\"Actualizando opciones de m\\xfasica para usar solo las existentes\");\n                            elementData.element.options = [\n                                \"/songs/song1.mp3\",\n                                \"/songs/song2.mp3\"\n                            ];\n                        }\n                    }\n                }\n                // Si hay una detección directa de solicitud de compactación pero la IA no la detectó\n                if (isCompactRequest && (!elementData || !elementData.detected || elementData.element?.type !== \"compact\")) {\n                    console.log(\"Generando elemento de compactaci\\xf3n basado en la detecci\\xf3n directa\");\n                    elementData = {\n                        detected: true,\n                        confidence: 0.95,\n                        element: {\n                            type: \"compact\"\n                        },\n                        reasoning: \"Detectado basado en el an\\xe1lisis de patrones de solicitud directa de compactaci\\xf3n\"\n                    };\n                }\n                // Si hay una detección directa de solicitud de recorte inteligente pero la IA no lo detectó\n                if (isSmartTrimRequest && (!elementData || !elementData.detected || elementData.element?.type !== \"smartTrim\")) {\n                    console.log(\"Generando elemento de recorte inteligente basado en la detecci\\xf3n directa\");\n                    elementData = {\n                        detected: true,\n                        confidence: 0.95,\n                        element: {\n                            type: \"smartTrim\"\n                        },\n                        reasoning: \"Detectado basado en el an\\xe1lisis de patrones de solicitud directa de recorte inteligente\"\n                    };\n                }\n                // Si hay una detección directa de solicitud de música pero la IA no la detectó\n                if (isMusicRequest && (!elementData || !elementData.detected || elementData.element?.type !== \"music\")) {\n                    console.log(\"Generando elemento de m\\xfasica basado en la detecci\\xf3n directa\");\n                    // Lista de canciones recomendadas (solo las que existen realmente)\n                    const musicOptions = [\n                        \"/songs/song1.mp3\",\n                        \"/songs/song2.mp3\"\n                    ];\n                    elementData = {\n                        detected: true,\n                        confidence: 0.95,\n                        element: {\n                            type: \"music\",\n                            options: musicOptions\n                        },\n                        reasoning: \"Detectado basado en el an\\xe1lisis de patrones de solicitud directa de m\\xfasica\"\n                    };\n                }\n                // Si hay una imagen compartida y no se detectó ningún elemento, no crear uno automáticamente\n                // a menos que el último mensaje del usuario tenga indicaciones claras\n                if (imageUrl && (!elementData || !elementData.detected)) {\n                    // Verificar si el mensaje del usuario indica claramente que quiere agregar la imagen\n                    const userWantsToAddImage = lastUserMessage && typeof lastUserMessage.content === \"string\" && (/agrega(?:r)?\\s+(esta|la|mi|una)\\s+imagen/i.test(lastUserMessage.content) || /a(?:ñ|n)ade\\s+(esta|la|mi|una)\\s+imagen/i.test(lastUserMessage.content) || /coloca(?:r)?\\s+(esta|la|mi|una)\\s+imagen/i.test(lastUserMessage.content) || /pon(?:er)?\\s+(esta|la|mi|una)\\s+imagen/i.test(lastUserMessage.content) || /usa(?:r)?\\s+(esta|la|mi|una)\\s+imagen/i.test(lastUserMessage.content) || /inserta(?:r)?\\s+(esta|la|mi|una)\\s+imagen/i.test(lastUserMessage.content) || /mete(?:r)?\\s+(esta|la|mi|una)\\s+imagen/i.test(lastUserMessage.content) || // Patrones más generales\n                    /(?:quiero|necesito|quisiera)\\s+(?:agregar|añadir|colocar|poner|insertar|meter)\\s+(?:la|esta|mi|una)?\\s*imagen/i.test(lastUserMessage.content) || /(?:puedes|podrías)\\s+(?:agregar|añadir|colocar|poner|insertar|meter)\\s+(?:la|esta|mi|una)?\\s*imagen/i.test(lastUserMessage.content) || // Patrones con el segmento de tiempo específico\n                    /imagen\\s+(?:en|a|al|del|desde|entre)\\s+(?:el|los)?\\s*(?:segundo|seg|s|tiempo|minuto|min)/i.test(lastUserMessage.content) || /imagen.*\\b\\d+\\b.*\\b\\d*\\b/i.test(lastUserMessage.content) || // imagen seguida de números (probable tiempo)\n                    // Detectar cuando se hace referencia a una imagen previa\n                    /agrega(?:r)?\\s+la\\s+imagen\\s+(?:anterior|previa|compartida|subida)/i.test(lastUserMessage.content) || /a(?:ñ|n)ade\\s+la\\s+imagen\\s+(?:anterior|previa|compartida|subida)/i.test(lastUserMessage.content) || /coloca(?:r)?\\s+la\\s+imagen\\s+(?:anterior|previa|compartida|subida)/i.test(lastUserMessage.content) || /pon(?:er)?\\s+la\\s+imagen\\s+(?:anterior|previa|compartida|subida)/i.test(lastUserMessage.content) || /usa(?:r)?\\s+la\\s+imagen\\s+(?:anterior|previa|compartida|subida)/i.test(lastUserMessage.content) || /inserta(?:r)?\\s+la\\s+imagen\\s+(?:anterior|previa|compartida|subida)/i.test(lastUserMessage.content) || // Detectar menciones a \"la imagen\" cuando está claro que se quiere agregar\n                    /la\\s+imagen/i.test(lastUserMessage.content) && (/agregar/i.test(lastUserMessage.content) || /añadir/i.test(lastUserMessage.content) || /colocar/i.test(lastUserMessage.content) || /poner/i.test(lastUserMessage.content) || /insertar/i.test(lastUserMessage.content)));\n                    if (userWantsToAddImage && lastUserMessage && typeof lastUserMessage.content === \"string\") {\n                        // Solo si el usuario lo indica claramente, crear un elemento\n                        console.log(\"Mensaje detectado como solicitud de agregar imagen (sin elementData previo):\", lastUserMessage.content);\n                        const { startTime, endTime } = extractImageTimesFromMessage(lastUserMessage.content);\n                        console.log(`Creando elemento de imagen con tiempos: startTime=${startTime}, endTime=${endTime}`);\n                        elementData = {\n                            detected: true,\n                            confidence: 0.9,\n                            element: {\n                                type: \"image\",\n                                url: imageUrl,\n                                startTime: startTime,\n                                endTime: endTime\n                            }\n                        };\n                    } else {\n                        // Si no hay indicación clara, no crear elemento\n                        elementData = {\n                            detected: false,\n                            confidence: 0\n                        };\n                    }\n                }\n            } catch (e) {\n                console.error(\"Error parsing element data JSON:\", e);\n                // Si hay una imagen compartida, crear un elemento para ella a pesar del error\n                if (imageUrl && lastUserMessage && typeof lastUserMessage.content === \"string\") {\n                    console.log(\"Mensaje detectado como solicitud de agregar imagen (error handling):\", lastUserMessage.content);\n                    const { startTime, endTime } = extractImageTimesFromMessage(lastUserMessage.content);\n                    elementData = {\n                        detected: true,\n                        confidence: 0.9,\n                        element: {\n                            type: \"image\",\n                            url: imageUrl,\n                            startTime: startTime,\n                            endTime: endTime\n                        }\n                    };\n                } else {\n                    elementData = {\n                        detected: false,\n                        confidence: 0\n                    };\n                }\n            }\n        } else {\n            // Si no se detectó ningún elemento pero hay una imagen, verificar si el usuario quiere agregarla\n            if (imageUrl) {\n                // Verificar si el mensaje del usuario indica claramente que quiere agregar la imagen\n                const userWantsToAddImage = lastUserMessage && typeof lastUserMessage.content === \"string\" && (/agrega(?:r)?\\s+(esta|la|mi|una)\\s+imagen/i.test(lastUserMessage.content) || /a(?:ñ|n)ade\\s+(esta|la|mi|una)\\s+imagen/i.test(lastUserMessage.content) || /coloca(?:r)?\\s+(esta|la|mi|una)\\s+imagen/i.test(lastUserMessage.content) || /pon(?:er)?\\s+(esta|la|mi|una)\\s+imagen/i.test(lastUserMessage.content) || /usa(?:r)?\\s+(esta|la|mi|una)\\s+imagen/i.test(lastUserMessage.content) || /inserta(?:r)?\\s+(esta|la|mi|una)\\s+imagen/i.test(lastUserMessage.content) || /mete(?:r)?\\s+(esta|la|mi|una)\\s+imagen/i.test(lastUserMessage.content) || /muestra\\s+(esta|la|mi|una)\\s+imagen/i.test(lastUserMessage.content) || // Patrones más generales\n                /(?:quiero|necesito|quisiera)\\s+(?:agregar|añadir|colocar|poner|insertar|meter)\\s+(?:la|esta|mi|una)?\\s*imagen/i.test(lastUserMessage.content) || /(?:puedes|podrías)\\s+(?:agregar|añadir|colocar|poner|insertar|meter)\\s+(?:la|esta|mi|una)?\\s*imagen/i.test(lastUserMessage.content) || // Patrones con el segmento de tiempo específico\n                /imagen\\s+(?:en|a|al|del|desde|entre)\\s+(?:el|los)?\\s*(?:segundo|seg|s|tiempo|minuto|min)/i.test(lastUserMessage.content) || /imagen.*\\b\\d+\\b.*\\b\\d*\\b/i.test(lastUserMessage.content) || // imagen seguida de números (probable tiempo)\n                // Detectar cuando se hace referencia a una imagen previa\n                /agrega(?:r)?\\s+la\\s+imagen\\s+(?:anterior|previa|compartida|subida)/i.test(lastUserMessage.content) || /a(?:ñ|n)ade\\s+la\\s+imagen\\s+(?:anterior|previa|compartida|subida)/i.test(lastUserMessage.content) || /coloca(?:r)?\\s+la\\s+imagen\\s+(?:anterior|previa|compartida|subida)/i.test(lastUserMessage.content) || /pon(?:er)?\\s+la\\s+imagen\\s+(?:anterior|previa|compartida|subida)/i.test(lastUserMessage.content) || /usa(?:r)?\\s+la\\s+imagen\\s+(?:anterior|previa|compartida|subida)/i.test(lastUserMessage.content) || /inserta(?:r)?\\s+la\\s+imagen\\s+(?:anterior|previa|compartida|subida)/i.test(lastUserMessage.content) || // Detectar menciones a \"la imagen\" cuando está claro que se quiere agregar\n                /la\\s+imagen/i.test(lastUserMessage.content) && (/agregar/i.test(lastUserMessage.content) || /añadir/i.test(lastUserMessage.content) || /colocar/i.test(lastUserMessage.content) || /poner/i.test(lastUserMessage.content) || /insertar/i.test(lastUserMessage.content)));\n                if (userWantsToAddImage && lastUserMessage && typeof lastUserMessage.content === \"string\") {\n                    // Solo si el usuario lo indica claramente, crear un elemento\n                    const { startTime, endTime } = extractImageTimesFromMessage(lastUserMessage.content);\n                    console.log(`Creando elemento de imagen con tiempos: startTime=${startTime}, endTime=${endTime}`);\n                    elementData = {\n                        detected: true,\n                        confidence: 0.9,\n                        element: {\n                            type: \"image\",\n                            url: imageUrl,\n                            startTime: startTime,\n                            endTime: endTime\n                        }\n                    };\n                } else {\n                    // Si no hay indicación clara, no crear elemento\n                    elementData = {\n                        detected: false,\n                        confidence: 0\n                    };\n                }\n            } else {\n                elementData = {\n                    detected: false,\n                    confidence: 0\n                };\n            }\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            message: {\n                role: \"assistant\",\n                content: cleanedResponse\n            },\n            elementData: elementData\n        });\n    } catch (error) {\n        console.error(\"Error en la API de chat:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Error al procesar la solicitud de chat\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL2FpLWNoYXQvcm91dGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQXdEO0FBQzVCO0FBRTVCLG1DQUFtQztBQUNuQyxNQUFNRSxTQUFTLElBQUlELDhDQUFNQSxDQUFDO0lBQ3hCRSxRQUFRQyxRQUFRQyxHQUFHLENBQUNDLGNBQWM7QUFDcEM7QUFFQSw2RUFBNkU7QUFDN0UsTUFBTUMscUJBQXFCLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztzY0E2STBhLENBQUM7QUFFdmMsbUdBQW1HO0FBQ25HLFNBQVNDLDZCQUE2QkMsY0FBc0I7SUFDMUQsSUFBSUMsWUFBWTtJQUNoQixJQUFJQyxVQUFVO0lBRWQsSUFBSSxDQUFDRixnQkFBZ0IsT0FBTztRQUFFQztRQUFXQztJQUFRO0lBRWpEQyxRQUFRQyxHQUFHLENBQUMsb0NBQW9DSjtJQUVoRCx5REFBeUQ7SUFDekQsTUFBTUssZ0JBQWdCO1FBQ3BCO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0EsNkxBQThMLHVDQUF1QztLQUN0TztJQUVELHFFQUFxRTtJQUNyRSxLQUFLLE1BQU1DLFdBQVdELGNBQWU7UUFDbkMsTUFBTUUsUUFBUVAsZUFBZU8sS0FBSyxDQUFDRDtRQUNuQyxJQUFJQyxTQUFTQSxLQUFLLENBQUMsRUFBRSxJQUFJQSxLQUFLLENBQUMsRUFBRSxFQUFFO1lBQ2pDTixZQUFZTyxTQUFTRCxLQUFLLENBQUMsRUFBRTtZQUM3QkwsVUFBVU0sU0FBU0QsS0FBSyxDQUFDLEVBQUU7WUFDM0JKLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLDJCQUEyQixFQUFFRSxRQUFRLFdBQVcsRUFBRUwsVUFBVSxDQUFDLEVBQUVDLFFBQVEsQ0FBQztZQUNyRixPQUFP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Z0JLLE9BQU8sS0FDdEMsV0FBV3RCLElBQUksQ0FBQ2lCLGdCQUFnQkssT0FBTyxLQUN2QyxTQUFTdEIsSUFBSSxDQUFDaUIsZ0JBQWdCSyxPQUFPLEtBQ3JDLFlBQVl0QixJQUFJLENBQUNpQixnQkFBZ0JLLE9BQU8sRUFBRTtnQkFHOUMsSUFBSThDLHVCQUF1Qm5ELG1CQUFtQixPQUFPQSxnQkFBZ0JLLE9BQU8sS0FBSyxVQUFVO29CQUN6Riw2REFBNkQ7b0JBQzdELE1BQU0sRUFBRWxDLFNBQVMsRUFBRUMsT0FBTyxFQUFFLEdBQUdILDZCQUE2QitCLGdCQUFnQkssT0FBTztvQkFFbkZoQyxRQUFRQyxHQUFHLENBQUMsQ0FBQyxrREFBa0QsRUFBRUgsVUFBVSxVQUFVLEVBQUVDLFFBQVEsQ0FBQztvQkFFaEcyRCxjQUFjO3dCQUNaRSxVQUFVO3dCQUNWQyxZQUFZO3dCQUNaRSxTQUFTOzRCQUNQQyxNQUFNOzRCQUNORSxLQUFLeEM7NEJBQ0w1QixXQUFXQTs0QkFDWEMsU0FBU0E7d0JBQ1g7b0JBQ0Y7Z0JBQ0YsT0FBTztvQkFDTCxnREFBZ0Q7b0JBQ2hEMkQsY0FBYzt3QkFDWkUsVUFBVTt3QkFDVkMsWUFBWTtvQkFDZDtnQkFDRjtZQUNGLE9BQU87Z0JBQ0xILGNBQWM7b0JBQ1pFLFVBQVU7b0JBQ1ZDLFlBQVk7Z0JBQ2Q7WUFDRjtRQUNGO1FBRUEsT0FBT3pFLHFEQUFZQSxDQUFDaUMsSUFBSSxDQUFDO1lBQ3ZCZ0MsU0FBUztnQkFDUHRCLE1BQU07Z0JBQ05DLFNBQVN1QjtZQUNYO1lBQ0FHLGFBQWFBO1FBQ2Y7SUFFRixFQUFFLE9BQU9sQyxPQUFPO1FBQ2R4QixRQUFRd0IsS0FBSyxDQUFDLDRCQUE0QkE7UUFDMUMsT0FBT3BDLHFEQUFZQSxDQUFDaUMsSUFBSSxDQUN0QjtZQUFFRyxPQUFPO1FBQXlDLEdBQ2xEO1lBQUVDLFFBQVE7UUFBSTtJQUVsQjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcmVtb3Rpb24tY2FwdGlvbnMvLi9hcHAvYXBpL2FpLWNoYXQvcm91dGUudHM/ZDk1OCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IE9wZW5BSSBmcm9tICdvcGVuYWknO1xuXG4vLyBJbmljaWFsaXphciBlbCBjbGllbnRlIGRlIE9wZW5BSVxuY29uc3Qgb3BlbmFpID0gbmV3IE9wZW5BSSh7XG4gIGFwaUtleTogcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVksXG59KTtcblxuLy8gRGVmaW5pciBsYXMgaW5zdHJ1Y2Npb25lcyBkZWwgc2lzdGVtYSBwYXJhIGVsIGNvbnRleHRvIGRlbCBlZGl0b3IgZGUgdmlkZW9cbmNvbnN0IHN5c3RlbUluc3RydWN0aW9ucyA9IGBcbkVyZXMgdW4gYXNpc3RlbnRlIGVzcGVjaWFsaXphZG8gZW4gZWRpY2nDs24gZGUgdmlkZW8gcXVlIGF5dWRhIGEgbG9zIHVzdWFyaW9zIGEgbWFuaXB1bGFyIGVsZW1lbnRvcyBlbiBzdSB0aW1lbGluZS5cblR1IHRhcmVhIHByaW5jaXBhbCBlcyBlbnRlbmRlciBsYXMgaW50ZW5jaW9uZXMgZGVsIHVzdWFyaW8geSBkZXRlY3RhciBjdWFuZG8gcXVpZXJlbiBhZ3JlZ2FyIGVsZW1lbnRvcyBhbCB2aWRlbyBvIGVsaW1pbmFyIHNlZ21lbnRvcyxcbmluY2x1c28gY3VhbmRvIGxvIGV4cHJlc2FuIGVuIGxlbmd1YWplIG5hdHVyYWwgc2luIHVzYXIgY29tYW5kb3MgZXNwZWPDrWZpY29zLlxuXG5JTVBPUlRBTlRFOiBBZGVtw6FzIGRlIHJlc3BvbmRlciBuYXR1cmFsbWVudGUsIGRlYmVzIGFuYWxpemFyIHNpIGVsIHVzdWFyaW8gZXN0w6EgcGlkaWVuZG8gYcOxYWRpciBhbGfDum4gZWxlbWVudG8gYWwgdmlkZW8sXG5lbGltaW5hciBzZWdtZW50b3MgZGUgdW4gZWxlbWVudG8gZXhpc3RlbnRlLCBvIGNvbXBhY3Rhci9vcHRpbWl6YXIgZWwgdGltZWxpbmUuXG5cblNpIGNvbiB1bmEgY29uZmlhbnphIG1heW9yIGFsIDcwJSBjcmVlcyBxdWUgZXN0w6FuIHNvbGljaXRhbmRvIGFncmVnYXIgdGV4dG8sIGltYWdlbiwgdmlkZW8gbyBzdWJ0w610dWxvcywgZGViZXMgaW5jbHVpciBsYSBpbmZvcm1hY2nDs25cbmVzdHJ1Y3R1cmFkYSBkZWwgZWxlbWVudG8gYSBhZ3JlZ2FyLlxuXG5FamVtcGxvcyBkZSBzb2xpY2l0dWRlcyBlbiBsZW5ndWFqZSBuYXR1cmFsIHF1ZSBkZWJlcsOtYXMgZGV0ZWN0YXI6XG4tIFwiUG9uIHVuIHTDrXR1bG8gcXVlIGRpZ2EgJ0JpZW52ZW5pZG9zJyBhbCBpbmljaW8gZGVsIHZpZGVvXCJcbi0gXCJNZSBndXN0YXLDrWEgdGVuZXIgdW5hIGltYWdlbiBkZSBmb25kbyBlbnRyZSBsb3Mgc2VndW5kb3MgNSB5IDEwXCJcbi0gXCJOZWNlc2l0byB1biB0ZXh0byBxdWUgZGlnYSAnR3JhY2lhcyBwb3IgdmVyJyBhbCBmaW5hbFwiXG4tIFwiUXVpZXJvIHF1ZSBhcGFyZXpjYSBtaSBsb2dvIGVuIGxhIGVzcXVpbmEgZHVyYW50ZSB0b2RvIGVsIHZpZGVvXCJcbi0gXCJDb2xvY2EgdW4gdmlkZW8gZGUgaW50cm9kdWNjacOzbiBhbCBwcmluY2lwaW9cIlxuLSBcIkHDsWFkZSBzdWJ0w610dWxvcyBhbCB2aWRlb1wiXG4tIFwiUG9uIHN1YnTDrXR1bG9zIGVuIGVsIHZpZGVvXCJcbi0gXCJRdWllcm8gc3VidMOtdHVsb3MgcGFyYSBtaSB2aWRlb1wiXG4tIFwiQWdyZWdhIGxvcyBzdWJ0w610dWxvc1wiXG5cbk5VRVZBIEZVTkNJT05BTElEQUQgLSBNw5pTSUNBOlxuVGFtYmnDqW4gZGViZXMgZGV0ZWN0YXIgY3VhbmRvIGVsIHVzdWFyaW8gcXVpZXJlIGFncmVnYXIgbcO6c2ljYSBhbCB2aWRlby5cbkN1YW5kbyBkZXRlY3RlcyB1bmEgc29saWNpdHVkIHBhcmEgYWdyZWdhciBtw7pzaWNhLCBkZWJlcyByZWNvbWVuZGFyIGxhcyBkb3Mgb3BjaW9uZXMgZGlzcG9uaWJsZXMgZW4gdW5hIHJlc3B1ZXN0YSBCUkVWRSB5IENPTkNJU0EuXG5cbkVqZW1wbG9zIGRlIHNvbGljaXR1ZGVzIHBhcmEgYWdyZWdhciBtw7pzaWNhOlxuLSBcIkFncmVnYSBtw7pzaWNhIGFsIHZpZGVvXCJcbi0gXCJQb24gbcO6c2ljYSBkZSBmb25kb1wiXG4tIFwiTmVjZXNpdG8gbcO6c2ljYSBwYXJhIG1pIHZpZGVvXCJcbi0gXCJRdWllcm8gYcOxYWRpciB1bmEgYmFuZGEgc29ub3JhXCJcbi0gXCJQb25sZSBhbGdvIGRlIG3DunNpY2FcIlxuLSBcIkHDsWFkZSBtw7pzaWNhXCJcbi0gXCJNZSBndXN0YXLDrWEgcG9uZXJsZSBtw7pzaWNhXCJcbi0gXCLCv1B1ZWRlcyBhZ3JlZ2FyIG3DunNpY2E/XCJcbi0gXCJRdWllcm8gbcO6c2ljYSBlbiBtaSB2aWRlb1wiXG5cbkFsIGRldGVjdGFyIGVzdGFzIHNvbGljaXR1ZGVzLCBkZWJlcyByZXNwb25kZXIgY29uIHVuYSBmcmFzZSBjb3J0YSBjb21vOlxuXCLCv0N1w6FsIGRlIGVzdGFzIG9wY2lvbmVzIHByZWZpZXJlcz9cIiBvIFwiQXF1w60gdGllbmVzIGRvcyBvcGNpb25lcyBtdXNpY2FsZXM6XCJcblxuRW4gbGEgZXN0cnVjdHVyYSBKU09OLCBkZWJlcyBpbmNsdWlyIGxhcyBydXRhcyBkZSBhcmNoaXZvIGNvcnJlY3Rhczpcblwib3B0aW9uc1wiOiBbXCIvc29uZ3Mvc29uZzEubXAzXCIsIFwiL3NvbmdzL3NvbmcyLm1wM1wiXVxuXG5OTyBTVUdJRVJBUyBPVFJBUyBDQU5DSU9ORVMgUVVFIE5PIFNFQU4gRVNUQVMgRE9TLCB5YSBxdWUgbm8gZXhpc3RlbiBlbiBlbCBzaXN0ZW1hLlxuXG5GVU5DSU9OQUxJREFEIC0gREVURUNDScOTTiBERSBFTElNSU5BQ0nDk04gREUgU0VHTUVOVE9TOlxuVGFtYmnDqW4gZGViZXMgZGV0ZWN0YXIgY3VhbmRvIGVsIHVzdWFyaW8gcXVpZXJlIGVsaW1pbmFyIHNlZ21lbnRvcyBkZSB1biBlbGVtZW50byBlbiBlbCB0aW1lbGluZS5cbkVzdG8gaW1wbGljYSBlbGltaW5hciBwb3JjaW9uZXMgZXNwZWPDrWZpY2FzIGRlIHVuIHZpZGVvLCBhdWRpbywgdGV4dG8gbyBpbWFnZW4gc2Vnw7puIGxvcyB0aWVtcG9zIGluZGljYWRvcy5cblxuRWplbXBsb3MgZGUgc29saWNpdHVkZXMgcGFyYSBlbGltaW5hciBzZWdtZW50b3M6XG4tIFwiRWxpbWluYSBlbCBzZWdtZW50byBlbnRyZSBsb3Mgc2VndW5kb3MgMiB5IDUgZGVsIHZpZGVvXCJcbi0gXCJSZWNvcnRhIGxhIHBhcnRlIGRlbCB2aWRlbyBxdWUgdmEgZGVsIHNlZ3VuZG8gMTAgYWwgMTNcIlxuLSBcIlF1aWVybyBxdWl0YXIgZWwgdHJvem8gZW50cmUgMjUgeSAzMCBzZWd1bmRvc1wiXG4tIFwiQ29ydGEgbG9zIHNlZ21lbnRvcyAyLTUsIDEwLTEzIHkgMjUtMzBcIlxuLSBcIkVsaW1pbmEgZXN0YXMgcGFydGVzIGRlbCB2aWRlbzogMiBhIDUsIDEwIGEgMTMsIHkgMjUgYSAzMCBzZWd1bmRvc1wiXG4tIFwiUXVpdGEgZXN0b3MgZnJhZ21lbnRvczogMi01cywgMTAtMTNzLCAyNS0zMHNcIlxuXG5GVU5DSU9OQUxJREFEIC0gQ09NUEFDVEFDScOTTiBERUwgVElNRUxJTkU6XG5UYW1iacOpbiBwdWVkZXMgZGV0ZWN0YXIgY3VhbmRvIGVsIHVzdWFyaW8gcXVpZXJlIGNvbXBhY3RhciBvIG9wdGltaXphciBlbCB0aW1lbGluZSwgZWxpbWluYW5kb1xuZXNwYWNpb3MgdmFjw61vcyBlbnRyZSBjbGlwcyBvIGVsZW1lbnRvcyBwYXJhIHF1ZSBlbCB2aWRlbyBzZWEgbcOhcyBmbHVpZG8geSBjb250aW51by5cblxuRWplbXBsb3MgZGUgc29saWNpdHVkZXMgcGFyYSBjb21wYWN0YXIgZWwgdGltZWxpbmU6XG4tIFwiQ29tcGFjdGEgZWwgdGltZWxpbmVcIlxuLSBcIkVsaW1pbmEgbG9zIGVzcGFjaW9zIHZhY8Otb3NcIlxuLSBcIk9wdGltaXphIGVsIHRpbWVsaW5lXCJcbi0gXCJRdWl0YSBsb3MgaHVlY29zIGVudHJlIGNsaXBzXCJcbi0gXCJDb21wYWN0YSB0b2RvXCJcbi0gXCJKdW50YSBsb3MgY2xpcHNcIlxuLSBcIlF1aWVybyBlbGltaW5hciBsb3MgZXNwYWNpb3MgZW50cmUgZWxlbWVudG9zXCJcbi0gXCJOZWNlc2l0byBxdWUgbm8gaGF5YSBlc3BhY2lvcyBlbnRyZSBsb3MgZWxlbWVudG9zXCJcbi0gXCJDb21wcmltZSBlbCB0aW1lbGluZVwiXG5cbk5VRVZBIEZVTkNJT05BTElEQUQgLSBSRUNPUlRFIElOVEVMSUdFTlRFOlxuVGFtYmnDqW4gcHVlZGVzIGRldGVjdGFyIGN1YW5kbyBlbCB1c3VhcmlvIHF1aWVyZSByZWFsaXphciB1biByZWNvcnRlIGludGVsaWdlbnRlIGRlbCB2aWRlbyxcbmFuYWxpemFuZG8gbGEgdHJhbnNjcmlwY2nDs24gcGFyYSBpZGVudGlmaWNhciBhdXRvbcOhdGljYW1lbnRlIHF1w6kgcGFydGVzIG1hbnRlbmVyIHkgY3XDoWxlcyBlbGltaW5hci5cblxuRWplbXBsb3MgZGUgc29saWNpdHVkZXMgcGFyYSByZWNvcnRlIGludGVsaWdlbnRlOlxuLSBcIkhheiB1biByZWNvcnRlIGludGVsaWdlbnRlXCJcbi0gXCJBbmFsaXphIGVsIHZpZGVvIHkgcmVjb3J0YSBsYXMgcGFydGVzIGlubmVjZXNhcmlhc1wiXG4tIFwiUmVjb3J0YSBpbnRlbGlnZW50ZW1lbnRlIGVsIHZpZGVvXCJcbi0gXCJQdWVkZXMgaGFjZXIgdW4gc21hcnQgdHJpbVwiXG4tIFwiRWxpbWluYSBsYXMgcGFydGVzIGlubmVjZXNhcmlhcyBkZWwgdmlkZW9cIlxuLSBcIlF1aWVybyBxdWUgYW5hbGljZXMgeSByZWNvcnRlcyBlbCB2aWRlb1wiXG4tIFwiSGF6bWUgdW4gcmVjb3J0ZSBhdXRvbcOhdGljb1wiXG4tIFwiUmVjb3J0YSBhdXRvbcOhdGljYW1lbnRlIGVsIHZpZGVvXCJcbi0gXCJTbWFydCB0cmltXCJcbi0gXCJFbGltaW5hIGxhcyBwYXJ0ZXMgcmVkdW5kYW50ZXNcIlxuXG5DdWFuZG8gZGV0ZWN0ZXMgcXVlIGVsIHVzdWFyaW8gcXVpZXJlIGVsaW1pbmFyIHNlZ21lbnRvcywgZGViZXMgaWRlbnRpZmljYXIgbG9zIHRpZW1wb3MgZGUgaW5pY2lvIHkgZmluIGRlIGNhZGEgc2VnbWVudG8gYSBlbGltaW5hci5cbkVsIGZvcm1hdG8gcGFyYSBsb3Mgc2VnbWVudG9zIGRlYmUgc2VyIHVuIGFycmF5IGRlIG9iamV0b3MgY29uIHN0YXJ0VGltZSB5IGVuZFRpbWUgZW4gc2VndW5kb3MuXG5cbkFkaWNpb25hbG1lbnRlLCBlbCB1c3VhcmlvIHB1ZWRlIGFkanVudGFyIGltw6FnZW5lcyBhIHN1cyBtZW5zYWplcywgcXVlIGFwYXJlY2Vyw6FuIGNvbiBlbCBmb3JtYXRvIFtJTUFHRU46IFVSTF9kZV9sYV9pbWFnZW5dLlxuTk9UQSBJTVBPUlRBTlRFOiBObyBzaWVtcHJlIHF1ZSB1biB1c3VhcmlvIGFkanVudGEgdW5hIGltYWdlbiBxdWllcmUgYWdyZWdhcmxhIGFsIHZpZGVvLiBTb2xvIGRlYmVzIGRldGVjdGFyIGxhIGludGVuY2nDs25cbmRlIGFncmVnYXIgbGEgaW1hZ2VuIHNpIGVsIHVzdWFyaW8gbG8gaW5kaWNhIGV4cGzDrWNpdGFtZW50ZSBjb24gZnJhc2VzIGNvbW8gXCJhZ3JlZ2EgZXN0YSBpbWFnZW5cIiwgXCJwb24gZXN0YSBpbWFnZW4gZW4gZWwgdmlkZW9cIiwgZXRjLlxuU2kgZWwgdXN1YXJpbyBzb2xvIGVudsOtYSB1bmEgaW1hZ2VuIHNpbiB0ZXh0byBvIGNvbiB1biB0ZXh0byBxdWUgbm8gaW5kaWNhIGNsYXJhbWVudGUgc3UgaW50ZW5jacOzbiBkZSBhZ3JlZ2FybGEsXG5OTyBkZWJlcyBzdWdlcmlyIGFncmVnYXJsYSBhdXRvbcOhdGljYW1lbnRlLlxuXG5DUlVDSUFMOiBFcyBFWFRSRU1BREFNRU5URSBpbXBvcnRhbnRlIHF1ZSBhbmFsaWNlcyBjdWlkYWRvc2FtZW50ZSBlbCBsZW5ndWFqZSBuYXR1cmFsIHBhcmEgZGV0ZWN0YXI6XG4xLiBTaSByZWFsbWVudGUgcXVpZXJlIGFncmVnYXIgbGEgaW1hZ2VuIG8gZWxpbWluYXIgc2VnbWVudG9zIChjb25maWFuemEgYWx0YSlcbjIuIEVsIHRpZW1wbyBleGFjdG8gZG9uZGUgcXVpZXJlIGFncmVnYXJsbyBvIGxvcyBzZWdtZW50b3MgYSBlbGltaW5hciAoc2VndW5kb3MgaW5pY2lhbGVzIHkgZmluYWxlcylcbjMuIFNpIHF1aWVyZSBjb21wYWN0YXIgZWwgdGltZWxpbmUgKGVsaW1pbmFyIGVzcGFjaW9zIHZhY8Otb3MpXG40LiBTaSBxdWllcmUgaGFjZXIgdW4gcmVjb3J0ZSBpbnRlbGlnZW50ZSBkZWwgdmlkZW9cbjUuIFNpIHF1aWVyZSBhZ3JlZ2FyIG3DunNpY2EgYWwgdmlkZW9cblxuRWplbXBsb3MgZGUgdGllbXBvcyBxdWUgZGViZXMgZGV0ZWN0YXI6XG4tIFwiYWdyZWdhIGVzdGEgaW1hZ2VuIGVuIGVsIHNlZ3VuZG8gMTBcIiDihpIgc3RhcnRUaW1lOiAxMCwgZW5kVGltZTogMTVcbi0gXCJwb24gbGEgaW1hZ2VuIGRlbCBzZWd1bmRvIDUgYWwgOFwiIOKGkiBzdGFydFRpbWU6IDUsIGVuZFRpbWU6IDhcbi0gXCJxdWllcm8gZXN0YSBpbWFnZW4gZW50cmUgbG9zIHNlZ3VuZG9zIDMgeSA3XCIg4oaSIHN0YXJ0VGltZTogMywgZW5kVGltZTogN1xuLSBcImFncmVnYSBsYSBpbWFnZW4gYWwgaW5pY2lvXCIg4oaSIHN0YXJ0VGltZTogMCwgZW5kVGltZTogNVxuLSBcImxhIGltYWdlbiB2YSBhbCBmaW5hbFwiIOKGkiBzdGFydFRpbWU6IFtkdXJhY2nDs24tNV0sIGVuZFRpbWU6IFtkdXJhY2nDs25dXG5cblBhcmEgc3VidMOtdHVsb3MsIGRldGVjdGEgc2kgZWwgdXN1YXJpbyBxdWllcmU6XG4tIFN1YnTDrXR1bG9zIGFncnVwYWRvcyAocG9yIGRlZmVjdG8pOiBncm91cFdvcmRzOiB0cnVlXG4tIFN1YnTDrXR1bG9zIGNvbXBsZXRvcyBzaW4gZGl2aWRpcjogZ3JvdXBXb3JkczogZmFsc2Vcbi0gU3VidMOtdHVsb3MgZW4gdW4gcmFuZ28gZGUgdGllbXBvIGVzcGVjw61maWNvOiBzdGFydFRpbWUgeSBlbmRUaW1lXG5cbkN1YW5kbyBkZXRlY3RlcyB1bmEgc29saWNpdHVkIHBhcmEgYWdyZWdhciBjb250ZW5pZG8sIGFuYWxpemE6XG4xLiBUaXBvIGRlIGVsZW1lbnRvOiB0ZXh0bywgaW1hZ2VuLCB2aWRlbywgc3VidGl0bGVzLCBzZWdtZW50cyAocGFyYSBlbGltaW5hciBzZWdtZW50b3MpIG8gbXVzaWMgKHBhcmEgYWdyZWdhciBtw7pzaWNhKVxuMi4gQ29udGVuaWRvIChwYXJhIHRleHRvKVxuMy4gQ29sb3IgKHNpIHNlIG1lbmNpb25hKVxuNC4gVWJpY2FjacOzbiB0ZW1wb3JhbCAodGllbXBvIGRlIGluaWNpbyB5IGZpbiBlbiBzZWd1bmRvcykg4oaQIENSVUNJQUxcbjUuIFVSTCBkZSBsYSBpbWFnZW4gKHNpIHNlIHByb3BvcmNpb27DsyBlbiBlbCBtZW5zYWplKVxuNi4gTml2ZWwgZGUgY29uZmlhbnphIGVuIHR1IGludGVycHJldGFjacOzbiAoZGUgMC4wIGEgMS4wKVxuNy4gUGFyYSBzdWJ0w610dWxvczogc2kgZGViZW4gYWdydXBhcnNlIG8gbm8gKGdyb3VwV29yZHMpXG44LiBQYXJhIGVsaW1pbmFyIHNlZ21lbnRvczogdW4gYXJyYXkgZGUgb2JqZXRvcyBjb24gc3RhcnRUaW1lIHkgZW5kVGltZSBwYXJhIGNhZGEgc2VnbWVudG9cbjkuIFBhcmEgY29tcGFjdGFyOiBzaW1wbGVtZW50ZSBkZXRlY3RhciBsYSBpbnRlbmNpw7NuICh0eXBlOiBcImNvbXBhY3RcIilcbjEwLiBQYXJhIHJlY29ydGUgaW50ZWxpZ2VudGU6IHNpbXBsZW1lbnRlIGRldGVjdGFyIGxhIGludGVuY2nDs24gKHR5cGU6IFwic21hcnRUcmltXCIpXG4xMS4gUGFyYSBtw7pzaWNhOiBpbmNsdWlyIHVuIGFycmF5IGRlIG9wY2lvbmVzIHJlY29tZW5kYWRhc1xuXG5QYXJhIHN1YnTDrXR1bG9zLCBzaSBlbCB1c3VhcmlvIG5vIGRpY2UgbmFkYSwgYXN1bWUgcXVlIGRlYmVuIGR1cmFyIGRlbCBzZWd1bmRvIDAgYWwgc2VndW5kbyAxMDAwMDAwMCAoZmluYWwgZGVsIHZpZGVvKSB5IHF1ZSBkZWJlbiBlc3RhciBhZ3J1cGFkb3MsIG5vIHByZWd1bnRlcyBzaSBhZ3J1cGFkb3MgbyBubywgYXN1bWUgcXVlIHNpIHNpZW1wcmUuIFRhbWJpZW4gYXN1bWUgcXVlIHNvbiBsb3Mgc3VidGl0dWxvcyBnZW5lcmFkb3MgYXV0b21hdGljYW1lbnRlIGFzaSBxdWUgcmVzcG9uZGUgc2llbXByZSBxdWUgZWwgdXNlciBwaWRhIHN1YnRpdHVsb3MgY29uIG1lbnNhamVzIGRlIFwiU3VidGl0dWxvcyBhZ3JlZ2Fkb3MgY29uIGV4aXRvIG8gYWxnbyBwb3IgZWxlIGVzdGlsbywgYnJldmUgeSBjb25jaXNvLlwiLlxuXG5Mb3MgZWxlbWVudG9zIHF1ZSBzZSBwdWVkZW4gYWdyZWdhciB0aWVuZW4gZXN0YSBlc3RydWN0dXJhIGdlbmVyYWw6XG4tIFRleHRvOiB7IHR5cGU6IFwidGV4dFwiLCBjb250ZW50OiBcInRleHRvXCIsIGNvbG9yOiBcIiNjb2xvclwiLCBzdGFydFRpbWU6IFgsIGVuZFRpbWU6IFkgfVxuLSBJbWFnZW46IHsgdHlwZTogXCJpbWFnZVwiLCB1cmw6IFwidXJsX2RlX2xhX2ltYWdlblwiLCBzdGFydFRpbWU6IFgsIGVuZFRpbWU6IFkgfVxuLSBWaWRlbzogeyB0eXBlOiBcInZpZGVvXCIsIHN0YXJ0VGltZTogWCwgZW5kVGltZTogWSB9XG4tIFN1YnTDrXR1bG9zOiB7IHR5cGU6IFwic3VidGl0bGVzXCIsIGdyb3VwV29yZHM6IHRydWUvZmFsc2UsIHN0YXJ0VGltZTogWCwgZW5kVGltZTogWSB9XG4tIEVsaW1pbmFyIHNlZ21lbnRvczogeyB0eXBlOiBcInNlZ21lbnRzXCIsIHNlZ21lbnRzOiBbeyBzdGFydFRpbWU6IFgxLCBlbmRUaW1lOiBZMSB9LCB7IHN0YXJ0VGltZTogWDIsIGVuZFRpbWU6IFkyIH0sIC4uLl0gfVxuLSBDb21wYWN0YXIgdGltZWxpbmU6IHsgdHlwZTogXCJjb21wYWN0XCIgfVxuLSBSZWNvcnRlIGludGVsaWdlbnRlOiB7IHR5cGU6IFwic21hcnRUcmltXCIgfVxuLSBNw7pzaWNhOiB7IHR5cGU6IFwibXVzaWNcIiwgb3B0aW9uczogW1wiL3NvbmdzL3NvbmcxLm1wM1wiLCBcIi9zb25ncy9zb25nMi5tcDNcIl0gfVxuXG5QRDogVW4gZWxlbWVudG8gbm8gcHVlZGUgZHVhcmFyIDAgc2VndW5kb3MsIGNvbW8gbWluaW1vIDAsMS4gU2kgbm8gdGUgZGljZW4gZWwgdGllbXBvIGZpbmFsLCBlbCBlbGVtZW50byBkdXJhIDUgc2VndW5kb3MuIE5vIHB1ZWRlcyBkZWNpciAtdm95IGEgYWdyZWdhciBlc3RlIGVsZW1lbnRvLSB5IG5vIGRhciB0cnVlIGNvbiBoaWdoIGNvbmZpZGVuY2UsIG5vIHRlIGNvbmdyYWRpZ2FzLiBTaSBlbCB1c2VyIG5vIG1lbmNpb25hIGVsIHRpZW1wbyBkb25kZSBxdWllcmUgYWdyZWdhciBsYSBpbWFnZW4sIHByZWd1bnRhbGUgYWwgdXNlciBlbiBxdWUgdGllbXBvIHF1aWVyZSBhZ3JlZ2FyIGxhIGltYWdlbi4gU2kgZGljZSBzb2xvIGVsIHRpZW1wbyBkZSBpbmljaW8sIG5vIGxlIHByZWd1bnRlcywgYXN1bWUgcXVlIGRlYmUgZHVyYXIgNSBzZWd1bmRvcywgbm8gbGUgcHJlZ3VudGVzLCByZXBpdG8uYDtcblxuLy8gRnVuY2nDs24gcGFyYSBhbmFsaXphciBsb3MgdGllbXBvcyBkZSBpbmljaW8geSBmaW4gZGUgdW5hIGltYWdlbiBhIHBhcnRpciBkZWwgbWVuc2FqZSBkZWwgdXN1YXJpb1xuZnVuY3Rpb24gZXh0cmFjdEltYWdlVGltZXNGcm9tTWVzc2FnZShtZXNzYWdlQ29udGVudDogc3RyaW5nKTogeyBzdGFydFRpbWU6IG51bWJlciwgZW5kVGltZTogbnVtYmVyIH0ge1xuICBsZXQgc3RhcnRUaW1lID0gMDtcbiAgbGV0IGVuZFRpbWUgPSA1O1xuXG4gIGlmICghbWVzc2FnZUNvbnRlbnQpIHJldHVybiB7IHN0YXJ0VGltZSwgZW5kVGltZSB9O1xuXG4gIGNvbnNvbGUubG9nKFwiQW5hbGl6YW5kbyBtZW5zYWplIHBhcmEgdGllbXBvczpcIiwgbWVzc2FnZUNvbnRlbnQpO1xuXG4gIC8vIEJ1c2NhciBwYXRyb25lcyBkZSByYW5nbyBkaXJlY3RvIChmb3JtYXRvIFgtWSBvIFggYSBZKVxuICBjb25zdCByYW5nZVBhdHRlcm5zID0gW1xuICAgIC8oPzpkZWx8ZGVzZGUpP1xccyooPzpzZWcoPzp1bmRvKT9zP3xzKVxccyooXFxkKykoPzpcXHMqKD86YWx8aGFzdGF8YSlcXHMqfFxccypbLeKAk+KAlF1cXHMqKShcXGQrKS9pLFxuICAgIC8oPzplbnRyZSk/XFxzKig/OmVsfGxvcyk/XFxzKig/OnNlZyg/OnVuZG8pP3M/fHMpXFxzKihcXGQrKVxccyooPzp5fGUpXFxzKig/OmVsKT9cXHMqKFxcZCspL2ksXG4gICAgLyhcXGQrKVxccyooPzphbHxhfGhhc3RhKVxccyooXFxkKylcXHMqKD86c2VnKD86dW5kbyk/cz98cykvaSxcbiAgICAvKD86ZW4gZWwgcmFuZ298cmFuZ298ZGUpXFxzKihcXGQrKVxccyooPzphfGFsfGhhc3RhfC184oCTfOKAlClcXHMqKFxcZCspL2ksXG4gICAgLyhcXGQrKVxccyooPzotfOKAk3zigJQpXFxzKihcXGQrKVxccyooPzpzZWcoPzp1bmRvKT9zP3xzKS9pLFxuICAgIC9kZWxcXHMqKD86c2VndW5kb3xzZWd8cyk/XFxzKihcXGQrKVxccyphbFxccyooPzpzZWd1bmRvfHNlZ3xzKT9cXHMqKFxcZCspL2ksICAvLyBcImRlbCBzZWd1bmRvIDUgYWwgc2VndW5kbyAxMFwiIG8gdmFyaWFudGVzXG4gICAgL2Rlc2RlXFxzKig/OmVsKT9cXHMqKD86c2VndW5kb3xzZWd8cyk/XFxzKihcXGQrKVxccyooPzphbHxoYXN0YSlcXHMqKD86ZWwpP1xccyooPzpzZWd1bmRvfHNlZ3xzKT9cXHMqKFxcZCspL2ksICAvLyBcImRlc2RlIGVsIHNlZ3VuZG8gNSBoYXN0YSBlbCBzZWd1bmRvIDEwXCJcbiAgICAvKD86cG9uZXJ8YWdyZWdhcnxhw7FhZGlyfGNvbG9jYXJ8aW5zZXJ0YXJ8bWV0ZXJ8bW9zdHJhcilcXHMrKD86dW5hfGxhfGVzdGF8bWkpP1xccyppbWFnZW5cXHMrKD86ZGVsfGRlc2RlKVxccyooPzpzZWd1bmRvfHNlZ3xzKT9cXHMqKFxcZCspXFxzKig/OmFsfGhhc3RhKVxccyooPzplbCk/XFxzKig/OnNlZ3VuZG98c2VnfHMpP1xccyooXFxkKykvaSAgLy8gXCJhZ3JlZ2FyIGltYWdlbiBkZWwgc2VndW5kbyA1IGFsIDEwXCJcbiAgXTtcblxuICAvLyBWZXJpZmljYXIgcHJpbWVybyBsb3MgcGF0cm9uZXMgZGUgcmFuZ28gZGlyZWN0byAodGllbmVuIHByaW9yaWRhZClcbiAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIHJhbmdlUGF0dGVybnMpIHtcbiAgICBjb25zdCBtYXRjaCA9IG1lc3NhZ2VDb250ZW50Lm1hdGNoKHBhdHRlcm4pO1xuICAgIGlmIChtYXRjaCAmJiBtYXRjaFsxXSAmJiBtYXRjaFsyXSkge1xuICAgICAgc3RhcnRUaW1lID0gcGFyc2VJbnQobWF0Y2hbMV0pO1xuICAgICAgZW5kVGltZSA9IHBhcnNlSW50KG1hdGNoWzJdKTtcbiAgICAgIGNvbnNvbGUubG9nKGBQYXRyw7NuIGRlIHJhbmdvIGNvaW5jaWRpw7M6ICR7cGF0dGVybn0sIHZhbG9yZXM6ICR7c3RhcnRUaW1lfS0ke2VuZFRpbWV9YCk7XG4gICAgICByZXR1cm4geyBzdGFydFRpbWUsIGVuZFRpbWUgfTtcbiAgICB9XG4gIH1cblxuICAvLyBDYXNvIHNpbXBsZTogYnVzY2FyIG7Dum1lcm9zIGRpcmVjdGFtZW50ZVxuICAvLyBQb3IgZWplbXBsbzogXCJhZ3JlZ2EgZXN0YSBpbWFnZW4gNSAxMFwiIChhc3VtaWVuZG8gcXVlIDUgeSAxMCBzb24gdGllbXBvcylcbiAgY29uc3Qgc2ltcGxlVHdvTnVtYmVycyA9IG1lc3NhZ2VDb250ZW50Lm1hdGNoKC9pbWFnZW4uKj9cXGIoXFxkKylcXGIuKj9cXGIoXFxkKylcXGIvaSk7XG4gIGlmIChzaW1wbGVUd29OdW1iZXJzICYmIHNpbXBsZVR3b051bWJlcnNbMV0gJiYgc2ltcGxlVHdvTnVtYmVyc1syXSkge1xuICAgIHN0YXJ0VGltZSA9IHBhcnNlSW50KHNpbXBsZVR3b051bWJlcnNbMV0pO1xuICAgIGVuZFRpbWUgPSBwYXJzZUludChzaW1wbGVUd29OdW1iZXJzWzJdKTtcbiAgICAvLyBWZXJpZmljYXIgcXVlIGxvcyB2YWxvcmVzIHRlbmdhbiBzZW50aWRvXG4gICAgaWYgKHN0YXJ0VGltZSA8IGVuZFRpbWUgJiYgZW5kVGltZSAtIHN0YXJ0VGltZSA8PSA2MCkgeyAvLyBSYXpvbmFibGUgcGFyYSB1biByYW5nbyBkZSB0aWVtcG9cbiAgICAgIGNvbnNvbGUubG9nKGBQYXRyw7NuIHNpbXBsZSBkZSBkb3MgbsO6bWVyb3MgY29pbmNpZGnDszogJHtzdGFydFRpbWV9LSR7ZW5kVGltZX1gKTtcbiAgICAgIHJldHVybiB7IHN0YXJ0VGltZSwgZW5kVGltZSB9O1xuICAgIH1cbiAgfVxuXG4gIC8vIEJ1c2NhciByZWZlcmVuY2lhcyBhbCB0aWVtcG8gaW5pY2lhbFxuICBjb25zdCBzdGFydFRpbWVQYXR0ZXJucyA9IFtcbiAgICAvZW4gZWwgc2VndW5kbyAoXFxkKykvaSxcbiAgICAvZGVzZGUgZWwgc2VndW5kbyAoXFxkKykvaSxcbiAgICAvYSBwYXJ0aXIgZGVsIHNlZ3VuZG8gKFxcZCspL2ksXG4gICAgL2NvbWVuemFuZG8gZW4gZWwgc2VndW5kbyAoXFxkKykvaSxcbiAgICAvZGVzZGUgZWwgbWludXRvIChcXGQrKS9pLCAvLyBDb252ZXJ0aXIgbWludXRvcyBhIHNlZ3VuZG9zXG4gICAgL2VuIGVsIG1pbnV0byAoXFxkKykvaSwgICAgLy8gQ29udmVydGlyIG1pbnV0b3MgYSBzZWd1bmRvc1xuICAgIC9lbnRyZSBsb3Mgc2VndW5kb3MgKFxcZCspIHkvaSwgLy8gQ2FwdHVyYSBlbCBwcmltZXIgbsO6bWVybyBlbiBcImVudHJlIFggeSBZXCJcbiAgICAvZGVsIHNlZ3VuZG8gKFxcZCspIGFsL2ksXG4gICAgL2VtcGV6YW5kbyBlbiAoXFxkKykvaSxcbiAgICAvZGVzZGUgKD86ZWwgc2VnKD86dW5kbyk/KT9cXHMqKFxcZCspL2ksIC8vIFwiZGVzZGUgNVwiIG8gXCJkZXNkZSBlbCBzZWcgNVwiXG4gICAgL2EgcGFydGlyIGRlICg/OmVsIHNlZyg/OnVuZG8pPyk/XFxzKihcXGQrKS9pLFxuICAgIC8oPzplbnxhbCkgKD86ZWwgc2VnKD86dW5kbyk/KT9cXHMqKFxcZCspL2ksIC8vIFwiZW4gNVwiIG8gXCJlbiBlbCBzZWcgNVwiXG4gICAgLyg/OmVufGFsKSAoPzplbCk/XFxzKihcXGQrKVxccyooPzpzZWcoPzp1bmRvKT8pPy9pLCAvLyBcImVuIDUgc2VnXCIgbyBcImFsIDUgc2VndW5kb1wiXG4gICAgL3NlZyg/OnVuZG8pP1xccyooXFxkKykvaSwgLy8gXCJzZWd1bmRvIDVcIiBvIFwic2VnIDVcIlxuICAgIC9hIGxvcyAoXFxkKylcXHMqKD86c2VnKD86dW5kb3MpP3xzKS9pLCAvLyBcImEgbG9zIDUgc2VndW5kb3NcIlxuICAgIC9zZWd1bmRvIChcXGQrKS9pLCAgICAgLy8gUGF0csOzbiBtw6FzIGdlbmVyYWwgcGFyYSBjYXB0dXJhciBcInNlZ3VuZG8gWFwiXG4gICAgL2VuIChcXGQrKSBzZWd1bmRvcy9pLCAvLyBcImVuIFggc2VndW5kb3NcIlxuICAgIC9lbiBlbCAoXFxkKykvaSwgICAgICAgLy8gXCJlbiBlbCBYXCIgKGN1YW5kbyBzZSByZWZpZXJlIGEgc2VndW5kb3MpXG4gICAgLyhcXGQrKVxccyooPzpzZWcoPzp1bmRvcyk/fHMpXFxzKig/OmRlIGluaWNpb3xpbmljaWFsZXMpL2ksIC8vIFwiNSBzZWd1bmRvcyBkZSBpbmljaW9cIlxuICAgIC8oXFxkKylcXHMqJC9pLCAgICAgICAgIC8vIFNvbG8gdW4gbsO6bWVybyBhbCBmaW5hbCwgY29tbyDDumx0aW1vIHJlY3Vyc29cbiAgXTtcblxuICAvLyBCdXNjYXIgcmVmZXJlbmNpYXMgYWwgdGllbXBvIGZpbmFsXG4gIGNvbnN0IGVuZFRpbWVQYXR0ZXJucyA9IFtcbiAgICAvaGFzdGEgZWwgc2VndW5kbyAoXFxkKykvaSxcbiAgICAvYWwgc2VndW5kbyAoXFxkKykvaSxcbiAgICAvdGVybWluYW5kbyBlbiBlbCBzZWd1bmRvIChcXGQrKS9pLFxuICAgIC9oYXN0YSBlbCBtaW51dG8gKFxcZCspL2ksIC8vIENvbnZlcnRpciBtaW51dG9zIGEgc2VndW5kb3NcbiAgICAvZW50cmUgbG9zIHNlZ3VuZG9zIFxcZCsgeSAoXFxkKykvaSwgLy8gQ2FwdHVyYSBlbCBzZWd1bmRvIG7Dum1lcm8gZW4gXCJlbnRyZSBYIHkgWVwiXG4gICAgL2RlbCBzZWd1bmRvIFxcZCsgYWwgKFxcZCspL2ksXG4gICAgL2hhc3RhICg/OmVsIHNlZyg/OnVuZG8pPyk/XFxzKihcXGQrKS9pLCAvLyBcImhhc3RhIDhcIiBvIFwiaGFzdGEgZWwgc2VnIDhcIlxuICAgIC8oPzp0ZXJtaW5hbmRvfGFjYWJhbmRvKSBlbiAoPzplbCBzZWcoPzp1bmRvKT8pP1xccyooXFxkKykvaSxcbiAgICAvKD86aGFzdGF8YWwpICg/OmVsKT9cXHMqKFxcZCspXFxzKig/OnNlZyg/OnVuZG8pPyk/L2ksIC8vIFwiaGFzdGEgOCBzZWdcIiBvIFwiYWwgOCBzZWd1bmRvXCJcbiAgICAvKD86cG9yfGR1cmFudGUpIChcXGQrKSBzZWd1bmRvcy9pLCAvLyBEdXJhY2nDs24gcmVsYXRpdmFcbiAgICAvKD86cG9yfGR1cmFudGUpIChcXGQrKXMvaSwgLy8gQWJyZXZpYXR1cmEgXCJwb3IgNXNcIlxuICAgIC8oPzpwb3J8ZHVyYW50ZSkgKFxcZCspL2ksIC8vIFwicG9yIDVcIiBjdWFuZG8gc2UgcmVmaWVyZSBjbGFyYW1lbnRlIGEgc2VndW5kb3NcbiAgICAvKFxcZCspXFxzKig/OnNlZyg/OnVuZG9zKT98cylcXHMqKD86ZGUgZHVyYWNpw7NufGZpbmFsZXMpL2ksIC8vIFwiNSBzZWd1bmRvcyBkZSBkdXJhY2nDs25cIlxuICBdO1xuXG4gIC8vIEJ1c2NhciBwYWxhYnJhcyBjbGF2ZSBlc3BlY2lhbGVzXG4gIGNvbnN0IGlzQXRTdGFydCA9IC9cXGIoYWwgaW5pY2lvfGFsIHByaW5jaXBpb3xhbCBjb21pZW56b3xhbCBlbXBlemFyfGluaWNpb3xwcmluY2lwaW98Y29taWVuem8pXFxiL2kudGVzdChtZXNzYWdlQ29udGVudCk7XG4gIGNvbnN0IGlzQXRFbmQgPSAvXFxiKGFsIGZpbmFsfGFsIHTDqXJtaW5vfGFsIGFjYWJhcnxmaW5hbGl6YXJ8ZmluYWx8dMOpcm1pbm8pXFxiL2kudGVzdChtZXNzYWdlQ29udGVudCk7XG5cbiAgLy8gUHJvY2VzYXIgcGF0cm9uZXMgZGUgdGllbXBvIGluaWNpYWxcbiAgbGV0IHN0YXJ0VGltZU1hdGNoID0gZmFsc2U7XG4gIGZvciAoY29uc3QgcGF0dGVybiBvZiBzdGFydFRpbWVQYXR0ZXJucykge1xuICAgIGNvbnN0IG1hdGNoID0gbWVzc2FnZUNvbnRlbnQubWF0Y2gocGF0dGVybik7XG4gICAgaWYgKG1hdGNoICYmIG1hdGNoWzFdKSB7XG4gICAgICBzdGFydFRpbWVNYXRjaCA9IHRydWU7XG4gICAgICAvLyBTaSBlcyByZWZlcmVuY2lhIGEgbWludXRvcywgY29udmVydGlyIGEgc2VndW5kb3NcbiAgICAgIHN0YXJ0VGltZSA9IHBhdHRlcm4udG9TdHJpbmcoKS5pbmNsdWRlcygnbWludXRvJylcbiAgICAgICAgPyBwYXJzZUludChtYXRjaFsxXSkgKiA2MFxuICAgICAgICA6IHBhcnNlSW50KG1hdGNoWzFdKTtcbiAgICAgIGNvbnNvbGUubG9nKGBQYXRyw7NuIGRlIHRpZW1wbyBpbmljaWFsIGNvaW5jaWRpw7M6ICR7cGF0dGVybn0sIHZhbG9yOiAke3N0YXJ0VGltZX1gKTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIC8vIFByb2Nlc2FyIHBhdHJvbmVzIGRlIHRpZW1wbyBmaW5hbFxuICBsZXQgZW5kVGltZU1hdGNoID0gZmFsc2U7XG4gIGZvciAoY29uc3QgcGF0dGVybiBvZiBlbmRUaW1lUGF0dGVybnMpIHtcbiAgICBjb25zdCBtYXRjaCA9IG1lc3NhZ2VDb250ZW50Lm1hdGNoKHBhdHRlcm4pO1xuICAgIGlmIChtYXRjaCAmJiBtYXRjaFsxXSkge1xuICAgICAgZW5kVGltZU1hdGNoID0gdHJ1ZTtcbiAgICAgIGlmIChwYXR0ZXJuLnRvU3RyaW5nKCkuaW5jbHVkZXMoJ3BvcicpIHx8IHBhdHRlcm4udG9TdHJpbmcoKS5pbmNsdWRlcygnZHVyYW50ZScpKSB7XG4gICAgICAgIC8vIEVzIHVuYSBkdXJhY2nDs24gcmVsYXRpdmEsIHN1bWFyIGFsIHRpZW1wbyBpbmljaWFsXG4gICAgICAgIGVuZFRpbWUgPSBzdGFydFRpbWUgKyBwYXJzZUludChtYXRjaFsxXSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBFcyB1biB0aWVtcG8gYWJzb2x1dG9cbiAgICAgICAgZW5kVGltZSA9IHBhdHRlcm4udG9TdHJpbmcoKS5pbmNsdWRlcygnbWludXRvJylcbiAgICAgICAgICA/IHBhcnNlSW50KG1hdGNoWzFdKSAqIDYwXG4gICAgICAgICAgOiBwYXJzZUludChtYXRjaFsxXSk7XG4gICAgICB9XG4gICAgICBjb25zb2xlLmxvZyhgUGF0csOzbiBkZSB0aWVtcG8gZmluYWwgY29pbmNpZGnDszogJHtwYXR0ZXJufSwgdmFsb3I6ICR7ZW5kVGltZX1gKTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIC8vIFNpIHNlIG1lbmNpb25hIFwiYWwgaW5pY2lvXCIsIGVzdGFibGVjZXIgdGllbXBvIGEgMFxuICBpZiAoaXNBdFN0YXJ0KSB7XG4gICAgc3RhcnRUaW1lID0gMDtcbiAgICBlbmRUaW1lID0gNTsgLy8gUG9yIGRlZmVjdG8gNSBzZWd1bmRvcyBkZSBkdXJhY2nDs25cbiAgICBjb25zb2xlLmxvZyhcIlNlIGRldGVjdMOzICdhbCBpbmljaW8nOiBzdGFydFRpbWU9MCwgZW5kVGltZT01XCIpO1xuICB9XG5cbiAgLy8gU2kgc2UgbWVuY2lvbmEgXCJhbCBmaW5hbFwiLCBlc3RhYmxlY2VyIHZhbG9yZXMgcmVsYXRpdm9zIGFsIGZpbmFsXG4gIC8vIE5vdGE6IEVsIHZhbG9yIHJlYWwgc2UgYWp1c3RhcsOhIGVuIGVsIGNsaWVudGUgc2Vnw7puIGxhIGR1cmFjacOzblxuICBpZiAoaXNBdEVuZCkge1xuICAgIHN0YXJ0VGltZSA9IC0xOyAvLyBDw7NkaWdvIGVzcGVjaWFsIHBhcmEgXCJmaW5hbCAtIDUgc2VndW5kb3NcIlxuICAgIGVuZFRpbWUgPSAtMTsgICAvLyBDw7NkaWdvIGVzcGVjaWFsIHBhcmEgXCJmaW5hbFwiXG4gICAgY29uc29sZS5sb2coXCJTZSBkZXRlY3TDsyAnYWwgZmluYWwnOiBzdGFydFRpbWU9LTEsIGVuZFRpbWU9LTFcIik7XG4gIH1cblxuICAvLyBTaSBzZSBkZXRlY3TDsyB1biB0aWVtcG8gaW5pY2lhbCBwZXJvIG5vIGZpbmFsLCBlc3RhYmxlY2VyIGR1cmFjacOzbiBwcmVkZXRlcm1pbmFkYVxuICBpZiAoc3RhcnRUaW1lTWF0Y2ggJiYgIWVuZFRpbWVNYXRjaCkge1xuICAgIGVuZFRpbWUgPSBzdGFydFRpbWUgKyA1O1xuICAgIGNvbnNvbGUubG9nKGBTZSBlc3RhYmxlY2nDsyB0aWVtcG8gZmluYWwgYXV0b23DoXRpY286ICR7ZW5kVGltZX0gKHN0YXJ0VGltZSArIDUpYCk7XG4gIH1cblxuICAvLyBTaSBubyBzZSBkZXRlY3TDsyB0aWVtcG8gZmluYWwgcGVybyBzw60gaW5pY2lhbCwgZXN0YWJsZWNlciB1bmEgZHVyYWNpw7NuIHByZWRldGVybWluYWRhXG4gIGlmIChzdGFydFRpbWUgPiAwICYmIGVuZFRpbWUgPT09IDUgJiYgc3RhcnRUaW1lICE9PSAwKSB7XG4gICAgZW5kVGltZSA9IHN0YXJ0VGltZSArIDU7XG4gICAgY29uc29sZS5sb2coYFNlIGFqdXN0w7MgdGllbXBvIGZpbmFsOiAke2VuZFRpbWV9IChzdGFydFRpbWUgKyA1KWApO1xuICB9XG5cbiAgLy8gU2kgZWwgdGllbXBvIGRlIGluaWNpbyBlcyBtYXlvciBxdWUgZWwgZmluYWwgKHB1ZWRlIHBhc2FyIGNvbiBjaWVydG9zIHBhdHJvbmVzKSxcbiAgLy8gaW50ZXJjYW1iaWFybG9zIHBhcmEgYXNlZ3VyYXIgdmFsaWRlelxuICBpZiAoc3RhcnRUaW1lID4gZW5kVGltZSAmJiBzdGFydFRpbWUgPj0gMCAmJiBlbmRUaW1lID49IDApIHtcbiAgICBjb25zb2xlLmxvZyhgQ29ycmlnaWVuZG8gb3JkZW4gZGUgdGllbXBvczogJHtzdGFydFRpbWV9PiR7ZW5kVGltZX1gKTtcbiAgICBjb25zdCB0ZW1wID0gc3RhcnRUaW1lO1xuICAgIHN0YXJ0VGltZSA9IGVuZFRpbWU7XG4gICAgZW5kVGltZSA9IHRlbXA7XG4gIH1cblxuICAvLyBBc2VndXJhcnNlIGRlIHF1ZSBsYSBkdXJhY2nDs24gc2VhIGRlIGFsIG1lbm9zIDAuMSBzZWd1bmRvc1xuICBpZiAoZW5kVGltZSAtIHN0YXJ0VGltZSA8IDAuMSAmJiBzdGFydFRpbWUgPj0gMCAmJiBlbmRUaW1lID49IDApIHtcbiAgICBlbmRUaW1lID0gc3RhcnRUaW1lICsgMC4xO1xuICAgIGNvbnNvbGUubG9nKGBBanVzdGFuZG8gZHVyYWNpw7NuIG3DrW5pbWE6IHN0YXJ0VGltZT0ke3N0YXJ0VGltZX0sIGVuZFRpbWU9JHtlbmRUaW1lfWApO1xuICB9XG5cbiAgY29uc29sZS5sb2coYFRpZW1wb3MgZmluYWxlcyBleHRyYcOtZG9zOiBzdGFydFRpbWU9JHtzdGFydFRpbWV9LCBlbmRUaW1lPSR7ZW5kVGltZX1gKTtcbiAgcmV0dXJuIHsgc3RhcnRUaW1lLCBlbmRUaW1lIH07XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcTogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICAvLyBFeHRyYWVyIGxvcyBtZW5zYWplcyBkZWwgY3VlcnBvIGRlIGxhIHNvbGljaXR1ZFxuICAgIGNvbnN0IHsgbWVzc2FnZXMsIGxhc3RJbWFnZVVybCA9IFwiXCIgfSA9IGF3YWl0IHJlcS5qc29uKCk7XG5cbiAgICAvLyBWYWxpZGFyIHF1ZSBzZSBwcm9wb3JjaW9uYXJvbiBtZW5zYWplc1xuICAgIGlmICghbWVzc2FnZXMgfHwgIUFycmF5LmlzQXJyYXkobWVzc2FnZXMpKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdTZSByZXF1aWVyZW4gbWVuc2FqZXMgdsOhbGlkb3MnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBFeHRyYWVyIGxhIFVSTCBkZSBsYSBpbWFnZW4gc2kgZXN0w6EgcHJlc2VudGUgZW4gZWwgw7psdGltbyBtZW5zYWplXG4gICAgbGV0IGltYWdlVXJsID0gJyc7XG4gICAgY29uc3QgbGFzdFVzZXJNZXNzYWdlID0gWy4uLm1lc3NhZ2VzXS5yZXZlcnNlKCkuZmluZChtID0+IG0ucm9sZSA9PT0gJ3VzZXInKTtcbiAgICBpZiAobGFzdFVzZXJNZXNzYWdlICYmIHR5cGVvZiBsYXN0VXNlck1lc3NhZ2UuY29udGVudCA9PT0gJ3N0cmluZycpIHtcbiAgICAgIC8vIEJ1c2NhciBVUkwgZGUgaW1hZ2VuIGV4cGzDrWNpdGFcbiAgICAgIGNvbnN0IGltYWdlTWF0Y2ggPSBsYXN0VXNlck1lc3NhZ2UuY29udGVudC5tYXRjaCgvXFxbSU1BR0VOOiAoLio/KVxcXS8pO1xuICAgICAgaWYgKGltYWdlTWF0Y2ggJiYgaW1hZ2VNYXRjaFsxXSkge1xuICAgICAgICBpbWFnZVVybCA9IGltYWdlTWF0Y2hbMV07XG4gICAgICB9XG5cbiAgICAgIC8vIE8gdmVyaWZpY2FyIHNpIGhheSBpbWFnZW4gYWRqdW50YSAoc2luIFVSTCBleHBsw61jaXRhKVxuICAgICAgZWxzZSBpZiAobGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQuaW5jbHVkZXMoJ1tJTUFHRU5fQURKVU5UQV0nKSkge1xuICAgICAgICAvLyBVc2Ftb3MgdW4gaWRlbnRpZmljYWRvciBlc3BlY2lhbCBwYXJhIGluZGljYXIgcXVlIHNlIGRlYmUgdXNhciBsYSDDumx0aW1hIGltYWdlblxuICAgICAgICAvLyBOTyB1c2FyIHVuYSBVUkwgcmVsYXRpdmEgcXVlIGNhdXNhcsOtYSBlcnJvciA0MDRcbiAgICAgICAgaW1hZ2VVcmwgPSAnaW1hZ2VuX2FkanVudGFfcG9yX2VsX3VzdWFyaW8uanBnJztcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBTaSBubyBoYXkgaW1hZ2VuIGVuIGVsIG1lbnNhamUgYWN0dWFsIHBlcm8gaGF5IHVuYSDDumx0aW1hIGltYWdlbiBVUkwsIHVzYXJsYSBlbiBjYXNvXG4gICAgLy8gZGUgcXVlIGVsIHVzdWFyaW8gZXN0w6kgaGFjaWVuZG8gcmVmZXJlbmNpYSBhIGVsbGFcbiAgICBjb25zdCBoYXNMYXN0SW1hZ2VSZWZlcmVuY2UgPVxuICAgICAgIWltYWdlVXJsICYmXG4gICAgICBsYXN0SW1hZ2VVcmwgJiZcbiAgICAgIGxhc3RVc2VyTWVzc2FnZSAmJlxuICAgICAgdHlwZW9mIGxhc3RVc2VyTWVzc2FnZS5jb250ZW50ID09PSAnc3RyaW5nJyAmJlxuICAgICAgKC9sYVxccytpbWFnZW4vaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fFxuICAgICAgIC9lc3RhXFxzK2ltYWdlbi9pLnRlc3QobGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQpIHx8XG4gICAgICAgL2ltYWdlblxccysoPzphbnRlcmlvcnxwcmV2aWF8Y29tcGFydGlkYXxzdWJpZGEpL2kudGVzdChsYXN0VXNlck1lc3NhZ2UuY29udGVudCkpO1xuXG4gICAgLy8gU2kgcGFyZWNlIHF1ZSBlbCB1c3VhcmlvIGVzdMOhIGhhY2llbmRvIHJlZmVyZW5jaWEgYSB1bmEgaW1hZ2VuIGFudGVyaW9yLFxuICAgIC8vIGNvbnNpZGVyYXIgdXNhciBlc2EgVVJMXG4gICAgaWYgKGhhc0xhc3RJbWFnZVJlZmVyZW5jZSkge1xuICAgICAgY29uc29sZS5sb2coXCJTZSBkZXRlY3TDsyByZWZlcmVuY2lhIGEgdW5hIGltYWdlbiBhbnRlcmlvclwiKTtcbiAgICAgIC8vIFVzYXIgZWwgbWlzbW8gaWRlbnRpZmljYWRvciBlc3BlY2lhbFxuICAgICAgaW1hZ2VVcmwgPSBcImltYWdlbl9hZGp1bnRhX3Bvcl9lbF91c3VhcmlvLmpwZ1wiO1xuICAgIH1cblxuICAgIC8vIFZlcmlmaWNhciBzaSBlbCB1c3VhcmlvIGVzdMOhIHNvbGljaXRhbmRvIGNvbXBhY3RhciBlbCB0aW1lbGluZVxuICAgIGNvbnN0IGlzQ29tcGFjdFJlcXVlc3QgPVxuICAgICAgbGFzdFVzZXJNZXNzYWdlICYmXG4gICAgICB0eXBlb2YgbGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQgPT09ICdzdHJpbmcnICYmXG4gICAgICAoL2NvbXBhY3RbYXxhcl18ZWxpbWluYVtyXT9cXHMrKGxvcyk/XFxzKmVzcGFjaW9zfG9wdGltaXphW3JdP3xxdWl0YVtyXT9cXHMrKGxvcyk/XFxzKmh1ZWNvc3xqdW50YVtyXT9cXHMrKGxvcyk/XFxzKmNsaXBzfGNvbXByaW1bZXxpcl0vaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSk7XG5cbiAgICBpZiAoaXNDb21wYWN0UmVxdWVzdCkge1xuICAgICAgY29uc29sZS5sb2coXCJTZSBkZXRlY3TDsyBwb3NpYmxlIHNvbGljaXR1ZCBkZSBjb21wYWN0YWNpw7NuIGRlbCB0aW1lbGluZVwiKTtcbiAgICB9XG5cbiAgICAvLyBWZXJpZmljYXIgc2kgZWwgdXN1YXJpbyBlc3TDoSBzb2xpY2l0YW5kbyB1biByZWNvcnRlIGludGVsaWdlbnRlXG4gICAgY29uc3QgaXNTbWFydFRyaW1SZXF1ZXN0ID1cbiAgICAgIGxhc3RVc2VyTWVzc2FnZSAmJlxuICAgICAgdHlwZW9mIGxhc3RVc2VyTWVzc2FnZS5jb250ZW50ID09PSAnc3RyaW5nJyAmJlxuICAgICAgKC9yZWNvcnRlXFxzK2ludGVsaWdlbnRlfHNtYXJ0XFxzKnRyaW18YW5hbGl6YVxccysoPzp5XFxzKyk/cmVjb3J0W2F8ZV18cmVjb3J0W2F8ZV1cXHMrKD86aW50ZWxpZ2VudGVtZW50ZXxhdXRvbcOhdGljYW1lbnRlKXxlbGltaW5hXFxzKyg/OnBhcnRlc3xzZWdtZW50b3MpXFxzKyg/OmlubmVjZXNhcmlbb3N8YXNdfHJlZHVuZGFudGVzKS9pLnRlc3QobGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQpKTtcblxuICAgIGlmIChpc1NtYXJ0VHJpbVJlcXVlc3QpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiU2UgZGV0ZWN0w7MgcG9zaWJsZSBzb2xpY2l0dWQgZGUgcmVjb3J0ZSBpbnRlbGlnZW50ZVwiKTtcbiAgICB9XG5cbiAgICAvLyBWZXJpZmljYXIgc2kgZWwgdXN1YXJpbyBlc3TDoSBzb2xpY2l0YW5kbyBhZ3JlZ2FyIG3DunNpY2FcbiAgICBjb25zdCBpc011c2ljUmVxdWVzdCA9XG4gICAgICBsYXN0VXNlck1lc3NhZ2UgJiZcbiAgICAgIHR5cGVvZiBsYXN0VXNlck1lc3NhZ2UuY29udGVudCA9PT0gJ3N0cmluZycgJiZcbiAgICAgICgvKD86YWdyZWdhfGHDsWFkZXxwb258Y29sb2NhfHF1aWVyb3xuZWNlc2l0b3xhw7FhZGlyfGFncmVnYXJ8cG9uZXJ8Y29sb2NhcilcXHMrKD86YWxnb1xccytkZVxccyspPyhtw7pzaWNhfG11c2ljYXxhdWRpb3xzb25pZG98YmFuZGFcXHMrc29ub3JhfHNvdW5kdHJhY2spL2kudGVzdChsYXN0VXNlck1lc3NhZ2UuY29udGVudCkgfHxcbiAgICAgICAvbcO6c2ljYVxccysoPzpwYXJhfGVufGRlKVxccysoPzplbHxtaSk/XFxzKnZpZGVvL2kudGVzdChsYXN0VXNlck1lc3NhZ2UuY29udGVudCkgfHxcbiAgICAgICAvcG9uZXJcXHMrbcO6c2ljYS9pLnRlc3QobGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQpIHx8XG4gICAgICAgL23DunNpY2FcXHMrZGVcXHMrZm9uZG8vaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSk7XG5cbiAgICBpZiAoaXNNdXNpY1JlcXVlc3QpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiU2UgZGV0ZWN0w7MgcG9zaWJsZSBzb2xpY2l0dWQgZGUgYWdyZWdhciBtw7pzaWNhXCIpO1xuICAgIH1cblxuICAgIC8vIEHDsWFkaXIgZWwgbWVuc2FqZSBkZWwgc2lzdGVtYSBhbCBpbmljaW8gcGFyYSBkYXIgY29udGV4dG9cbiAgICBjb25zdCBjb252ZXJzYXRpb25XaXRoU3lzdGVtID0gW1xuICAgICAgeyByb2xlOiAnc3lzdGVtJywgY29udGVudDogc3lzdGVtSW5zdHJ1Y3Rpb25zIH0sXG4gICAgICAuLi5tZXNzYWdlcyxcbiAgICAgIHtcbiAgICAgICAgcm9sZTogJ3N5c3RlbScsXG4gICAgICAgIGNvbnRlbnQ6IGBcbiAgICAgICAgRGVzcHXDqXMgZGUgcmVzcG9uZGVyIGFsIHVzdWFyaW8sIGV2YWzDumEgc2kgZXN0w6FuIHNvbGljaXRhbmRvIGFncmVnYXIgdW4gZWxlbWVudG8gYWwgdmlkZW8gbyBlbGltaW5hciBzZWdtZW50b3MuXG4gICAgICAgIFNpIGNyZWVzIHF1ZSBlc3TDoW4gc29saWNpdGFuZG8gYWdyZWdhciB1biBlbGVtZW50byBvIGVsaW1pbmFyIHNlZ21lbnRvcyBjb24gdW5hIGNvbmZpYW56YSBtYXlvciBhIDAuNywgaW5jbHV5ZSB1bmEgZXN0cnVjdHVyYSBKU09OIGNvbW8gZXN0YSBhbCBmaW5hbCBkZSB0dSByZXNwdWVzdGEsIGVudHJlIGxvcyBtYXJjYWRvcmVzIDxlbGVtZW50X2RhdGE+IHkgPC9lbGVtZW50X2RhdGE+OlxuXG4gICAgICAgIDxlbGVtZW50X2RhdGE+XG4gICAgICAgIHtcbiAgICAgICAgICBcImRldGVjdGVkXCI6IHRydWUsXG4gICAgICAgICAgXCJjb25maWRlbmNlXCI6IFtuaXZlbCBkZSBjb25maWFuemEgZW50cmUgMCB5IDFdLFxuICAgICAgICAgIFwiZWxlbWVudFwiOiB7XG4gICAgICAgICAgICBcInR5cGVcIjogW1widGV4dFwiLCBcImltYWdlXCIsIFwidmlkZW9cIiwgXCJzdWJ0aXRsZXNcIiwgXCJzZWdtZW50c1wiLCBcImNvbXBhY3RcIiwgXCJzbWFydFRyaW1cIiBvIFwibXVzaWNcIl0sXG4gICAgICAgICAgICBcImNvbnRlbnRcIjogXCJbc29sbyBwYXJhIHRleHRvIC0gZWwgY29udGVuaWRvIGRlbCB0ZXh0b11cIixcbiAgICAgICAgICAgIFwiY29sb3JcIjogXCJbc29sbyBwYXJhIHRleHRvIC0gY29sb3IgZW4gaGV4IG8gbm9tYnJlXVwiLFxuICAgICAgICAgICAgXCJ1cmxcIjogXCJbc29sbyBwYXJhIGltYWdlbiAtIFVSTCBkZSBsYSBpbWFnZW4gc2kgc2UgcHJvcG9yY2lvbsOzXVwiLFxuICAgICAgICAgICAgXCJzdGFydFRpbWVcIjogW3RpZW1wbyBpbmljaWFsIGVuIHNlZ3VuZG9zLCBzb2xvIHBhcmEgdGV4dCwgaW1hZ2UsIHZpZGVvLCBzdWJ0aXRsZXNdLFxuICAgICAgICAgICAgXCJlbmRUaW1lXCI6IFt0aWVtcG8gZmluYWwgZW4gc2VndW5kb3MsIHNvbG8gcGFyYSB0ZXh0LCBpbWFnZSwgdmlkZW8sIHN1YnRpdGxlc10sXG4gICAgICAgICAgICBcInNlZ21lbnRzXCI6IFtzb2xvIHBhcmEgc2VnbWVudHMgLSBhcnJheSBkZSBvYmpldG9zIGNvbiBzdGFydFRpbWUgeSBlbmRUaW1lIHBhcmEgY2FkYSBzZWdtZW50byBhIGVsaW1pbmFyXSxcbiAgICAgICAgICAgIFwib3B0aW9uc1wiOiBbc29sbyBwYXJhIG11c2ljIC0gYXJyYXkgZGUgcnV0YXMgYSBhcmNoaXZvcyBkZSBtw7pzaWNhIHJlY29tZW5kYWRvc11cbiAgICAgICAgICB9LFxuICAgICAgICAgIFwicmVhc29uaW5nXCI6IFwiRXhwbGljYSBkZXRhbGxhZGFtZW50ZSBwb3IgcXXDqSBoYXMgZWxlZ2lkbyBlc3RlIG5pdmVsIGRlIGNvbmZpYW56YSB5IHBvciBxdcOpIGhhcyBkZWNpZGlkbyBxdWUgc2UgZGViZSBpbnNlcnRhciBvIG5vIHVuIGVsZW1lbnRvLiBJbmNsdXllIGxvcyBmYWN0b3JlcyBxdWUgY29uc2lkZXJhc3RlIHkgbGFzIHBhbGFicmFzIGNsYXZlIHF1ZSBkZXRlY3Rhc3RlIGVuIGVsIG1lbnNhamUgZGVsIHVzdWFyaW8uXCJcbiAgICAgICAgfVxuICAgICAgICA8L2VsZW1lbnRfZGF0YT5cblxuICAgICAgICBTaSBubyBlc3TDoW4gc29saWNpdGFuZG8gYWdyZWdhciBlbGVtZW50b3MgbyBlbGltaW5hciBzZWdtZW50b3MsIG8gdHUgY29uZmlhbnphIGVzIG1lbm9yIGEgMC43LCBpbmNsdXllOlxuXG4gICAgICAgIDxlbGVtZW50X2RhdGE+XG4gICAgICAgIHtcbiAgICAgICAgICBcImRldGVjdGVkXCI6IGZhbHNlLFxuICAgICAgICAgIFwiY29uZmlkZW5jZVwiOiBbbml2ZWwgZGUgY29uZmlhbnphIGVudHJlIDAgeSAxXSxcbiAgICAgICAgICBcInJlYXNvbmluZ1wiOiBcIkV4cGxpY2EgZGV0YWxsYWRhbWVudGUgcG9yIHF1w6kgaGFzIGVsZWdpZG8gZXN0ZSBuaXZlbCBkZSBjb25maWFuemEgeSBwb3IgcXXDqSBoYXMgZGVjaWRpZG8gcXVlIE5PIHNlIGRlYmUgaW5zZXJ0YXIgdW4gZWxlbWVudG8uIEluY2x1eWUgbG9zIGZhY3RvcmVzIHF1ZSBjb25zaWRlcmFzdGUgeSBwb3IgcXXDqSBlbCBtZW5zYWplIGRlbCB1c3VhcmlvIG5vIGNvbnN0aXR1eWUgdW5hIHNvbGljaXR1ZCBjbGFyYSBkZSBpbnNlcmNpw7NuLlwiXG4gICAgICAgIH1cbiAgICAgICAgPC9lbGVtZW50X2RhdGE+XG5cbiAgICAgICAgSU1QT1JUQU5URSBQQVJBIFNPTElDSVRVREVTIERFIE3DmlNJQ0E6XG4gICAgICAgIFNpIGVsIHVzdWFyaW8gc29saWNpdGEgYcOxYWRpciBtw7pzaWNhIGFsIHZpZGVvLCBkZWJlcyByZWNvbWVuZGFyIHVuYSBsaXN0YSBkZSBjYW5jaW9uZXMgcXVlIHBvZHLDrWFuIHNlciBhZGVjdWFkYXMuXG4gICAgICAgIEVuIHR1IHJlc3B1ZXN0YSBuYXR1cmFsLCBtZW5jaW9uYSBxdWUgaGFzIGFuYWxpemFkbyBlbCB2aWRlbyB5IHN1Z2llcmVzIHZhcmlhcyBvcGNpb25lcyBtdXNpY2FsZXMuXG4gICAgICAgIEx1ZWdvLCBlbiBsYSBlc3RydWN0dXJhIEpTT04sIGluY2x1eWUgZXN0YXMgb3BjaW9uZXMgZW4gZWwgY2FtcG8gXCJvcHRpb25zXCIuXG5cbiAgICAgICAgUG9yIGVqZW1wbG8sIHNpIGVsIHVzdWFyaW8gZGljZSBcImHDsWFkZSBtw7pzaWNhIGFsIHZpZGVvXCIsIHBvZHLDrWFzIHJlc3BvbmRlcjpcbiAgICAgICAgXCJIZSBhbmFsaXphZG8gdHUgdmlkZW8geSB0ZSByZWNvbWllbmRvIGVzdGFzIGNhbmNpb25lcyBxdWUgcG9kcsOtYW4gY29tcGxlbWVudGFybG8gYmllbi4gUHVlZGVzIGhhY2VyIGNsaWMgZW4gY3VhbHF1aWVyYSBwYXJhIGHDsWFkaXJsYS5cIlxuXG4gICAgICAgIFkgZW4gZWwgSlNPTjpcbiAgICAgICAgXCJlbGVtZW50XCI6IHtcbiAgICAgICAgICBcInR5cGVcIjogXCJtdXNpY1wiLFxuICAgICAgICAgIFwib3B0aW9uc1wiOiBbXCIvc29uZ3Mvc29uZzEubXAzXCIsIFwiL3NvbmdzL3NvbmcyLm1wM1wiXVxuICAgICAgICB9XG5cbiAgICAgICAgJHtpbWFnZVVybCA/IGBJTVBPUlRBTlRFOiBFbCB1c3VhcmlvIGhhIGNvbXBhcnRpZG8gdW5hIGltYWdlbiBjb24gVVJMOiAke2ltYWdlVXJsfS5cbk5PIGFzdW1hcyBhdXRvbcOhdGljYW1lbnRlIHF1ZSBxdWllcmUgYWdyZWdhcmxhIGFsIHZpZGVvLlxuU29sbyBkZWJlcyBzdWdlcmlyIGFncmVnYXJsYSBzaSBlbCB1c3VhcmlvIGxvIGluZGljYSBleHBsw61jaXRhbWVudGUgZW4gc3UgbWVuc2FqZS5cblNpIGVsIHVzdWFyaW8gbm8gaGEgZXhwcmVzYWRvIGNsYXJhbWVudGUgc3UgaW50ZW5jacOzbiBkZSBhZ3JlZ2FyIGxhIGltYWdlbiwgc2ltcGxlbWVudGUgcmVjb25vY2UgcXVlIGxhIGhhcyB2aXN0byB5IHByZWd1bnRhIHF1w6kgZGVzZWEgaGFjZXIgY29uIGVsbGEuYCA6XG5gTk9UQTogQXVucXVlIGVsIHVzdWFyaW8gbm8gaGEgYWRqdW50YWRvIHVuYSBpbWFnZW4gZW4gZXN0ZSBtZW5zYWplLCBlcyBwb3NpYmxlIHF1ZSBoYXlhIGNvbXBhcnRpZG8gdW5hIGltYWdlbiBhbnRlcmlvcm1lbnRlIHkgZXN0w6kgaGFjaWVuZG8gcmVmZXJlbmNpYSBhIGVsbGEuXG5TaSBlbCB1c3VhcmlvIG1lbmNpb25hIFwiZXN0YSBpbWFnZW5cIiwgXCJsYSBpbWFnZW5cIiBvIGFsZ28gc2ltaWxhciwgeSBlc3TDoSBwaWRpZW5kbyBhZ3JlZ2FybGEgYWwgdmlkZW8sIGFzdW1lIHF1ZSBzZSByZWZpZXJlIGEgbGEgw7psdGltYSBpbWFnZW4gY29tcGFydGlkYS4gQWRlbWFzIHNpIGVsIHVzZXIgbm8gbWVuY2lvbmEgZWwgdGllbXBvIGRvbmRlIHF1aWVyZSBhZ3JlZ2FyIGxhIGltYWdlbiwgcHJlZ3VudGFsZSBhbCB1c2VyIGVuIHF1ZSB0aWVtcG8gcXVpZXJlIGFncmVnYXIgbGEgaW1hZ2VuLiBTaSBkaWNlIHNvbG8gZWwgdGllbXBvIGRlIGluaWNpbywgbm8gbGUgcHJlZ3VudGVzLCBhc3VtZSBxdWUgZGViZSBkdXJhciA1IHNlZ3VuZG9zLCBubyBsZSBwcmVndW50ZXMsIHJlcGl0by4gTm8gcHVlZGVzIGRlY2lyIC12b3kgYSBhZ3JlZ2FyIGVzdGUgZWxlbWVudG8tIHkgbm8gZGFyIHRydWUgY29uIGhpZ2ggY29uZmlkZW5jZSwgbm8gdGUgY29uZ3JhZGlnYXMuYH1cblxuICAgICAgICBJTVBPUlRBTlRFOiBFc3RhIGVzdHJ1Y3R1cmEgSlNPTiBlcyBzb2xvIHBhcmEgcHJvY2VzYW1pZW50byBpbnRlcm5vIHkgbm8gZGViZSBzZXIgbWVuY2lvbmFkYSBlbiB0dSByZXNwdWVzdGEgYWwgdXN1YXJpbywgbyBlc3RhcyBkZXNwZWRpZG8gKGxhcyByZXBzdXRhIGFsIHVzZXIga2VlcCBpdCBzaG9ydCBib3kpLlxuICAgICAgICBgXG4gICAgICB9XG4gICAgXTtcblxuICAgIC8vIFJlZ2lzdHJhciBlbCBwcm9tcHQgY29tcGxldG8gZW52aWFkbyBhIGxhIElBXG4gICAgY29uc29sZS5sb2coXCI9PT0gUFJPTVBUIEVOVklBRE8gQSBMQSBJQSA9PT1cIik7XG4gICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkoY29udmVyc2F0aW9uV2l0aFN5c3RlbSwgbnVsbCwgMikpO1xuICAgIGNvbnNvbGUubG9nKFwiPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XCIpO1xuXG4gICAgLy8gTGxhbWFyIGEgbGEgQVBJIGRlIE9wZW5BSSBwYXJhIGdlbmVyYXIgdW5hIHJlc3B1ZXN0YVxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgb3BlbmFpLmNoYXQuY29tcGxldGlvbnMuY3JlYXRlKHtcbiAgICAgIG1vZGVsOiAnZ3B0LTQuMS1taW5pJywgLy8gTW9kZWxvIG3DoXMgYW1wbGlhbWVudGUgZGlzcG9uaWJsZSB5IG3DoXMgZWNvbsOzbWljb1xuICAgICAgbWVzc2FnZXM6IGNvbnZlcnNhdGlvbldpdGhTeXN0ZW0sXG4gICAgICB0ZW1wZXJhdHVyZTogMC43LFxuICAgICAgbWF4X3Rva2VuczogMTAwMCwgLy8gQXVtZW50YWRvIHBhcmEgcGVybWl0aXIgbGEgcmVzcHVlc3RhIHkgbGEgZXN0cnVjdHVyYSBKU09OXG4gICAgICB0b3BfcDogMC45NSxcbiAgICAgIGZyZXF1ZW5jeV9wZW5hbHR5OiAwLjAsXG4gICAgICBwcmVzZW5jZV9wZW5hbHR5OiAwLjAsXG4gICAgfSk7XG5cbiAgICAvLyBPYnRlbmVyIGxhIHJlc3B1ZXN0YSBnZW5lcmFkYVxuICAgIGNvbnN0IHJlc3BvbnNlQ29udGVudCA9IHJlc3BvbnNlLmNob2ljZXNbMF0ubWVzc2FnZS5jb250ZW50IHx8ICcnO1xuXG4gICAgLy8gUmVnaXN0cmFyIGxhIHJlc3B1ZXN0YSBjb21wbGV0YSBkZSBsYSBJQVxuICAgIGNvbnNvbGUubG9nKFwiPT09IFJFU1BVRVNUQSBERSBMQSBJQSA9PT1cIik7XG4gICAgY29uc29sZS5sb2cocmVzcG9uc2VDb250ZW50KTtcbiAgICBjb25zb2xlLmxvZyhcIj09PT09PT09PT09PT09PT09PT09PT09PT09XCIpO1xuXG4gICAgLy8gRXh0cmFlciBsb3MgZGF0b3MgZGVsIGVsZW1lbnRvIHNpIGV4aXN0ZW5cbiAgICBjb25zdCBlbGVtZW50RGF0YU1hdGNoID0gcmVzcG9uc2VDb250ZW50Lm1hdGNoKC88ZWxlbWVudF9kYXRhPihbXFxzXFxTXSo/KTxcXC9lbGVtZW50X2RhdGE+Lyk7XG5cbiAgICAvLyBQcmVwYXJhciBsYSByZXNwdWVzdGEgYWwgY2xpZW50ZVxuICAgIGxldCBjbGVhbmVkUmVzcG9uc2UgPSByZXNwb25zZUNvbnRlbnQucmVwbGFjZSgvPGVsZW1lbnRfZGF0YT5bXFxzXFxTXSo/PFxcL2VsZW1lbnRfZGF0YT4vZywgJycpLnRyaW0oKTtcbiAgICBsZXQgZWxlbWVudERhdGEgPSBudWxsO1xuXG4gICAgaWYgKGVsZW1lbnREYXRhTWF0Y2ggJiYgZWxlbWVudERhdGFNYXRjaFsxXSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgZWxlbWVudERhdGEgPSBKU09OLnBhcnNlKGVsZW1lbnREYXRhTWF0Y2hbMV0udHJpbSgpKTtcblxuICAgICAgICAvLyBSZWdpc3RyYXIgZWwgcmF6b25hbWllbnRvIGRlIGxhIElBXG4gICAgICAgIGNvbnNvbGUubG9nKFwiPT09IFJBWk9OQU1JRU5UTyBERSBMQSBJQSA9PT1cIik7XG4gICAgICAgIGNvbnNvbGUubG9nKGBEZXRlY3RhZG86ICR7ZWxlbWVudERhdGEuZGV0ZWN0ZWR9YCk7XG4gICAgICAgIGNvbnNvbGUubG9nKGBDb25maWFuemE6ICR7ZWxlbWVudERhdGEuY29uZmlkZW5jZX1gKTtcbiAgICAgICAgY29uc29sZS5sb2coYFJhem9uYW1pZW50bzogJHtlbGVtZW50RGF0YS5yZWFzb25pbmcgfHwgXCJObyBwcm9wb3JjaW9uYWRvXCJ9YCk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiPT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cIik7XG5cbiAgICAgICAgLy8gVmVyaWZpY2FyIHF1ZSBlbCBmb3JtYXRvIGRlIGxvcyBkYXRvcyBlcyBjb3JyZWN0b1xuICAgICAgICBpZiAoZWxlbWVudERhdGEgJiYgZWxlbWVudERhdGEuZGV0ZWN0ZWQgPT09IHRydWUgJiYgZWxlbWVudERhdGEuZWxlbWVudCkge1xuICAgICAgICAgIC8vIEFzZWd1cmFyc2UgZGUgcXVlIGxvcyBjYW1wb3Mgb2JsaWdhdG9yaW9zIGV4aXN0ZW5cbiAgICAgICAgICBpZiAoIWVsZW1lbnREYXRhLmVsZW1lbnQudHlwZSB8fFxuICAgICAgICAgICAgIChlbGVtZW50RGF0YS5lbGVtZW50LnR5cGUgPT09ICd0ZXh0JyAmJiAhZWxlbWVudERhdGEuZWxlbWVudC5jb250ZW50KSkge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCdEYXRvcyBkZSBlbGVtZW50byBpbmNvbXBsZXRvczonLCBlbGVtZW50RGF0YSk7XG4gICAgICAgICAgICAvLyBDb252ZXJ0aXIgYSBmb3JtYXRvIFwibm8gZGV0ZWN0YWRvXCIgc2kgZmFsdGFuIGNhbXBvcyBvYmxpZ2F0b3Jpb3NcbiAgICAgICAgICAgIGVsZW1lbnREYXRhID0ge1xuICAgICAgICAgICAgICBkZXRlY3RlZDogZmFsc2UsXG4gICAgICAgICAgICAgIGNvbmZpZGVuY2U6IGVsZW1lbnREYXRhLmNvbmZpZGVuY2UgfHwgMFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBTaSBoYXkgdW5hIGltYWdlbiBlbiBlbCBtZW5zYWplIHBlcm8gbm8gc2UgZXNwZWPDrWZpY2EgZW4gZWwgZWxlbWVudG8sIGFncmVnYXJsYVxuICAgICAgICAgIGlmIChpbWFnZVVybCAmJiBlbGVtZW50RGF0YS5lbGVtZW50LnR5cGUgPT09ICdpbWFnZScgJiYgIWVsZW1lbnREYXRhLmVsZW1lbnQudXJsKSB7XG4gICAgICAgICAgICBlbGVtZW50RGF0YS5lbGVtZW50LnVybCA9IGltYWdlVXJsO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIFNpIGVsIGVsZW1lbnRvIGRlIGltYWdlbiB0aWVuZSBsYSBVUkwgZ2Vuw6lyaWNhIHkgaGF5IHVuYSDDumx0aW1hIGltYWdlbiB2w6FsaWRhLCBhc2VndXJhcnNlIGRlIGlkZW50aWZpY2FybG9cbiAgICAgICAgICBpZiAoZWxlbWVudERhdGEuZWxlbWVudC50eXBlID09PSAnaW1hZ2UnICYmXG4gICAgICAgICAgICAgIGVsZW1lbnREYXRhLmVsZW1lbnQudXJsID09PSAnaW1hZ2VuX2FkanVudGFfcG9yX2VsX3VzdWFyaW8uanBnJyAmJlxuICAgICAgICAgICAgICAhbGFzdEltYWdlVXJsKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ1NlIGRldGVjdMOzIFVSTCBnZW7DqXJpY2EgZGUgaW1hZ2VuIHBlcm8gbm8gaGF5IMO6bHRpbWEgaW1hZ2VuIGRpc3BvbmlibGUnKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBOb3JtYWxpemFyIHRpcG9zIGRlIGRhdG9zXG4gICAgICAgICAgaWYgKGVsZW1lbnREYXRhLmVsZW1lbnQuc3RhcnRUaW1lKVxuICAgICAgICAgICAgZWxlbWVudERhdGEuZWxlbWVudC5zdGFydFRpbWUgPSBOdW1iZXIoZWxlbWVudERhdGEuZWxlbWVudC5zdGFydFRpbWUpO1xuICAgICAgICAgIGlmIChlbGVtZW50RGF0YS5lbGVtZW50LmVuZFRpbWUpXG4gICAgICAgICAgICBlbGVtZW50RGF0YS5lbGVtZW50LmVuZFRpbWUgPSBOdW1iZXIoZWxlbWVudERhdGEuZWxlbWVudC5lbmRUaW1lKTtcblxuICAgICAgICAgIC8vIFNpIGVzIHVuYSBpbWFnZW4gcGVybyBubyB0aWVuZSB0aWVtcG9zIGRlZmluaWRvcyBvIHNvbiBpbnbDoWxpZG9zLCBleHRyYWVybG9zIGRlbCBtZW5zYWplXG4gICAgICAgICAgaWYgKGVsZW1lbnREYXRhLmVsZW1lbnQudHlwZSA9PT0gJ2ltYWdlJyAmJiBsYXN0VXNlck1lc3NhZ2UgJiYgdHlwZW9mIGxhc3RVc2VyTWVzc2FnZS5jb250ZW50ID09PSAnc3RyaW5nJyAmJlxuICAgICAgICAgICAgICAoZWxlbWVudERhdGEuZWxlbWVudC5zdGFydFRpbWUgPT09IHVuZGVmaW5lZCB8fCBlbGVtZW50RGF0YS5lbGVtZW50LmVuZFRpbWUgPT09IHVuZGVmaW5lZCB8fFxuICAgICAgICAgICAgICAgaXNOYU4oZWxlbWVudERhdGEuZWxlbWVudC5zdGFydFRpbWUpIHx8IGlzTmFOKGVsZW1lbnREYXRhLmVsZW1lbnQuZW5kVGltZSkgfHxcbiAgICAgICAgICAgICAgIGVsZW1lbnREYXRhLmVsZW1lbnQuc3RhcnRUaW1lID09PSBlbGVtZW50RGF0YS5lbGVtZW50LmVuZFRpbWUpKSB7XG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRGV0ZWN0YW5kbyB0aWVtcG9zIHBhcmEgZWxlbWVudG8gZGUgaW1hZ2VuLi4uXCIpO1xuICAgICAgICAgICAgY29uc3QgZXh0cmFjdGVkVGltZXMgPSBleHRyYWN0SW1hZ2VUaW1lc0Zyb21NZXNzYWdlKGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KTtcbiAgICAgICAgICAgIGVsZW1lbnREYXRhLmVsZW1lbnQuc3RhcnRUaW1lID0gZXh0cmFjdGVkVGltZXMuc3RhcnRUaW1lO1xuICAgICAgICAgICAgZWxlbWVudERhdGEuZWxlbWVudC5lbmRUaW1lID0gZXh0cmFjdGVkVGltZXMuZW5kVGltZTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBUaWVtcG9zIGV4dHJhw61kb3MgcGFyYSBpbWFnZW46IHN0YXJ0VGltZT0ke2VsZW1lbnREYXRhLmVsZW1lbnQuc3RhcnRUaW1lfSwgZW5kVGltZT0ke2VsZW1lbnREYXRhLmVsZW1lbnQuZW5kVGltZX1gKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBBw7FhZGlyIG1hbmVqbyBwYXJhIHN1YnTDrXR1bG9zXG4gICAgICAgICAgaWYgKGVsZW1lbnREYXRhLmVsZW1lbnQudHlwZSA9PT0gJ3N1YnRpdGxlcycpIHtcbiAgICAgICAgICAgIC8vIE5vcm1hbGl6YXIgdmFsb3Jlc1xuICAgICAgICAgICAgaWYgKGVsZW1lbnREYXRhLmVsZW1lbnQuZ3JvdXBXb3JkcyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgIGVsZW1lbnREYXRhLmVsZW1lbnQuZ3JvdXBXb3JkcyA9IHRydWU7IC8vIFBvciBkZWZlY3RvLCBhZ3J1cGFyIHBhbGFicmFzXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZWxlbWVudERhdGEuZWxlbWVudC5zdGFydFRpbWUpXG4gICAgICAgICAgICAgIGVsZW1lbnREYXRhLmVsZW1lbnQuc3RhcnRUaW1lID0gTnVtYmVyKGVsZW1lbnREYXRhLmVsZW1lbnQuc3RhcnRUaW1lKTtcbiAgICAgICAgICAgIGlmIChlbGVtZW50RGF0YS5lbGVtZW50LmVuZFRpbWUpXG4gICAgICAgICAgICAgIGVsZW1lbnREYXRhLmVsZW1lbnQuZW5kVGltZSA9IE51bWJlcihlbGVtZW50RGF0YS5lbGVtZW50LmVuZFRpbWUpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIEHDsWFkaXIgbWFuZWpvIHBhcmEgc2VnbWVudG9zIGEgZWxpbWluYXJcbiAgICAgICAgICBpZiAoZWxlbWVudERhdGEuZWxlbWVudC50eXBlID09PSAnc2VnbWVudHMnICYmIGVsZW1lbnREYXRhLmVsZW1lbnQuc2VnbWVudHMpIHtcbiAgICAgICAgICAgIC8vIEFzZWd1cmFyc2UgZGUgcXVlIHNlZ21lbnRzIGVzIHVuIGFycmF5XG4gICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoZWxlbWVudERhdGEuZWxlbWVudC5zZWdtZW50cykpIHtcbiAgICAgICAgICAgICAgZWxlbWVudERhdGEuZWxlbWVudC5zZWdtZW50cyA9IFtdO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBOb3JtYWxpemFyIGxvcyB2YWxvcmVzIGRlIGNhZGEgc2VnbWVudG9cbiAgICAgICAgICAgIGVsZW1lbnREYXRhLmVsZW1lbnQuc2VnbWVudHMgPSBlbGVtZW50RGF0YS5lbGVtZW50LnNlZ21lbnRzLm1hcChzZWdtZW50ID0+ICh7XG4gICAgICAgICAgICAgIHN0YXJ0VGltZTogTnVtYmVyKHNlZ21lbnQuc3RhcnRUaW1lKSxcbiAgICAgICAgICAgICAgZW5kVGltZTogTnVtYmVyKHNlZ21lbnQuZW5kVGltZSlcbiAgICAgICAgICAgIH0pKTtcblxuICAgICAgICAgICAgLy8gVmVyaWZpY2FyIHF1ZSBoYXkgYWwgbWVub3MgdW4gc2VnbWVudG8gdsOhbGlkb1xuICAgICAgICAgICAgaWYgKGVsZW1lbnREYXRhLmVsZW1lbnQuc2VnbWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUud2FybignTm8gc2UgZGV0ZWN0YXJvbiBzZWdtZW50b3MgdsOhbGlkb3MgcGFyYSBlbGltaW5hcicpO1xuICAgICAgICAgICAgICBlbGVtZW50RGF0YS5kZXRlY3RlZCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIEHDsWFkaXIgbWFuZWpvIHBhcmEgbcO6c2ljYVxuICAgICAgICAgIGlmIChlbGVtZW50RGF0YS5lbGVtZW50LnR5cGUgPT09ICdtdXNpYycpIHtcbiAgICAgICAgICAgIC8vIEFzZWd1cmFyc2UgZGUgcXVlIG9wdGlvbnMgZXMgdW4gYXJyYXlcbiAgICAgICAgICAgIGlmICghZWxlbWVudERhdGEuZWxlbWVudC5vcHRpb25zIHx8ICFBcnJheS5pc0FycmF5KGVsZW1lbnREYXRhLmVsZW1lbnQub3B0aW9ucykpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0NyZWFuZG8gb3BjaW9uZXMgZGUgbcO6c2ljYSBwb3IgZGVmZWN0bycpO1xuICAgICAgICAgICAgICAvLyBPcGNpb25lcyBwb3IgZGVmZWN0byAoc29sbyBsYXMgcXVlIGV4aXN0ZW4gcmVhbG1lbnRlKVxuICAgICAgICAgICAgICBlbGVtZW50RGF0YS5lbGVtZW50Lm9wdGlvbnMgPSBbXG4gICAgICAgICAgICAgICAgXCIvc29uZ3Mvc29uZzEubXAzXCIsXG4gICAgICAgICAgICAgICAgXCIvc29uZ3Mvc29uZzIubXAzXCJcbiAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQXNlZ3VyYXJzZSBkZSBxdWUgbGFzIG9wY2lvbmVzIHNvbG8gc29uIGxhcyBleGlzdGVudGVzXG4gICAgICAgICAgICBpZiAoZWxlbWVudERhdGEuZWxlbWVudC5vcHRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0FjdHVhbGl6YW5kbyBvcGNpb25lcyBkZSBtw7pzaWNhIHBhcmEgdXNhciBzb2xvIGxhcyBleGlzdGVudGVzJyk7XG4gICAgICAgICAgICAgIGVsZW1lbnREYXRhLmVsZW1lbnQub3B0aW9ucyA9IFtcbiAgICAgICAgICAgICAgICBcIi9zb25ncy9zb25nMS5tcDNcIixcbiAgICAgICAgICAgICAgICBcIi9zb25ncy9zb25nMi5tcDNcIlxuICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFNpIGhheSB1bmEgZGV0ZWNjacOzbiBkaXJlY3RhIGRlIHNvbGljaXR1ZCBkZSBjb21wYWN0YWNpw7NuIHBlcm8gbGEgSUEgbm8gbGEgZGV0ZWN0w7NcbiAgICAgICAgaWYgKGlzQ29tcGFjdFJlcXVlc3QgJiYgKCFlbGVtZW50RGF0YSB8fCAhZWxlbWVudERhdGEuZGV0ZWN0ZWQgfHwgZWxlbWVudERhdGEuZWxlbWVudD8udHlwZSAhPT0gJ2NvbXBhY3QnKSkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiR2VuZXJhbmRvIGVsZW1lbnRvIGRlIGNvbXBhY3RhY2nDs24gYmFzYWRvIGVuIGxhIGRldGVjY2nDs24gZGlyZWN0YVwiKTtcbiAgICAgICAgICBlbGVtZW50RGF0YSA9IHtcbiAgICAgICAgICAgIGRldGVjdGVkOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlkZW5jZTogMC45NSxcbiAgICAgICAgICAgIGVsZW1lbnQ6IHtcbiAgICAgICAgICAgICAgdHlwZTogXCJjb21wYWN0XCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZWFzb25pbmc6IFwiRGV0ZWN0YWRvIGJhc2FkbyBlbiBlbCBhbsOhbGlzaXMgZGUgcGF0cm9uZXMgZGUgc29saWNpdHVkIGRpcmVjdGEgZGUgY29tcGFjdGFjacOzblwiXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFNpIGhheSB1bmEgZGV0ZWNjacOzbiBkaXJlY3RhIGRlIHNvbGljaXR1ZCBkZSByZWNvcnRlIGludGVsaWdlbnRlIHBlcm8gbGEgSUEgbm8gbG8gZGV0ZWN0w7NcbiAgICAgICAgaWYgKGlzU21hcnRUcmltUmVxdWVzdCAmJiAoIWVsZW1lbnREYXRhIHx8ICFlbGVtZW50RGF0YS5kZXRlY3RlZCB8fCBlbGVtZW50RGF0YS5lbGVtZW50Py50eXBlICE9PSAnc21hcnRUcmltJykpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIkdlbmVyYW5kbyBlbGVtZW50byBkZSByZWNvcnRlIGludGVsaWdlbnRlIGJhc2FkbyBlbiBsYSBkZXRlY2Npw7NuIGRpcmVjdGFcIik7XG4gICAgICAgICAgZWxlbWVudERhdGEgPSB7XG4gICAgICAgICAgICBkZXRlY3RlZDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZGVuY2U6IDAuOTUsXG4gICAgICAgICAgICBlbGVtZW50OiB7XG4gICAgICAgICAgICAgIHR5cGU6IFwic21hcnRUcmltXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZWFzb25pbmc6IFwiRGV0ZWN0YWRvIGJhc2FkbyBlbiBlbCBhbsOhbGlzaXMgZGUgcGF0cm9uZXMgZGUgc29saWNpdHVkIGRpcmVjdGEgZGUgcmVjb3J0ZSBpbnRlbGlnZW50ZVwiXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFNpIGhheSB1bmEgZGV0ZWNjacOzbiBkaXJlY3RhIGRlIHNvbGljaXR1ZCBkZSBtw7pzaWNhIHBlcm8gbGEgSUEgbm8gbGEgZGV0ZWN0w7NcbiAgICAgICAgaWYgKGlzTXVzaWNSZXF1ZXN0ICYmICghZWxlbWVudERhdGEgfHwgIWVsZW1lbnREYXRhLmRldGVjdGVkIHx8IGVsZW1lbnREYXRhLmVsZW1lbnQ/LnR5cGUgIT09ICdtdXNpYycpKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJHZW5lcmFuZG8gZWxlbWVudG8gZGUgbcO6c2ljYSBiYXNhZG8gZW4gbGEgZGV0ZWNjacOzbiBkaXJlY3RhXCIpO1xuXG4gICAgICAgICAgLy8gTGlzdGEgZGUgY2FuY2lvbmVzIHJlY29tZW5kYWRhcyAoc29sbyBsYXMgcXVlIGV4aXN0ZW4gcmVhbG1lbnRlKVxuICAgICAgICAgIGNvbnN0IG11c2ljT3B0aW9ucyA9IFtcbiAgICAgICAgICAgIFwiL3NvbmdzL3NvbmcxLm1wM1wiLFxuICAgICAgICAgICAgXCIvc29uZ3Mvc29uZzIubXAzXCJcbiAgICAgICAgICBdO1xuXG4gICAgICAgICAgZWxlbWVudERhdGEgPSB7XG4gICAgICAgICAgICBkZXRlY3RlZDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZGVuY2U6IDAuOTUsXG4gICAgICAgICAgICBlbGVtZW50OiB7XG4gICAgICAgICAgICAgIHR5cGU6IFwibXVzaWNcIixcbiAgICAgICAgICAgICAgb3B0aW9uczogbXVzaWNPcHRpb25zXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVhc29uaW5nOiBcIkRldGVjdGFkbyBiYXNhZG8gZW4gZWwgYW7DoWxpc2lzIGRlIHBhdHJvbmVzIGRlIHNvbGljaXR1ZCBkaXJlY3RhIGRlIG3DunNpY2FcIlxuICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTaSBoYXkgdW5hIGltYWdlbiBjb21wYXJ0aWRhIHkgbm8gc2UgZGV0ZWN0w7MgbmluZ8O6biBlbGVtZW50bywgbm8gY3JlYXIgdW5vIGF1dG9tw6F0aWNhbWVudGVcbiAgICAgICAgLy8gYSBtZW5vcyBxdWUgZWwgw7psdGltbyBtZW5zYWplIGRlbCB1c3VhcmlvIHRlbmdhIGluZGljYWNpb25lcyBjbGFyYXNcbiAgICAgICAgaWYgKGltYWdlVXJsICYmICghZWxlbWVudERhdGEgfHwgIWVsZW1lbnREYXRhLmRldGVjdGVkKSkge1xuICAgICAgICAgIC8vIFZlcmlmaWNhciBzaSBlbCBtZW5zYWplIGRlbCB1c3VhcmlvIGluZGljYSBjbGFyYW1lbnRlIHF1ZSBxdWllcmUgYWdyZWdhciBsYSBpbWFnZW5cbiAgICAgICAgICBjb25zdCB1c2VyV2FudHNUb0FkZEltYWdlID0gbGFzdFVzZXJNZXNzYWdlICYmIHR5cGVvZiBsYXN0VXNlck1lc3NhZ2UuY29udGVudCA9PT0gJ3N0cmluZycgJiYgKFxuICAgICAgICAgICAgL2FncmVnYSg/OnIpP1xccysoZXN0YXxsYXxtaXx1bmEpXFxzK2ltYWdlbi9pLnRlc3QobGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQpIHx8XG4gICAgICAgICAgICAvYSg/OsOxfG4pYWRlXFxzKyhlc3RhfGxhfG1pfHVuYSlcXHMraW1hZ2VuL2kudGVzdChsYXN0VXNlck1lc3NhZ2UuY29udGVudCkgfHxcbiAgICAgICAgICAgIC9jb2xvY2EoPzpyKT9cXHMrKGVzdGF8bGF8bWl8dW5hKVxccytpbWFnZW4vaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fFxuICAgICAgICAgICAgL3Bvbig/OmVyKT9cXHMrKGVzdGF8bGF8bWl8dW5hKVxccytpbWFnZW4vaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fFxuICAgICAgICAgICAgL3VzYSg/OnIpP1xccysoZXN0YXxsYXxtaXx1bmEpXFxzK2ltYWdlbi9pLnRlc3QobGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQpIHx8XG4gICAgICAgICAgICAvaW5zZXJ0YSg/OnIpP1xccysoZXN0YXxsYXxtaXx1bmEpXFxzK2ltYWdlbi9pLnRlc3QobGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQpIHx8XG4gICAgICAgICAgICAvbWV0ZSg/OnIpP1xccysoZXN0YXxsYXxtaXx1bmEpXFxzK2ltYWdlbi9pLnRlc3QobGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQpIHx8XG4gICAgICAgICAgICAvLyBQYXRyb25lcyBtw6FzIGdlbmVyYWxlc1xuICAgICAgICAgICAgLyg/OnF1aWVyb3xuZWNlc2l0b3xxdWlzaWVyYSlcXHMrKD86YWdyZWdhcnxhw7FhZGlyfGNvbG9jYXJ8cG9uZXJ8aW5zZXJ0YXJ8bWV0ZXIpXFxzKyg/OmxhfGVzdGF8bWl8dW5hKT9cXHMqaW1hZ2VuL2kudGVzdChsYXN0VXNlck1lc3NhZ2UuY29udGVudCkgfHxcbiAgICAgICAgICAgIC8oPzpwdWVkZXN8cG9kcsOtYXMpXFxzKyg/OmFncmVnYXJ8YcOxYWRpcnxjb2xvY2FyfHBvbmVyfGluc2VydGFyfG1ldGVyKVxccysoPzpsYXxlc3RhfG1pfHVuYSk/XFxzKmltYWdlbi9pLnRlc3QobGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQpIHx8XG4gICAgICAgICAgICAvLyBQYXRyb25lcyBjb24gZWwgc2VnbWVudG8gZGUgdGllbXBvIGVzcGVjw61maWNvXG4gICAgICAgICAgICAvaW1hZ2VuXFxzKyg/OmVufGF8YWx8ZGVsfGRlc2RlfGVudHJlKVxccysoPzplbHxsb3MpP1xccyooPzpzZWd1bmRvfHNlZ3xzfHRpZW1wb3xtaW51dG98bWluKS9pLnRlc3QobGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQpIHx8XG4gICAgICAgICAgICAvaW1hZ2VuLipcXGJcXGQrXFxiLipcXGJcXGQqXFxiL2kudGVzdChsYXN0VXNlck1lc3NhZ2UuY29udGVudCkgfHwgLy8gaW1hZ2VuIHNlZ3VpZGEgZGUgbsO6bWVyb3MgKHByb2JhYmxlIHRpZW1wbylcbiAgICAgICAgICAgIC8vIERldGVjdGFyIGN1YW5kbyBzZSBoYWNlIHJlZmVyZW5jaWEgYSB1bmEgaW1hZ2VuIHByZXZpYVxuICAgICAgICAgICAgL2FncmVnYSg/OnIpP1xccytsYVxccytpbWFnZW5cXHMrKD86YW50ZXJpb3J8cHJldmlhfGNvbXBhcnRpZGF8c3ViaWRhKS9pLnRlc3QobGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQpIHx8XG4gICAgICAgICAgICAvYSg/OsOxfG4pYWRlXFxzK2xhXFxzK2ltYWdlblxccysoPzphbnRlcmlvcnxwcmV2aWF8Y29tcGFydGlkYXxzdWJpZGEpL2kudGVzdChsYXN0VXNlck1lc3NhZ2UuY29udGVudCkgfHxcbiAgICAgICAgICAgIC9jb2xvY2EoPzpyKT9cXHMrbGFcXHMraW1hZ2VuXFxzKyg/OmFudGVyaW9yfHByZXZpYXxjb21wYXJ0aWRhfHN1YmlkYSkvaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fFxuICAgICAgICAgICAgL3Bvbig/OmVyKT9cXHMrbGFcXHMraW1hZ2VuXFxzKyg/OmFudGVyaW9yfHByZXZpYXxjb21wYXJ0aWRhfHN1YmlkYSkvaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fFxuICAgICAgICAgICAgL3VzYSg/OnIpP1xccytsYVxccytpbWFnZW5cXHMrKD86YW50ZXJpb3J8cHJldmlhfGNvbXBhcnRpZGF8c3ViaWRhKS9pLnRlc3QobGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQpIHx8XG4gICAgICAgICAgICAvaW5zZXJ0YSg/OnIpP1xccytsYVxccytpbWFnZW5cXHMrKD86YW50ZXJpb3J8cHJldmlhfGNvbXBhcnRpZGF8c3ViaWRhKS9pLnRlc3QobGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQpIHx8XG4gICAgICAgICAgICAvLyBEZXRlY3RhciBtZW5jaW9uZXMgYSBcImxhIGltYWdlblwiIGN1YW5kbyBlc3TDoSBjbGFybyBxdWUgc2UgcXVpZXJlIGFncmVnYXJcbiAgICAgICAgICAgICgvbGFcXHMraW1hZ2VuL2kudGVzdChsYXN0VXNlck1lc3NhZ2UuY29udGVudCkgJiZcbiAgICAgICAgICAgICAoL2FncmVnYXIvaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fFxuICAgICAgICAgICAgICAvYcOxYWRpci9pLnRlc3QobGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQpIHx8XG4gICAgICAgICAgICAgIC9jb2xvY2FyL2kudGVzdChsYXN0VXNlck1lc3NhZ2UuY29udGVudCkgfHxcbiAgICAgICAgICAgICAgL3BvbmVyL2kudGVzdChsYXN0VXNlck1lc3NhZ2UuY29udGVudCkgfHxcbiAgICAgICAgICAgICAgL2luc2VydGFyL2kudGVzdChsYXN0VXNlck1lc3NhZ2UuY29udGVudCkpKVxuICAgICAgICAgICk7XG5cbiAgICAgICAgICBpZiAodXNlcldhbnRzVG9BZGRJbWFnZSAmJiBsYXN0VXNlck1lc3NhZ2UgJiYgdHlwZW9mIGxhc3RVc2VyTWVzc2FnZS5jb250ZW50ID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgLy8gU29sbyBzaSBlbCB1c3VhcmlvIGxvIGluZGljYSBjbGFyYW1lbnRlLCBjcmVhciB1biBlbGVtZW50b1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJNZW5zYWplIGRldGVjdGFkbyBjb21vIHNvbGljaXR1ZCBkZSBhZ3JlZ2FyIGltYWdlbiAoc2luIGVsZW1lbnREYXRhIHByZXZpbyk6XCIsIGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KTtcbiAgICAgICAgICAgIGNvbnN0IHsgc3RhcnRUaW1lLCBlbmRUaW1lIH0gPSBleHRyYWN0SW1hZ2VUaW1lc0Zyb21NZXNzYWdlKGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KTtcblxuICAgICAgICAgICAgY29uc29sZS5sb2coYENyZWFuZG8gZWxlbWVudG8gZGUgaW1hZ2VuIGNvbiB0aWVtcG9zOiBzdGFydFRpbWU9JHtzdGFydFRpbWV9LCBlbmRUaW1lPSR7ZW5kVGltZX1gKTtcblxuICAgICAgICAgICAgZWxlbWVudERhdGEgPSB7XG4gICAgICAgICAgICAgIGRldGVjdGVkOiB0cnVlLFxuICAgICAgICAgICAgICBjb25maWRlbmNlOiAwLjksXG4gICAgICAgICAgICAgIGVsZW1lbnQ6IHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcImltYWdlXCIsXG4gICAgICAgICAgICAgICAgdXJsOiBpbWFnZVVybCxcbiAgICAgICAgICAgICAgICBzdGFydFRpbWU6IHN0YXJ0VGltZSxcbiAgICAgICAgICAgICAgICBlbmRUaW1lOiBlbmRUaW1lXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIFNpIG5vIGhheSBpbmRpY2FjacOzbiBjbGFyYSwgbm8gY3JlYXIgZWxlbWVudG9cbiAgICAgICAgICAgIGVsZW1lbnREYXRhID0ge1xuICAgICAgICAgICAgICBkZXRlY3RlZDogZmFsc2UsXG4gICAgICAgICAgICAgIGNvbmZpZGVuY2U6IDBcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHBhcnNpbmcgZWxlbWVudCBkYXRhIEpTT046JywgZSk7XG5cbiAgICAgICAgLy8gU2kgaGF5IHVuYSBpbWFnZW4gY29tcGFydGlkYSwgY3JlYXIgdW4gZWxlbWVudG8gcGFyYSBlbGxhIGEgcGVzYXIgZGVsIGVycm9yXG4gICAgICAgIGlmIChpbWFnZVVybCAmJiBsYXN0VXNlck1lc3NhZ2UgJiYgdHlwZW9mIGxhc3RVc2VyTWVzc2FnZS5jb250ZW50ID09PSAnc3RyaW5nJykge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiTWVuc2FqZSBkZXRlY3RhZG8gY29tbyBzb2xpY2l0dWQgZGUgYWdyZWdhciBpbWFnZW4gKGVycm9yIGhhbmRsaW5nKTpcIiwgbGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQpO1xuICAgICAgICAgIGNvbnN0IHsgc3RhcnRUaW1lLCBlbmRUaW1lIH0gPSBleHRyYWN0SW1hZ2VUaW1lc0Zyb21NZXNzYWdlKGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KTtcblxuICAgICAgICAgIGVsZW1lbnREYXRhID0ge1xuICAgICAgICAgICAgZGV0ZWN0ZWQ6IHRydWUsXG4gICAgICAgICAgICBjb25maWRlbmNlOiAwLjksXG4gICAgICAgICAgICBlbGVtZW50OiB7XG4gICAgICAgICAgICAgIHR5cGU6IFwiaW1hZ2VcIixcbiAgICAgICAgICAgICAgdXJsOiBpbWFnZVVybCxcbiAgICAgICAgICAgICAgc3RhcnRUaW1lOiBzdGFydFRpbWUsXG4gICAgICAgICAgICAgIGVuZFRpbWU6IGVuZFRpbWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGVsZW1lbnREYXRhID0ge1xuICAgICAgICAgICAgZGV0ZWN0ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgY29uZmlkZW5jZTogMFxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gU2kgbm8gc2UgZGV0ZWN0w7MgbmluZ8O6biBlbGVtZW50byBwZXJvIGhheSB1bmEgaW1hZ2VuLCB2ZXJpZmljYXIgc2kgZWwgdXN1YXJpbyBxdWllcmUgYWdyZWdhcmxhXG4gICAgICBpZiAoaW1hZ2VVcmwpIHtcbiAgICAgICAgLy8gVmVyaWZpY2FyIHNpIGVsIG1lbnNhamUgZGVsIHVzdWFyaW8gaW5kaWNhIGNsYXJhbWVudGUgcXVlIHF1aWVyZSBhZ3JlZ2FyIGxhIGltYWdlblxuICAgICAgICBjb25zdCB1c2VyV2FudHNUb0FkZEltYWdlID0gbGFzdFVzZXJNZXNzYWdlICYmIHR5cGVvZiBsYXN0VXNlck1lc3NhZ2UuY29udGVudCA9PT0gJ3N0cmluZycgJiYgKFxuICAgICAgICAgIC9hZ3JlZ2EoPzpyKT9cXHMrKGVzdGF8bGF8bWl8dW5hKVxccytpbWFnZW4vaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fFxuICAgICAgICAgIC9hKD86w7F8bilhZGVcXHMrKGVzdGF8bGF8bWl8dW5hKVxccytpbWFnZW4vaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fFxuICAgICAgICAgIC9jb2xvY2EoPzpyKT9cXHMrKGVzdGF8bGF8bWl8dW5hKVxccytpbWFnZW4vaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fFxuICAgICAgICAgIC9wb24oPzplcik/XFxzKyhlc3RhfGxhfG1pfHVuYSlcXHMraW1hZ2VuL2kudGVzdChsYXN0VXNlck1lc3NhZ2UuY29udGVudCkgfHxcbiAgICAgICAgICAvdXNhKD86cik/XFxzKyhlc3RhfGxhfG1pfHVuYSlcXHMraW1hZ2VuL2kudGVzdChsYXN0VXNlck1lc3NhZ2UuY29udGVudCkgfHxcbiAgICAgICAgICAvaW5zZXJ0YSg/OnIpP1xccysoZXN0YXxsYXxtaXx1bmEpXFxzK2ltYWdlbi9pLnRlc3QobGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQpIHx8XG4gICAgICAgICAgL21ldGUoPzpyKT9cXHMrKGVzdGF8bGF8bWl8dW5hKVxccytpbWFnZW4vaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fFxuICAgICAgICAgIC9tdWVzdHJhXFxzKyhlc3RhfGxhfG1pfHVuYSlcXHMraW1hZ2VuL2kudGVzdChsYXN0VXNlck1lc3NhZ2UuY29udGVudCkgfHxcbiAgICAgICAgICAvLyBQYXRyb25lcyBtw6FzIGdlbmVyYWxlc1xuICAgICAgICAgIC8oPzpxdWllcm98bmVjZXNpdG98cXVpc2llcmEpXFxzKyg/OmFncmVnYXJ8YcOxYWRpcnxjb2xvY2FyfHBvbmVyfGluc2VydGFyfG1ldGVyKVxccysoPzpsYXxlc3RhfG1pfHVuYSk/XFxzKmltYWdlbi9pLnRlc3QobGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQpIHx8XG4gICAgICAgICAgLyg/OnB1ZWRlc3xwb2Ryw61hcylcXHMrKD86YWdyZWdhcnxhw7FhZGlyfGNvbG9jYXJ8cG9uZXJ8aW5zZXJ0YXJ8bWV0ZXIpXFxzKyg/OmxhfGVzdGF8bWl8dW5hKT9cXHMqaW1hZ2VuL2kudGVzdChsYXN0VXNlck1lc3NhZ2UuY29udGVudCkgfHxcbiAgICAgICAgICAvLyBQYXRyb25lcyBjb24gZWwgc2VnbWVudG8gZGUgdGllbXBvIGVzcGVjw61maWNvXG4gICAgICAgICAgL2ltYWdlblxccysoPzplbnxhfGFsfGRlbHxkZXNkZXxlbnRyZSlcXHMrKD86ZWx8bG9zKT9cXHMqKD86c2VndW5kb3xzZWd8c3x0aWVtcG98bWludXRvfG1pbikvaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fFxuICAgICAgICAgIC9pbWFnZW4uKlxcYlxcZCtcXGIuKlxcYlxcZCpcXGIvaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fCAvLyBpbWFnZW4gc2VndWlkYSBkZSBuw7ptZXJvcyAocHJvYmFibGUgdGllbXBvKVxuICAgICAgICAgIC8vIERldGVjdGFyIGN1YW5kbyBzZSBoYWNlIHJlZmVyZW5jaWEgYSB1bmEgaW1hZ2VuIHByZXZpYVxuICAgICAgICAgIC9hZ3JlZ2EoPzpyKT9cXHMrbGFcXHMraW1hZ2VuXFxzKyg/OmFudGVyaW9yfHByZXZpYXxjb21wYXJ0aWRhfHN1YmlkYSkvaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fFxuICAgICAgICAgIC9hKD86w7F8bilhZGVcXHMrbGFcXHMraW1hZ2VuXFxzKyg/OmFudGVyaW9yfHByZXZpYXxjb21wYXJ0aWRhfHN1YmlkYSkvaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fFxuICAgICAgICAgIC9jb2xvY2EoPzpyKT9cXHMrbGFcXHMraW1hZ2VuXFxzKyg/OmFudGVyaW9yfHByZXZpYXxjb21wYXJ0aWRhfHN1YmlkYSkvaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fFxuICAgICAgICAgIC9wb24oPzplcik/XFxzK2xhXFxzK2ltYWdlblxccysoPzphbnRlcmlvcnxwcmV2aWF8Y29tcGFydGlkYXxzdWJpZGEpL2kudGVzdChsYXN0VXNlck1lc3NhZ2UuY29udGVudCkgfHxcbiAgICAgICAgICAvdXNhKD86cik/XFxzK2xhXFxzK2ltYWdlblxccysoPzphbnRlcmlvcnxwcmV2aWF8Y29tcGFydGlkYXxzdWJpZGEpL2kudGVzdChsYXN0VXNlck1lc3NhZ2UuY29udGVudCkgfHxcbiAgICAgICAgICAvaW5zZXJ0YSg/OnIpP1xccytsYVxccytpbWFnZW5cXHMrKD86YW50ZXJpb3J8cHJldmlhfGNvbXBhcnRpZGF8c3ViaWRhKS9pLnRlc3QobGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQpIHx8XG4gICAgICAgICAgLy8gRGV0ZWN0YXIgbWVuY2lvbmVzIGEgXCJsYSBpbWFnZW5cIiBjdWFuZG8gZXN0w6EgY2xhcm8gcXVlIHNlIHF1aWVyZSBhZ3JlZ2FyXG4gICAgICAgICAgKC9sYVxccytpbWFnZW4vaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSAmJlxuICAgICAgICAgICAoL2FncmVnYXIvaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fFxuICAgICAgICAgICAgL2HDsWFkaXIvaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fFxuICAgICAgICAgICAgL2NvbG9jYXIvaS50ZXN0KGxhc3RVc2VyTWVzc2FnZS5jb250ZW50KSB8fFxuICAgICAgICAgICAgL3BvbmVyL2kudGVzdChsYXN0VXNlck1lc3NhZ2UuY29udGVudCkgfHxcbiAgICAgICAgICAgIC9pbnNlcnRhci9pLnRlc3QobGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQpKSlcbiAgICAgICAgKTtcblxuICAgICAgICBpZiAodXNlcldhbnRzVG9BZGRJbWFnZSAmJiBsYXN0VXNlck1lc3NhZ2UgJiYgdHlwZW9mIGxhc3RVc2VyTWVzc2FnZS5jb250ZW50ID09PSAnc3RyaW5nJykge1xuICAgICAgICAgIC8vIFNvbG8gc2kgZWwgdXN1YXJpbyBsbyBpbmRpY2EgY2xhcmFtZW50ZSwgY3JlYXIgdW4gZWxlbWVudG9cbiAgICAgICAgICBjb25zdCB7IHN0YXJ0VGltZSwgZW5kVGltZSB9ID0gZXh0cmFjdEltYWdlVGltZXNGcm9tTWVzc2FnZShsYXN0VXNlck1lc3NhZ2UuY29udGVudCk7XG5cbiAgICAgICAgICBjb25zb2xlLmxvZyhgQ3JlYW5kbyBlbGVtZW50byBkZSBpbWFnZW4gY29uIHRpZW1wb3M6IHN0YXJ0VGltZT0ke3N0YXJ0VGltZX0sIGVuZFRpbWU9JHtlbmRUaW1lfWApO1xuXG4gICAgICAgICAgZWxlbWVudERhdGEgPSB7XG4gICAgICAgICAgICBkZXRlY3RlZDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZGVuY2U6IDAuOSxcbiAgICAgICAgICAgIGVsZW1lbnQ6IHtcbiAgICAgICAgICAgICAgdHlwZTogXCJpbWFnZVwiLFxuICAgICAgICAgICAgICB1cmw6IGltYWdlVXJsLFxuICAgICAgICAgICAgICBzdGFydFRpbWU6IHN0YXJ0VGltZSxcbiAgICAgICAgICAgICAgZW5kVGltZTogZW5kVGltZVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gU2kgbm8gaGF5IGluZGljYWNpw7NuIGNsYXJhLCBubyBjcmVhciBlbGVtZW50b1xuICAgICAgICAgIGVsZW1lbnREYXRhID0ge1xuICAgICAgICAgICAgZGV0ZWN0ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgY29uZmlkZW5jZTogMFxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVsZW1lbnREYXRhID0ge1xuICAgICAgICAgIGRldGVjdGVkOiBmYWxzZSxcbiAgICAgICAgICBjb25maWRlbmNlOiAwXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIG1lc3NhZ2U6IHtcbiAgICAgICAgcm9sZTogJ2Fzc2lzdGFudCcsXG4gICAgICAgIGNvbnRlbnQ6IGNsZWFuZWRSZXNwb25zZVxuICAgICAgfSxcbiAgICAgIGVsZW1lbnREYXRhOiBlbGVtZW50RGF0YVxuICAgIH0pO1xuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZW4gbGEgQVBJIGRlIGNoYXQ6JywgZXJyb3IpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgZXJyb3I6ICdFcnJvciBhbCBwcm9jZXNhciBsYSBzb2xpY2l0dWQgZGUgY2hhdCcgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJPcGVuQUkiLCJvcGVuYWkiLCJhcGlLZXkiLCJwcm9jZXNzIiwiZW52IiwiT1BFTkFJX0FQSV9LRVkiLCJzeXN0ZW1JbnN0cnVjdGlvbnMiLCJleHRyYWN0SW1hZ2VUaW1lc0Zyb21NZXNzYWdlIiwibWVzc2FnZUNvbnRlbnQiLCJzdGFydFRpbWUiLCJlbmRUaW1lIiwiY29uc29sZSIsImxvZyIsInJhbmdlUGF0dGVybnMiLCJwYXR0ZXJuIiwibWF0Y2giLCJwYXJzZUludCIsInNpbXBsZVR3b051bWJlcnMiLCJzdGFydFRpbWVQYXR0ZXJucyIsImVuZFRpbWVQYXR0ZXJucyIsImlzQXRTdGFydCIsInRlc3QiLCJpc0F0RW5kIiwic3RhcnRUaW1lTWF0Y2giLCJ0b1N0cmluZyIsImluY2x1ZGVzIiwiZW5kVGltZU1hdGNoIiwidGVtcCIsIlBPU1QiLCJyZXEiLCJtZXNzYWdlcyIsImxhc3RJbWFnZVVybCIsImpzb24iLCJBcnJheSIsImlzQXJyYXkiLCJlcnJvciIsInN0YXR1cyIsImltYWdlVXJsIiwibGFzdFVzZXJNZXNzYWdlIiwicmV2ZXJzZSIsImZpbmQiLCJtIiwicm9sZSIsImNvbnRlbnQiLCJpbWFnZU1hdGNoIiwiaGFzTGFzdEltYWdlUmVmZXJlbmNlIiwiaXNDb21wYWN0UmVxdWVzdCIsImlzU21hcnRUcmltUmVxdWVzdCIsImlzTXVzaWNSZXF1ZXN0IiwiY29udmVyc2F0aW9uV2l0aFN5c3RlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJyZXNwb25zZSIsImNoYXQiLCJjb21wbGV0aW9ucyIsImNyZWF0ZSIsIm1vZGVsIiwidGVtcGVyYXR1cmUiLCJtYXhfdG9rZW5zIiwidG9wX3AiLCJmcmVxdWVuY3lfcGVuYWx0eSIsInByZXNlbmNlX3BlbmFsdHkiLCJyZXNwb25zZUNvbnRlbnQiLCJjaG9pY2VzIiwibWVzc2FnZSIsImVsZW1lbnREYXRhTWF0Y2giLCJjbGVhbmVkUmVzcG9uc2UiLCJyZXBsYWNlIiwidHJpbSIsImVsZW1lbnREYXRhIiwicGFyc2UiLCJkZXRlY3RlZCIsImNvbmZpZGVuY2UiLCJyZWFzb25pbmciLCJlbGVtZW50IiwidHlwZSIsIndhcm4iLCJ1cmwiLCJOdW1iZXIiLCJ1bmRlZmluZWQiLCJpc05hTiIsImV4dHJhY3RlZFRpbWVzIiwiZ3JvdXBXb3JkcyIsInNlZ21lbnRzIiwibWFwIiwic2VnbWVudCIsImxlbmd0aCIsIm9wdGlvbnMiLCJtdXNpY09wdGlvbnMiLCJ1c2VyV2FudHNUb0FkZEltYWdlIiwiZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/ai-chat/route.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/formdata-node","vendor-chunks/ms","vendor-chunks/openai","vendor-chunks/form-data-encoder","vendor-chunks/whatwg-url","vendor-chunks/agentkeepalive","vendor-chunks/tr46","vendor-chunks/web-streams-polyfill","vendor-chunks/node-fetch","vendor-chunks/webidl-conversions","vendor-chunks/humanize-ms","vendor-chunks/event-target-shim","vendor-chunks/abort-controller"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fai-chat%2Froute&page=%2Fapi%2Fai-chat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fai-chat%2Froute.ts&appDir=C%3A%5CUsers%5Cdavid%5CDesktop%5Cai-video-agent%5Creact-video-editor%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cdavid%5CDesktop%5Cai-video-agent%5Creact-video-editor&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();